<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>AutoSender Pro</title>
    <!-- Ê∑ªÂä† faviconÔºåÈÅøÂÖç404ÈîôËØØ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üì®</text></svg>">
    <!-- ÂÖ®Â±ÄÊ†∑ÂºèÂíåÂ≠ó‰ΩìËÆæÁΩÆ -->
    <style>
        /*#region ÂÖ®Â±ÄÊ†∑ÂºèÂíåÂ≠ó‰ΩìËÆæÁΩÆ */
        @font-face {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            src: url('./test/Xiaolai.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --text-dark: #2F2F2F;
            --border-dark: #2F2F2F;
            --shadow: rgba(0, 0, 0, 0.1);
            --hacker-green: #00ff41;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        *,
        *::before,
        *::after {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif !important;
        }

        textarea,
        .log-box,
        #numbersText,
        #messageText {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif !important;
        }

        textarea::placeholder {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif !important;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            background: linear-gradient(135deg, #00ff88 0%, #0080ff 50%, #be7dff 100%);
            background-color: #00ff88;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            color: var(--text-dark);
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            visibility: visible;
            opacity: 1;
        }

        .content-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .nav-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            align-items: flex-start;
            margin-right: 10px;
            margin-top: 30px;
            flex-shrink: 0;
            box-sizing: border-box;
        }

        /*#endregion */
        /*#region ÂØºËà™ÊåâÈíÆÊ†∑Âºè */

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 40px;
            align-items: flex-start;
        }

        .nav-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            min-width: 100px;
            position: relative;
        }

        #navHomeBtn {
            background: linear-gradient(135deg, #b2ff9be6, rgb(208, 255, 1));
        }

        #navHomeBtn:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        #navHomeBtn:active,
        #navHomeBtn.active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        #navHomeBtn.active:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 18px rgba(240, 147, 251, 0.6);
        }

        #navSendBtn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            font-size: 10px;
            padding: 12px 15px;
        }

        #navSendBtn:hover {
            background: linear-gradient(100deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #000002;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.5);
        }

        #navSendBtn:active,
        #navSendBtn.active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(102, 166, 255, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        #navSendBtn.active:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 18px rgba(102, 166, 255, 0.6);
        }

        #navAccountBtn {
            background: linear-gradient(135deg, #a8c0ff 0%, #9d8fff 50%, #b794f6 100%);
        }

        #navAccountBtn:hover {
            background: linear-gradient(150deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #000000;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(157, 143, 255, 0.5);
        }

        #navAccountBtn:active,
        #navAccountBtn.active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(183, 148, 246, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        #navAccountBtn.active:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 18px rgba(183, 148, 246, 0.6);
        }

        #navInboxBtn {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
        }

        #navInboxBtn:hover {
            background: linear-gradient(150deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #000000;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(252, 182, 159, 0.5);
        }

        #navInboxBtn:active,
        #navInboxBtn.active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(255, 179, 71, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        #navInboxBtn.active:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 18px rgba(255, 179, 71, 0.6);
        }

        #navLogoutBtn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        #navLogoutBtn:hover {
            background: linear-gradient(150deg, #ff5252 0%, #d32f2f 50%, #b71c1c 100%);
            border-color: #000000;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(255, 107, 107, 0.5);
        }

        #navLogoutBtn:active {
            background: linear-gradient(120deg, #d32f2f 0%, #b71c1c 50%, #8b0000 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        #navLogoutBtn:active:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 18px rgba(255, 107, 107, 0.6);
        }

        /*#endregion */
        /*#region ‰∏ªÂÆπÂô®ÂíåÂ∑•‰ΩúÂå∫ */

        .main-container {
            display: flex;
            gap: 10px;
            width: 1300px;
            height: 580px;
            position: relative;
            max-width: 100vw;
            max-height: 100vh;
            box-sizing: border-box;
        }

        .workspace-ab {
            display: none;
            gap: 10px;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .workspace-ab.single-panel {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .workspace-ab.single-panel .panel-a {
            margin: 0 auto;
        }

        .workspace-ab.show-log {
            display: flex;
        }

        .btn-log-panel {
            position: absolute;
            left: 10px;
            padding: 8px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: linear-gradient(135deg, hsla(341, 100%, 63%, 0.949) 0%, hsl(273, 100%, 85%) 50%, #ffec8ff2 100%);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3), 0 0 15px rgba(255, 152, 0, 0.2);
            white-space: nowrap;
        }

        .btn-log-panel:hover {
            background: linear-gradient(135deg, rgba(255, 148, 134, 0.98) 0%, rgba(255, 180, 80, 0.95) 50%, rgba(102, 255, 189, 0.98) 100%);
            border-color: #FF9800;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5), 0 0 25px rgba(255, 152, 0, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .btn-log-panel:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 3px 10px rgba(255, 152, 0, 0.4), 0 0 15px rgba(255, 152, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 180, 80, 0.95) 0%, rgba(255, 160, 60, 0.9) 50%, rgba(255, 140, 40, 0.95) 100%);
        }

        .btn-log-panel.active {
            background: linear-gradient(135deg, rgba(202, 136, 255, 0.3) 0%, rgb(255, 70, 190) 50%, rgb(255, 130, 136) 100%);
            border-color: #8B00FF;
            box-shadow: 0 4px 15px rgba(139, 0, 255, 0.4), 0 0 20px rgba(139, 0, 255, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.2);
        }

        .btn-log-panel.active:hover {
            background: linear-gradient(135deg, rgba(233, 90, 255, 0.924) 0%, hsl(270, 100%, 81%) 50%, rgb(102, 126, 234) 100%);
            box-shadow: 0 6px 20px rgba(139, 0, 255, 0.5), 0 0 25px rgba(139, 0, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        /*#endregion */
        /*#region AÁâàÈù¢ÊùøÔºàÂèëÈÄÅÈù¢ÊùøÔºâ */

        .panel-a {
            width: 750px;
            height: 580px;
            background: linear-gradient(0.3turn, #ebb9ea, #b29dff, #9becfe);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 4px 12px var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .panel-a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        /*#endregion */
        /*#region BÁâàÈù¢ÊùøÔºàÊó•ÂøóÈù¢ÊùøÔºâ */

        .panel-b {
            width: 450px;
            background: linear-gradient(to right, #8ad3f7 0%, #9becd1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 4px 12px var(--shadow);
            display: none;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            min-width: 450px;
            height: 580px;
            position: relative;
            flex-shrink: 0;
        }

        .workspace-ab.show-log .panel-b {
            display: flex;
        }

        .workspace-ab.show-log {
            display: flex;
            align-items: flex-start;
        }

        .panel-b:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        /*#endregion */
        /*#region DÁâàÈù¢ÊùøÔºà‰∏ªÈ°µÈù¢Ôºâ */

        .panel-d {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.2) 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 4px 12px var(--shadow);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            box-sizing: border-box;
        }

        .main-title {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #634ffe 75%, #bd00fe 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
            position: relative;
            line-height: 1.2;
        }

        .main-subtitle {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: rgba(47, 47, 47, 0.6);
            text-align: center;
            margin-top: 20px;
            letter-spacing: 8px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        /*#endregion */
        /*#region CÁâàÈù¢ÊùøÔºàÊî∂‰ª∂ÁÆ±Èù¢ÊùøÔºâ */

        .panel-c {
            width: 900px;
            height: 100%;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 4px 12px var(--shadow);
            display: none;
            flex-direction: column;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            box-sizing: border-box;
        }

        /*#endregion */
        /*#region EÁâàÈù¢ÊùøÔºàË¥¶Âè∑ÁÆ°ÁêÜÈù¢ÊùøÔºâ */

        .panel-e {
            width: 900px;
            height: 100%;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 4px 12px var(--shadow);
            display: none;
            flex-direction: column;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            box-sizing: border-box;
        }

        .panel-e .panel-content {
            padding: 15px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-e .user-detail-header,
        .panel-e .user-detail-stats-grid,
        .panel-e .user-detail-stat-card {
            flex-shrink: 0;
        }

        .panel-e .panel-header {
            background: linear-gradient(45deg, #e9f1ffe6 0%, hsla(355, 100%, 91%, 0.851) 35%, hsla(76, 100%, 80%, 0.902) 70%, rgba(216, 255, 172, 0.85) 100%);
            border-radius: 15px 15px 0 0;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            height: 35px;
            padding: 0 15px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            font-size: 18px;
            color: var(--text-dark);
            border-bottom: 3px solid var(--border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .panel-a .panel-header {
            background: linear-gradient(0.3turn, #f072ee, #896bf7, #66ddf8);
            border-radius: 15px 15px 0 0;
        }

        .panel-b .panel-header {
            background: linear-gradient(to right, #90a2f5 0%, #6bf3dd 100%);
            border-radius: 15px 15px 0 0;
            position: relative;
        }

        .panel-c .panel-header {
            background: linear-gradient(45deg, #e9f1ffe6 0%, hsla(355, 100%, 91%, 0.851) 35%, hsla(76, 100%, 80%, 0.902) 70%, rgba(216, 255, 172, 0.85) 100%);
            border-radius: 15px 15px 0 0;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .panel-content {
            padding: 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            display: flex;
            gap: 10px;
            overflow: hidden;
        }

        .numbers-container {
            width: 380px;
            min-width: 380px;
            max-width: 380px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(0.25turn, #fdc4f0, hsl(200, 84%, 88%), #edc7ff);
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }

        .message-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(45deg, #ffddff 0%, #ffc9e6 50%, #a4ffff 100%);
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            overflow: hidden;
        }

        .input-header {
            padding: 8px 12px;
            border-bottom: 2px solid var(--border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.3);
        }

        .input-title {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            font-size: 16px;
        }

        .input-actions {
            display: flex;
            gap: 6px;
        }

        .btn-icon {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border-dark);
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-icon:hover {
            background: linear-gradient(135deg, rgba(139, 0, 255, 0.15), rgba(139, 0, 255, 0.1));
            border-color: #8B00FF;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 8px rgba(139, 0, 255, 0.2);
        }

        .btn-icon:active {
            transform: translateY(0) scale(0.95);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)) !important;
            border-color: var(--border-dark) !important;
        }

        .btn-icon:focus {
            outline: none;
        }

        .btn-icon:focus:not(:active) {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)) !important;
            border-color: var(--border-dark) !important;
            transform: none !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }

        .btn-icon svg {
            width: 14px;
            height: 14px;
        }

        .input-area {
            flex: 1;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 100%;
            padding: 12px;
            border: none;
            outline: none;
            resize: none;
            font-size: 18px;
            font-weight: bold;
            color: var(--text-dark);
            background: transparent;
            transition: all 0.2s;
        }

        #numbersText {
            font-size: 18px;
            width: 100%;
            box-sizing: border-box;
        }

        textarea:focus {
            background: rgba(255, 255, 255, 0.1);
        }

        .char-count {
            position: absolute;
            bottom: 8px;
            right: 10px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 11px;
            color: rgba(47, 47, 47, 0.6);
            background: rgba(255, 255, 255, 0.7);
            padding: 3px 8px;
            font-weight: bold;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        #numbersCount.has-numbers {
            color: #4CAF50;
        }

        #messageCount.has-content {
            color: #4CAF50;
        }

        #messageCount.over-limit {
            color: #F44336;
        }

        .message-count-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 20px;
            padding: 0 6px;
            background: linear-gradient(135deg, #FF9800, #FF6B35);
            color: white;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(255, 152, 0, 0.3);
        }

        .control-bar {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-top: 10px;
            justify-content: flex-start;
            gap: 10px;
            position: relative;
            flex-wrap: nowrap;
            width: 100%;
        }

        .btn-log-panel+.stats-bar-inline {
            flex-shrink: 0;
            white-space: nowrap;
            margin-left: 10px;
            margin-right: auto;
            flex: 1;
            min-width: 0;
            overflow: visible;
        }

        .stats-bar-inline {
            flex: 1;
            min-width: 0;
            display: flex;
            gap: 8px;
            padding: 6px 8px;
            background: linear-gradient(0.3turn, rgba(235, 185, 234, 0.6) 0%, rgba(178, 157, 255, 0.6) 50%, rgba(155, 236, 254, 0.6) 100%);
            border-radius: 8px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 9px;
            font-weight: bold;
            flex-wrap: wrap;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            flex-shrink: 1;
            justify-content: center;
            align-items: center;
        }

        .stats-bar-inline .stat-item {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            color: var(--text-dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-shrink: 1;
            min-width: 0;
            flex: 0 1 auto;
        }

        .stats-bar-inline .stat-value {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            font-size: 9px;
            margin-left: 2px;
            white-space: nowrap;
        }

        #taskCountInline {
            color: #9C27B0;
        }

        #phoneCountInline {
            color: #2196F3;
        }

        #totalSentCountInline {
            color: #00BCD4;
        }

        #successCountInline {
            color: #4CAF50;
        }

        #failCountInline {
            color: #FF5252;
        }

        #successRateInline {
            color: #FF9800;
        }

        .workspace-ab.show-log .stats-bar-inline {
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }

        .workspace-ab.show-log .stats-bar {
            display: flex;
        }

        .stats-bar {
            display: none;
        }

        .interval-control {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .interval-label {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 12px;
            font-weight: 600;
        }

        .interval-select {
            padding: 5px 8px;
            border: 2px solid var(--border-dark);
            border-radius: 6px;
            background: rgba(243, 252, 254, 0.9);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15), inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }

        .interval-select option {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            color: var(--text-dark);
            background: linear-gradient(135deg, rgba(235, 185, 234, 0.95) 0%, rgba(178, 157, 255, 0.9) 50%, rgba(155, 236, 254, 0.95) 100%);
        }

        .interval-select[data-value="0.3"] {
            color: #F44336;
            font-weight: 900;
        }

        .interval-select[data-value="0.7"] {
            color: #FF8A80;
            font-weight: 900;
        }

        .interval-select[data-value="1.0"] {
            color: #4CAF50;
            font-weight: 900;
        }

        .interval-select[data-value="1.5"] {
            color: #FFE082;
            font-weight: 900;
        }

        .interval-select[data-value="2.0"] {
            color: #FFC107;
            font-weight: 900;
        }

        .interval-select:hover {
            border-color: #8B00FF;
            transform: translateY(-1px);
        }

        .btn-send {
            flex-shrink: 0;
            white-space: nowrap;
            padding: 6px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: linear-gradient(135deg, #c5f6df 0%, #75baff 50%, hwb(303 69% 2%) 100%);
            color: rgb(255, 255, 255);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(151, 117, 250, 0.3);
            height: auto;
        }

        .btn-send:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(151, 117, 250, 0.4);
            background: linear-gradient(135deg, #b24dfb 0%, #ff68fc 50%, #519fe9 100%);
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .log-box {
            flex: 1;
            background: linear-gradient(135deg, #e6d2d8 0%, #a8edea 100%);
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            padding: 10px;
            padding-bottom: 60px;
            overflow-y: auto;
            font-size: 14px;
            color: var(--text-dark);
            position: relative;
        }

        .log-item {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed rgba(47, 47, 47, 0.2);
            line-height: 1.6;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            padding: 10px;
            background: linear-gradient(135deg, rgba(138, 211, 247, 0.85) 0%, rgba(155, 236, 209, 0.8) 50%, rgba(138, 211, 247, 0.85) 100%);
            border-radius: 8px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 11px;
            font-weight: bold;
            flex-wrap: wrap;
            width: 100%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            color: var(--text-dark);
        }

        .stat-value {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            font-size: 12px;
            margin-left: 3px;
        }

        #taskCount {
            color: #9C27B0;
        }

        #phoneCount {
            color: #2196F3;
        }

        #totalSentCount {
            color: #00BCD4;
        }

        #successCount {
            color: #4CAF50;
        }

        #failCount {
            color: #FF5252;
        }

        #successRate {
            color: #FF9800;
        }

        .anchor-trigger {
            position: absolute;
            bottom: clamp(-8px, -0.8vh, -6px);
            right: clamp(-15px, -1.5vw, -12px);
            width: clamp(16px, 2vw, 20px);
            height: clamp(16px, 2vw, 20px);
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            touch-action: manipulation;
        }

        .anchor-trigger::before {
            content: '';
            width: 8px;
            height: 8px;
            border-bottom: 2px solid rgba(0, 255, 65, 0.7);
            border-right: 2px solid rgba(0, 255, 65, 0.7);
            transition: 0.2s;
        }

        .anchor-trigger:hover::before {
            width: 14px;
            height: 14px;
            border-color: var(--hacker-green);
        }

        .textarea-wrapper.expanded~.anchor-trigger::before,
        .log-wrapper.expanded~.anchor-trigger::before {
            width: 14px;
            height: 14px;
            border-color: var(--hacker-green);
        }

        .textarea-wrapper.locked~.anchor-trigger::before,
        .log-wrapper.locked~.anchor-trigger::before {
            border-color: var(--hacker-green);
        }

        #logTrigger {
            bottom: -4px;
            right: -10px;
        }

        .notification-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #FF6B6B;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 10px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
        }

        .notification-count.has-unread {
            display: flex;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .inbox-layout {
            display: flex;
            height: 100%;
            gap: 10px;
        }

        .contact-list {
            width: 250px;
            min-width: 200px;
            border-right: 2px solid var(--border-dark);
            padding-right: 10px;
            overflow-y: auto;
            background: linear-gradient(120deg, rgba(168, 200, 255, 0.25) 0%, rgba(255, 154, 162, 0.2) 50%, rgba(168, 200, 255, 0.22) 100%);
            border-radius: 8px;
            position: relative;
        }

        .contact-item {
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(110deg, rgba(200, 255, 220, 0.75) 0%, rgba(255, 200, 220, 0.7) 45%, rgba(255, 220, 230, 0.72) 100%);
            position: relative;
        }

        .contact-item:hover {
            background: linear-gradient(110deg, rgba(220, 240, 255, 0.85) 0%, rgba(255, 210, 230, 0.8) 45%, rgba(255, 230, 240, 0.82) 100%);
            transform: translateY(-2px);
        }

        .contact-item.active {
            background: linear-gradient(110deg, rgba(240, 250, 255, 0.95) 0%, rgba(255, 240, 250, 0.9) 45%, rgba(255, 250, 255, 0.92) 100%);
            border: 3px solid var(--border-dark);
            box-shadow: 0 2px 8px rgba(168, 200, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .contact-item.unread::before {
            content: '';
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #FF6B6B;
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(255, 107, 107, 0.6);
            z-index: 1;
        }

        .avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 220, 100, 0.9) 0%, rgba(255, 200, 150, 0.85) 50%, rgba(255, 180, 200, 0.9) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(255, 200, 100, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .contact-info {
            flex: 1;
            min-width: 0;
        }

        .contact-name {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-dark);
            margin-bottom: 2px;
        }

        .contact-preview {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 11px;
            color: rgba(47, 47, 47, 0.7);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-area {
            width: 640px;
            display: flex;
            flex-direction: column;
            min-width: 0;
            flex-shrink: 0;
        }

        .chat-header {
            padding: 10px;
            border-bottom: 2px solid var(--border-dark);
            margin-bottom: 10px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-dark);
            background: linear-gradient(100deg, rgba(168, 200, 255, 0.2) 0%, rgba(255, 154, 162, 0.18) 50%, rgba(168, 200, 255, 0.19) 100%);
            border-radius: 8px;
        }

        .chat-header .phone-number {
            display: inline-block;
            padding: 6px 12px;
            background: linear-gradient(110deg, rgba(200, 255, 220, 0.75) 0%, rgba(255, 200, 220, 0.7) 45%, rgba(255, 220, 230, 0.72) 100%);
            border-radius: 10px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(168, 200, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .chat-display {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            background: linear-gradient(125deg, rgba(168, 200, 255, 0.18) 0%, rgba(255, 154, 162, 0.15) 40%, rgba(168, 200, 255, 0.16) 100%);
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 0;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 6px 20px;
            border-radius: 20px;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 13px;
            line-height: 1.2;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            min-width: 0;
            position: relative;
            box-shadow: inset 0 8px 5px rgba(255, 255, 255, 0.65), 0 1px 2px rgba(0, 0, 0, 0.2);
            border: solid 1px rgba(0, 0, 0, 0.5);
            margin-bottom: 25px;
            box-sizing: border-box;
            float: left;
            clear: both;
        }

        .chat-bubble.left {
            align-self: flex-start;
            background: linear-gradient(to top, #ffd700 0%, #ffeb3b 15%);
            color: var(--text-dark);
            font-weight: bold;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
        }

        .chat-bubble.left:before,
        .chat-bubble.left:after {
            border-radius: 20px / 5px;
            content: '';
            display: block;
            position: absolute;

        }

        .chat-bubble.left:before {
            border: 7px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.8);
            bottom: 0px;
            left: -6px;
            z-index: 1;
        }

        .chat-bubble.left:after {
            border: 7px solid transparent;
            border-bottom-color: #fbe981;
            bottom: 1px;
            left: -4px;
            right: auto;
            z-index: 2;
        }

        .chat-bubble.right {
            align-self: flex-end;
            background-image: linear-gradient(to top, #3d7eff 0%, #7bb3ff 25%);
            color: #000;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
            font-weight: bold;
            float: right;
        }

        .chat-bubble.right:before,
        .chat-bubble.right:after {
            border-radius: 20px / 5px;
            content: '';
            display: block;
            position: absolute;

        }

        .chat-bubble.right:before {
            border: 7px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.8);
            bottom: 0px;
            right: -6px;
            left: auto;
            z-index: 1;
        }

        .chat-bubble.right:after {
            border: 7px solid transparent;
            border-bottom-color: #86beec;
            bottom: 1px;
            right: -4px;
            left: auto;
            z-index: 2;
        }

        .chat-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
            font-weight: bold;
            position: absolute;
            bottom: -18px;
            left: 0;
            white-space: nowrap;
        }

        .chat-bubble.right .chat-time {
            right: 0;
            left: auto;
        }

        .reply-bar {
            display: flex;
            gap: 8px;
        }

        .reply-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 18px;
            outline: none;
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 18px;
            color: var(--text-dark);
            background: linear-gradient(115deg, rgba(168, 200, 255, 0.3) 0%, rgba(255, 154, 162, 0.28) 45%, rgba(255, 179, 186, 0.29) 100%);
            transition: all 0.2s;
        }

        .reply-input::placeholder {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
        }

        .reply-input:focus {
            border-color: #0213f7;
            box-shadow: 0 0 0 2px rgba(129, 212, 250, 0.2);
        }

        .btn-send-reply {
            padding: 8px 24px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 138, 128, 0.4), 0 0 15px rgba(255, 138, 128, 0.3);
        }

        .btn-send-reply:hover:not(:disabled) {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            color: var(--text-dark);
            border: 2px solid var(--border-dark);
            border-color: #000000;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 82, 82, 0.6), 0 0 25px rgba(255, 82, 82, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .btn-send-reply:active:not(:disabled) {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 4px 12px rgba(255, 82, 82, 0.5), 0 0 18px rgba(255, 82, 82, 0.4);
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
        }

        .btn-send-reply:disabled {
            cursor: not-allowed;
            opacity: 1;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: linear-gradient(135deg, rgba(168, 200, 255, 0.2) 0%, rgba(255, 154, 162, 0.15) 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #a8c8ff 0%, #ff9aa2 50%, #ffb3ba 100%);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8bb5ff 0%, #ff7a8a 50%, #ff9fb3 100%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        * {
            scrollbar-width: thin;
            scrollbar-color: #a8c8ff rgba(168, 200, 255, 0.2);
        }

        .file-input {
            display: none;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            border: 2px solid var(--border-dark);
            background: rgba(255, 255, 255, 0.95);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            white-space: nowrap;
        }

        .status-connected {
            background: linear-gradient(135deg, #66ff66 0%, #4CAF50 50%, #81C784 100%);
            color: white;
            border-color: #4CAF50;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(76, 175, 80, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .status-disconnected {
            background: #FF8A80;
            color: white;
            border-color: #FF8A80;
            font-weight: bold;
        }

        .btn-clear-logs {
            position: absolute;
            bottom: 57px;
            right: 14px;
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid var(--border-dark);
            background: linear-gradient(135deg, hwb(83 73% 0% / 0.886) 0%, rgba(227, 255, 14, 0.945) 100%);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 99999;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .btn-clear-logs:hover {
            background: linear-gradient(135deg, rgba(255, 168, 233, 0.886) 0%, rgba(206, 253, 255, 0.945) 100%);
            border-color: #8B00FF;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 0, 255, 0.2);
        }

        .btn-clear-inbox {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid var(--border-dark);
            background: linear-gradient(135deg, hwb(83 73% 0% / 0.886) 0%, rgba(227, 255, 14, 0.945) 100%);
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 99999;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .btn-clear-inbox:hover {
            background: linear-gradient(135deg, rgba(255, 168, 233, 0.886) 0%, rgba(206, 253, 255, 0.945) 100%);
            border-color: #8B00FF;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 0, 255, 0.2);
        }

        .message-bubble-notification {
            position: fixed;
            right: -300px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, rgba(129, 212, 250, 0.9), rgba(129, 212, 250, 0.7));
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            padding: 12px 18px;
            color: var(--text-dark);
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 13px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            white-space: nowrap;
            animation: slideInBubble 0.5s ease-out forwards, fadeOutBubble 0.5s ease-in 2.5s forwards;
        }

        @keyframes slideInBubble {
            0% {
                right: -300px;
                opacity: 0;
            }

            100% {
                right: 20px;
                opacity: 1;
            }
        }

        @keyframes fadeOutBubble {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateY(-50%) scale(0.9);
            }
        }

        /*#endregion */
        /*#region ÁßªÂä®Á´ØÂìçÂ∫îÂºèÊ†∑Âºè */

        @media (max-width: 768px) {

            body {
                padding: 10px;
                margin: 0;
                width: 100vw;
                height: 100dvh;
                overflow: hidden;
                -webkit-overflow-scrolling: touch;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: stretch;
                background: linear-gradient(135deg, #00ff88 0%, #0080ff 50%, #be7dff 100%);
                position: fixed;
                top: 0;
                left: 0;
                box-sizing: border-box;
            }

            .content-wrapper {
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                align-items: stretch;
                justify-content: flex-start;
                padding: 0;
                box-sizing: border-box;
                overflow: hidden;
                background: transparent;
                border: none;
                position: relative;
                gap: 6px;
            }

            .nav-container {
                width: 100%;
                height: 50px;
                max-height: 50px;
                min-height: 50px;
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 8px;
                margin: 0;
                padding: 0;
                flex-shrink: 0;
                z-index: 100;
                box-sizing: border-box;
            }

            .nav-buttons {
                display: flex;
                flex-direction: row;
                gap: 12px;
                align-items: center;
                justify-content: flex-start;
                width: 100%;
            }

            .nav-btn {
                flex: 0 0 auto;
                padding: 10px 12px;
                font-size: 12px;
                min-width: 0;
                height: auto;
                border-radius: 25px;
                border: 2px solid var(--border-dark);
                color: var(--text-dark);
                font-weight: bold;
                text-align: center;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            #navHomeBtn {
                background: linear-gradient(135deg, #b2ff9be6, rgb(208, 255, 1));
            }

            #navHomeBtn:hover {
                background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
                border-color: #0a0909;
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
            }

            #navHomeBtn:active,
            #navHomeBtn.active {
                background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
                border-width: 3px;
                box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
                font-weight: 900;
            }

            #navHomeBtn.active:hover {
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 18px rgba(240, 147, 251, 0.6);
            }

            #navSendBtn {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
                font-size: 10px;
                padding: 12px 15px;

            }

            #navSendBtn:hover {
                background: linear-gradient(100deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
                border-color: #000002;
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 15px rgba(79, 172, 254, 0.5);
            }

            #navSendBtn:active,
            #navSendBtn.active {
                background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
                border-width: 3px;
                box-shadow: 0 3px 10px rgba(102, 166, 255, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
                font-weight: 900;
            }

            #navSendBtn.active:hover {
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 18px rgba(102, 166, 255, 0.6);

            }

            #navInboxBtn {
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            }

            #navInboxBtn:hover {
                background: linear-gradient(150deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
                border-color: #000000;
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 15px rgba(252, 182, 159, 0.5);
            }

            #navInboxBtn:active,
            #navInboxBtn.active {
                background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
                border-width: 3px;
                box-shadow: 0 3px 10px rgba(255, 179, 71, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
                font-weight: 900;
            }

            #navInboxBtn.active:hover {
                transform: translateX(5px) scale(1.08);
                box-shadow: 0 6px 18px rgba(255, 179, 71, 0.6);
            }

            .main-container {
                display: flex;
                gap: 10px;
                width: 1300px;
                height: 580px;
                position: relative;
                max-width: 100vw;
                max-height: 100vh;
                box-sizing: border-box;
            }

            .workspace-ab {
                display: none;
                gap: 10px;
                width: 100%;
                height: 100%;
                position: relative;
            }

            .workspace-ab.single-panel {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .workspace-ab.single-panel .panel-a {
                margin: 0 auto;
            }

            .workspace-ab.show-log {
                display: flex;
            }

            .btn-log-panel {
                position: absolute;
                left: 10px;
                padding: 8px 20px;
                border: 2px solid var(--border-dark);
                border-radius: 20px;
                background: linear-gradient(135deg, hsla(341, 100%, 63%, 0.949) 0%, hsl(273, 100%, 85%) 50%, #ffec8ff2 100%);
                color: var(--text-dark);
                font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3), 0 0 15px rgba(255, 152, 0, 0.2);
                white-space: nowrap;
            }

            .btn-log-panel:hover {
                background: linear-gradient(135deg, rgba(255, 148, 134, 0.98) 0%, rgba(255, 180, 80, 0.95) 50%, rgba(102, 255, 189, 0.98) 100%);
                border-color: #FF9800;
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5), 0 0 25px rgba(255, 152, 0, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            }

            .btn-log-panel:active {
                transform: translateY(-1px) scale(0.98);
                box-shadow: 0 3px 10px rgba(255, 152, 0, 0.4), 0 0 15px rgba(255, 152, 0, 0.3);
                background: linear-gradient(135deg, rgba(255, 180, 80, 0.95) 0%, rgba(255, 160, 60, 0.9) 50%, rgba(255, 140, 40, 0.95) 100%);
            }

            .btn-log-panel.active {
                background: linear-gradient(135deg, rgba(202, 136, 255, 0.3) 0%, rgb(255, 70, 190) 50%, rgb(255, 130, 136) 100%);
                border-color: #8B00FF;
                box-shadow: 0 4px 15px rgba(139, 0, 255, 0.4), 0 0 20px rgba(139, 0, 255, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.2);
            }

            .btn-log-panel.active:hover {
                background: linear-gradient(135deg, rgba(233, 90, 255, 0.924) 0%, hsl(270, 100%, 81%) 50%, rgb(102, 126, 234) 100%);
                box-shadow: 0 6px 20px rgba(139, 0, 255, 0.5), 0 0 25px rgba(139, 0, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            }

            .main-container {
                flex: 1;
                width: 100%;
                display: flex;
                align-items: stretch;
                justify-content: flex-start;
                overflow: hidden;
                position: relative;
                border: 3px solid var(--border-dark);
                border-radius: 15px;
                background: rgba(255, 255, 255, 0.1);
                box-sizing: border-box;
            }

            .workspace-ab,
            .panel-b,
            .panel-c,
            .panel-d {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: none;
                flex-direction: column;
                overflow: hidden;
                box-sizing: border-box;
                border-radius: 12px;
            }

            .workspace-ab.mobile-show,
            .panel-b.mobile-show,
            .panel-c.mobile-show,
            .panel-d.mobile-show,
            .panel-e.mobile-show {
                display: flex !important;
            }

            .panel-d {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.2) 100%);
                justify-content: center;
                align-items: center;
                padding: 20px;
            }

            .panel-d .main-title {
                font-size: 36px;
                letter-spacing: 2px;
                line-height: 1.2;
                text-align: center;
                padding: 0 10px;
            }

            .panel-d .main-subtitle {
                font-size: 12px;
                letter-spacing: 4px;
                margin-top: 15px;
                padding: 0 10px;
                text-align: center;
            }

            .workspace-ab {
                background: transparent;
            }

            .panel-a {
                width: 100%;
                height: 100%;
                background: linear-gradient(0.3turn, #ebb9ea, #b29dff, #9becfe);
                border-radius: 12px;
                border: none;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .panel-a:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(178, 157, 255, 0.4);
            }

            .panel-a .panel-header {
                height: 35px;
                padding: 0 10px;
                border-radius: 12px 12px 0 0;
                border-bottom: 3px solid var(--border-dark);
                background: linear-gradient(0.3turn, #f072ee, #896bf7, #66ddf8);
            }

            .content-area {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 4px;
                padding: 4px;
                overflow: hidden;
                min-height: 0;
            }

            .numbers-container,
            .message-container {
                width: 100%;
                min-width: 100%;
                max-width: 100%;
                min-height: 0;
                border-radius: 8px;
                border: 2px solid var(--border-dark);
                overflow: hidden;
                display: flex;
                flex-direction: column;
                box-sizing: border-box;
                transition: all 0.3s ease;
            }

            .numbers-container {
                flex: 3;
                background: linear-gradient(0.25turn, #fdc4f0, hsl(200, 84%, 88%), #edc7ff);
            }

            .numbers-container:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(253, 196, 240, 0.5);
            }

            .message-container {
                flex: 2;
                background: linear-gradient(45deg, #ffddff 0%, #ffc9e6 50%, #a4ffff 100%);
            }

            .message-container:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(255, 201, 230, 0.5);
            }

            .input-header {
                padding: 4px 8px;
            }

            .input-area {
                flex: 1;
                min-height: 0;
                position: relative;
            }

            textarea {
                width: 100%;
                height: 100%;
                padding: 6px;
                border: none;
                outline: none;
                resize: none;
                font-size: 16px;
                font-weight: bold;
                background: transparent;
                box-sizing: border-box;
                -webkit-appearance: none;
                appearance: none;
                transform: none !important;
                max-height: none !important;
            }

            .control-bar {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 4px;
                gap: 4px;
                flex-shrink: 0;
                position: relative;
                align-items: center;
            }

            .btn-log-panel {
                position: static;
                flex-shrink: 0;
                white-space: nowrap;
                padding: 6px 12px;
                font-size: 12px;
                transition: all 0.3s ease;
                order: 1;
            }

            .btn-log-panel:hover {
                background: linear-gradient(135deg, rgba(255, 148, 134, 0.98) 0%, rgba(255, 180, 80, 0.95) 50%, rgba(102, 255, 189, 0.98) 100%);
                border-color: #FF9800;
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
            }

            .btn-log-panel:active {
                transform: scale(0.98);
                box-shadow: 0 2px 6px rgba(255, 152, 0, 0.3);
            }

            .interval-control {
                display: flex;
                align-items: center;
                gap: 4px;
                flex-shrink: 0;
                white-space: nowrap;
                margin-left: auto;
                order: 2;
            }

            .interval-select {
                transition: all 0.2s ease;
            }

            .interval-select:hover {
                border-color: #8B00FF;
                transform: translateY(-1px);
                box-shadow: 0 2px 6px rgba(139, 0, 255, 0.2);
            }

            .btn-send {
                flex-shrink: 0;
                white-space: nowrap;
                padding: 6px 15px;
                font-size: 12px;
                transition: all 0.3s ease;
                order: 3;
            }

            .stats-bar-inline {
                display: flex !important;
                flex: 0 0 100% !important;
                width: 100% !important;
                min-width: 100% !important;
                justify-content: space-around;
                gap: 4px;
                padding: 4px 6px;
                background: linear-gradient(0.3turn, rgba(235, 185, 234, 0.6) 0%, rgba(178, 157, 255, 0.6) 50%, rgba(155, 236, 254, 0.6) 100%);
                border-radius: 6px;
                font-size: 10px;
                flex-wrap: wrap;
                visibility: visible !important;
                opacity: 1 !important;
                order: 4;
                margin-left: 0 !important;
                margin-right: 0 !important;
                transition: all 0.3s ease;
            }

            .stats-bar-inline:hover {
                transform: translateY(-1px);
                box-shadow: 0 3px 8px rgba(178, 157, 255, 0.4);
            }

            .stats-bar-inline .stat-item {
                flex: 0 0 auto;
                white-space: nowrap;
            }

            .btn-send:hover:not(:disabled) {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(151, 117, 250, 0.5);
                background: linear-gradient(135deg, #b24dfb 0%, #ff68fc 50%, #519fe9 100%);
            }

            .btn-send:active:not(:disabled) {
                transform: scale(0.98);
            }

            .btn-send-reply {
                transition: all 0.3s ease;
            }

            .btn-send-reply:hover:not(:disabled) {
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(255, 82, 82, 0.5);
            }

            .btn-send-reply:active:not(:disabled) {
                transform: scale(0.98);
            }

            .btn-clear-inbox,
            .btn-clear-logs,
            .btn-clear-logs-mobile {
                transition: all 0.3s ease;
            }

            .btn-clear-inbox:hover,
            .btn-clear-logs:hover,
            .btn-clear-logs-mobile:hover {
                background: linear-gradient(135deg, rgba(255, 168, 233, 0.9) 0%, rgba(206, 253, 255, 0.95) 100%);
                border-color: #8B00FF;
                transform: scale(1.05);
                box-shadow: 0 4px 8px rgba(139, 0, 255, 0.3);
            }

            .btn-icon {
                transition: all 0.3s ease;
            }

            .btn-icon:hover {
                background: linear-gradient(135deg, rgba(139, 0, 255, 0.15), rgba(139, 0, 255, 0.1));
                border-color: #8B00FF;
                transform: scale(1.1);
                box-shadow: 0 3px 6px rgba(139, 0, 255, 0.2);
            }

            .btn-icon:active {
                transform: scale(0.95);
            }

            .panel-b.desktop-only {
                display: none !important;
            }

            .panel-b-mobile {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(to right, #8ad3f7 0%, #9becd1 100%);
                border-radius: 12px;
                border: none;
                display: none;
                flex-direction: column;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .panel-b-mobile:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(138, 211, 247, 0.4);
            }

            .panel-b-mobile.mobile-show {
                display: flex !important;
            }

            .panel-b-mobile .panel-header {
                height: 35px;
                padding: 0 10px;
                border-radius: 12px 12px 0 0;
                border-bottom: 3px solid var(--border-dark);
                background: linear-gradient(to right, #90a2f5 0%, #6bf3dd 100%);
                display: flex;
                align-items: center;
                flex-shrink: 0;
            }

            .panel-b-mobile .panel-content {
                flex: 1;
                display: flex;
                flex-direction: column;
                position: relative;
                overflow: hidden;
                padding: 4px;
            }

            .panel-b-mobile .log-box {
                flex: 1;
                margin-bottom: 4px;
                background: linear-gradient(135deg, #e6d2d8 0%, #a8edea 100%);
                border: 2px solid var(--border-dark);
                border-radius: 8px;
                padding: 6px;
                overflow-y: auto;
                font-size: 14px;
                color: var(--text-dark);
                transition: all 0.3s ease;
            }

            .panel-b-mobile .log-box:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 10px rgba(168, 237, 234, 0.4);
            }

            .panel-b-mobile .stats-bar {
                flex-shrink: 0;
                margin-top: 0;
                margin-bottom: 4px;
                display: flex;
                gap: 4px;
                padding: 4px 6px;
                background: linear-gradient(135deg, rgba(138, 211, 247, 0.85) 0%, rgba(155, 236, 209, 0.8) 50%, rgba(138, 211, 247, 0.85) 100%);
                border-radius: 6px;
                font-size: 10px;
                flex-wrap: wrap;
                justify-content: space-around;
                transition: all 0.3s ease;
            }

            .panel-b-mobile .stats-bar:hover {
                transform: translateY(-1px);
                box-shadow: 0 3px 8px rgba(138, 211, 247, 0.4);
            }

            .panel-b-mobile .stats-bar .stat-item {
                white-space: nowrap;
                color: var(--text-dark);
                font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            }

            .panel-b-mobile .stats-bar .stat-value {
                font-weight: bold;
            }

            #taskCountMobile {
                color: #9C27B0;
            }

            #phoneCountMobile {
                color: #2196F3;
            }

            #totalSentCountMobile {
                color: #00BCD4;
            }

            #successCountMobile {
                color: #4CAF50;
            }

            #failCountMobile {
                color: #FF5252;
            }

            #successRateMobile {
                color: #FF9800;
            }

            .panel-b-controls {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 4px 0 0 0;
                flex-shrink: 0;
            }

            .btn-back-to-send {
                padding: 8px 20px;
                border: 2px solid var(--border-dark);
                border-radius: 20px;
                background: linear-gradient(135deg, hsla(341, 100%, 63%, 0.949) 0%, hsl(273, 100%, 85%) 50%, #ffec8ff2 100%);
                color: var(--text-dark);
                font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3), 0 0 15px rgba(255, 152, 0, 0.2);
                white-space: nowrap;
            }

            .btn-back-to-send:hover {
                background: linear-gradient(135deg, rgba(255, 148, 134, 0.98) 0%, rgba(255, 180, 80, 0.95) 50%, rgba(102, 255, 189, 0.98) 100%);
                border-color: #FF9800;
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5), 0 0 25px rgba(255, 152, 0, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            }

            .btn-back-to-send:active {
                transform: translateY(-1px) scale(0.98);
                box-shadow: 0 3px 10px rgba(255, 152, 0, 0.4), 0 0 15px rgba(255, 152, 0, 0.3);
                background: linear-gradient(135deg, rgba(255, 180, 80, 0.95) 0%, rgba(255, 160, 60, 0.9) 50%, rgba(255, 140, 40, 0.95) 100%);
            }

            .btn-clear-logs-mobile {
                padding: 6px 14px;
                border-radius: 20px;
                border: 2px solid var(--border-dark);
                background: linear-gradient(135deg, hwb(83 73% 0% / 0.886) 0%, rgba(227, 255, 14, 0.945) 100%);
                color: var(--text-dark);
                font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
                font-size: 11px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s;
                white-space: nowrap;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            }

            .btn-clear-logs-mobile:hover {
                background: linear-gradient(135deg, rgba(255, 168, 233, 0.886) 0%, rgba(206, 253, 255, 0.945) 100%);
                border-color: #8B00FF;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(139, 0, 255, 0.2);
            }

            .panel-c {
                background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
                border: none;
                transition: all 0.3s ease;
            }

            .panel-c:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(193, 240, 255, 0.4);
            }

            .panel-c .panel-header {
                height: 35px;
                padding: 0 10px;
                border-radius: 12px 12px 0 0;
                border-bottom: 3px solid var(--border-dark);
                background: linear-gradient(45deg, #e9f1ffe6 0%, hsla(355, 100%, 91%, 0.851) 35%, hsla(76, 100%, 80%, 0.902) 70%, rgba(216, 255, 172, 0.85) 100%);
            }

            .panel-c .inbox-layout {
                display: flex;
                flex-direction: column;
                height: 100%;
                width: 100%;
                gap: 4px;
                padding: 4px;
                box-sizing: border-box;
                overflow: hidden;
            }

            .panel-c .contact-list {
                width: 100%;
                flex: 2;
                min-height: 100px;
                border: 2px solid var(--border-dark);
                border-radius: 8px;
                padding: 4px;
                overflow-y: auto;
                background: linear-gradient(120deg, rgba(168, 200, 255, 0.25) 0%, rgba(255, 154, 162, 0.2) 50%, rgba(168, 200, 255, 0.22) 100%);
                transition: all 0.3s ease;
            }

            .panel-c .contact-list:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 10px rgba(168, 200, 255, 0.4);
            }

            .panel-c .contact-item {
                transition: all 0.2s ease;
            }

            .panel-c .contact-item:hover {
                background: linear-gradient(110deg, rgba(220, 240, 255, 0.85) 0%, rgba(255, 210, 230, 0.8) 45%, rgba(255, 230, 240, 0.82) 100%);
                transform: translateX(3px);
            }

            .panel-c .chat-area {
                flex: 3;
                display: flex;
                flex-direction: column;
                min-height: 0;
                overflow: hidden;
            }

            .panel-c .chat-display {
                padding: 4px;
            }

            .panel-c .reply-bar {
                flex-shrink: 0;
                padding: 4px 0 0 0;
                gap: 4px;
            }

            html {
                -webkit-text-size-adjust: 100%;
                text-size-adjust: 100%;
            }

            textarea,
            input {
                font-size: 16px !important;
                -webkit-user-select: text;
                user-select: text;
            }

            .char-count {
                font-size: 10px;
                bottom: 5px;
                right: 8px;
                padding: 2px 6px;
            }

            * {
                max-width: 100%;
                box-sizing: border-box;
            }
        }
        /*#endregion */
    </style>
    <!-- ÁôªÂΩïÈ°µÈù¢Ê†∑Âºè -->
    <style>
        /*#region ÁôªÂΩïÈ°µÈù¢Âü∫Á°ÄÊ†∑Âºè */
        @font-face {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            src: url('./test/Xiaolai.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --text-dark: #2F2F2F;
            --border-dark: #2F2F2F;
            --shadow: rgba(0, 0, 0, 0.1);
            --hacker-green: #00ff41;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        *,
        *::before,
        *::after {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif !important;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body.login-mode {
            flex-direction: column;
            padding-top: 0;
        }
        /*#endregion */

        /*#region ÁôªÂΩïÈ°µÈù¢Â∏ÉÂ±Ä */
        .login-page {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .login-title-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            animation: titleFadeIn 0.8s ease-out;
        }

        @keyframes titleFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-main-title {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #634ffe 75%, #bd00fe 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
            position: relative;
            line-height: 1.2;
            margin-bottom: 10px;
        }

        .login-main-subtitle {
            font-family: 'Xiaolai', 'Microsoft YaHei', 'SimHei', 'Arial', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: rgba(47, 47, 47, 0.6);
            text-align: center;
            letter-spacing: 8px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .admin-entry-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 18px;
            border: 2px solid var(--border-dark);
            border-radius: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
            backdrop-filter: blur(10px);
            color: var(--text-dark);
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 100;
        }

        .admin-entry-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.25) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .admin-entry-btn:active {
            transform: translateY(0);
        }

        .admin-entry-btn svg {
            width: 16px;
            height: 16px;
        }
        /*#endregion */

        /*#region ÁôªÂΩïÈù¢ÊùøÊ†∑Âºè */
        .login-panel {
            width: 370px;

            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.25) 0%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.2) 100%);

            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 18px;

            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            overflow: hidden;
            animation: panelFloat 0.6s ease-out;
            margin-top: 20px;
            position: relative;
        }

        .login-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.6) 50%,
                transparent 100%);
            pointer-events: none;
        }

        .login-panel.admin-mode {
            background: linear-gradient(135deg,
                rgba(30, 30, 30, 0.9) 0%,
                rgba(20, 20, 20, 0.85) 50%,
                rgba(15, 15, 15, 0.9) 100%);
            border: 2px solid rgba(60, 60, 60, 0.6);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        @keyframes panelFloat {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .login-panel-header {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.2) 0%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.1) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            position: relative;
        }

        .login-panel-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.5) 50%,
                transparent 100%);
        }

        .login-panel.admin-mode .login-panel-header {
            background: linear-gradient(135deg,
                rgba(40, 40, 40, 0.8) 0%,
                rgba(30, 30, 30, 0.7) 50%,
                rgba(25, 25, 25, 0.8) 100%);
            border-bottom: 1px solid rgba(80, 80, 80, 0.5);
        }

        .login-logo {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
            margin: 0;
            letter-spacing: 1px;
        }

        .login-panel.admin-mode .login-logo {
            color: rgba(255, 255, 255, 0.95);
        }

        .login-panel.admin-mode .form-input {
            background: rgba(50, 50, 50, 0.6);
            border-color: rgba(100, 100, 100, 0.5);
            color: rgba(255, 255, 255, 0.9);
        }

        .login-panel.admin-mode .form-input::placeholder {
            color: rgba(200, 200, 200, 0.6);
        }

        .login-panel.admin-mode .form-input:focus {
            background: rgba(60, 60, 60, 0.7);
            border-color: rgba(150, 150, 150, 0.7);
            color: rgba(255, 255, 255, 1);
        }

        .login-panel.admin-mode .form-label,
        .login-panel.admin-mode .modal-label,
        .login-panel.admin-mode label {
            color: rgba(255, 255, 255, 0.9);
        }

        .login-panel.admin-mode .forgot-password-link {
            color: rgba(200, 200, 255, 0.9);
        }

        .login-panel.admin-mode .forgot-password-link:hover {
            color: rgba(255, 255, 255, 1);
        }

        .login-subtitle {
            display: none;
        }

        .login-panel-content {
            padding: 15px 20px;
            background: transparent;
        }
        /*#endregion */

        /*#region ÁôªÂΩïË°®ÂçïÊéß‰ª∂Ê†∑Âºè */
        .user-admin-toggle {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }

        .toggle-btn {
            flex: none;
            padding: 6px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.6);
            color: var(--text-dark);
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        .toggle-btn#userToggle {
            display: none;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #c5f6df 0%, #75baff 50%, #f0b3ff 100%);
            box-shadow: 0 2px 8px rgba(117, 186, 255, 0.3);
            border-width: 3px;
        }

        .login-panel.admin-mode .toggle-btn.active,
        .toggle-btn.btn-admin.active {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            box-shadow: 0 2px 8px rgba(15, 52, 96, 0.5);
            color: #ffd700;
            border-width: 3px;
            border-color: #ffd700;
        }

        .toggle-btn.btn-admin:not(.active) {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #1a1a2e 100%);
            color: #ecf0f1;
            border-color: #34495e;
        }

        .login-panel.admin-mode .toggle-btn.btn-admin:not(.active) {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.8) 0%, rgba(50, 50, 50, 0.8) 50%, rgba(40, 40, 40, 0.8) 100%);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(120, 120, 120, 0.6);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .toggle-btn.btn-admin:not(.active):hover {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffd700;
            border-color: #ffd700;
            transform: translateX(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(15, 52, 96, 0.6);
        }

        .login-panel.admin-mode .toggle-btn.btn-admin:not(.active):hover {
            background: linear-gradient(135deg, rgba(80, 80, 80, 0.9) 0%, rgba(70, 70, 70, 0.9) 50%, rgba(60, 60, 60, 0.9) 100%);
            color: rgba(255, 255, 255, 1);
            border-color: rgba(180, 180, 180, 0.8);
            transform: translateX(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .toggle-btn:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            transform: translateX(3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(117, 186, 255, 0.4);
        }

        .login-panel.admin-mode .toggle-btn:hover {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffd700;
            border-color: #ffd700;
            transform: translateX(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(15, 52, 96, 0.6);
        }

        .form-group {
            margin-bottom: 12px;
            position: relative;
            display: flex;
            justify-content: center;
        }

        .password-wrapper {
            position: relative;
            width: 90%;
            display: flex;
            justify-content: center;
        }

        .password-wrapper .form-input {
            width: 100%;
        }

        .show-password-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-dark);
            font-size: 14px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .show-password-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.05);
        }

        .forgot-password {
            text-align: right;
            margin-top: -8px;
            margin-bottom: 10px;
        }

        .forgot-password-link {
            color: rgba(47, 47, 47, 0.7);
            font-size: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .forgot-password-link:hover {
            color: #8B00FF;
            text-decoration: underline;
        }

        .form-input {
            width: 90%;
            padding: 10px 14px;
            border: 2px solid rgba(47, 47, 47, 0.3);
            border-radius: 12px;
            font-size: 15px;
            font-weight: bold;
            color: var(--text-dark);

            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            outline: none;
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .form-input::placeholder {
            color: rgba(47, 47, 47, 0.5);
            font-weight: 600;
        }

        .form-input:focus {
            border-color: rgba(139, 0, 255, 0.6);
            background: rgba(255, 255, 255, 0.6);
            box-shadow:
                0 0 0 4px rgba(139, 0, 255, 0.15),
                0 4px 12px rgba(139, 0, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        .btn-group {
            display: flex;
            flex-direction: row;
            gap: 8px;
            margin-top: 15px;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-group.vertical {
            flex-direction: column;
        }

        .btn-primary {
            flex: none;
            width: 20%;
            max-width: 20%;
            min-width: 0;
            padding: 10px 15px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: linear-gradient(135deg, #c5f6df 0%, #75baff 50%, #f0b3ff 100%);
            color: var(--text-dark);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
        }

        .login-panel.admin-mode .btn-primary {
            background: linear-gradient(135deg, #ff9a9a 0%, #ff6b6b 50%, #ee5a24 100%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .login-panel.admin-mode .btn-primary:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #c62828 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(255, 107, 107, 0.5);
        }

        .btn-primary:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .login-panel.admin-mode .btn-primary:active {
            background: linear-gradient(120deg, #ff6b6b 0%, #ee5a24 50%, #c62828 100%);
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .btn-secondary {
            flex: none;
            width: 20%;
            max-width: 20%;
            min-width: 0;
            padding: 10px 15px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            color: var(--text-dark);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        .btn-register {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%) !important;
        }

        .btn-register:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%) !important;
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .btn-register:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%) !important;
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .btn-admin {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%) !important;
        }

        .btn-admin:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%) !important;
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.5);
        }

        .btn-admin:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%) !important;
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(102, 166, 255, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .login-panel.admin-mode .btn-secondary {
            background: linear-gradient(135deg, rgba(255, 200, 200, 0.8) 0%, rgba(255, 180, 180, 0.6) 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .login-panel.admin-mode .btn-secondary:hover {
            background: linear-gradient(135deg, #ff9a9a 0%, #ff6b6b 50%, #ee5a24 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(255, 107, 107, 0.5);
            color: white;
        }

        .btn-secondary:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .login-panel.admin-mode .btn-secondary:active {
            background: linear-gradient(120deg, #ff6b6b 0%, #ee5a24 50%, #c62828 100%);
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .message-box {
            margin-top: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            display: none;
            position: relative;
            z-index: 99999;
        }

        .message-box.error {
            display: block;
            background: linear-gradient(135deg, #ffcdd2 0%, #ffab91 100%);
            border: 2px solid #e57373;
            color: #c62828;
        }

        .message-box.success {
            display: block;
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border: 2px solid #81c784;
            color: #2e7d32;
        }
        /*#endregion */

        /*#region Ëá™ÂÆö‰πâÂºπÁ™óÊ†∑Âºè */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);

            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200000;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.15s cubic-bezier(0.4, 0, 0.2, 1);

        }

        .custom-modal-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* ÈÄöÁî®ÊèêÁ§∫ÂºπÁ™óÈúÄË¶ÅÊõ¥È´òÁöÑz-indexÔºåÁ°Æ‰øùÂú®ÂÖ∂‰ªñÂºπÁ™ó‰πã‰∏ä */
        #customModal {
            z-index: 300000;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .custom-modal-panel {
            width: 400px;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 20px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;

            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, opacity;
        }

        .custom-modal-overlay.show .custom-modal-panel {
            transform: scale(1);
            opacity: 1;
        }

        .custom-modal-panel.admin-manage-modal {
            width: 600px;
            max-width: 90vw;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);

            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100000;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.15s cubic-bezier(0.4, 0, 0.2, 1);

        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .modal-panel {
            width: 380px;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 20px;
            border: 3px solid var(--border-dark);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;

            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, opacity;
        }

        .modal-overlay.show .modal-panel {
            transform: scale(1);
            opacity: 1;
        }

        .custom-modal-header {
            background: linear-gradient(45deg, #e9f1ffe6 0%, hsla(355, 100%, 91%, 0.9) 35%, hsla(76, 100%, 80%, 0.9) 70%, rgba(216, 255, 172, 0.9) 100%);
            padding: 15px 20px;
            border-bottom: 3px solid var(--border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .custom-modal-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .custom-modal-close {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border-dark);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .custom-modal-close:hover {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
            transform: rotate(90deg);
        }

        .custom-modal-content {
            padding: 20px;
        }

        .custom-modal-message {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .custom-modal-input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            outline: none;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        .custom-modal-input:focus {
            border-color: #8B00FF;
            box-shadow: 0 0 0 4px rgba(139, 0, 255, 0.15);
        }

        .custom-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .custom-modal-btn {
            flex: none;
            padding: 10px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .custom-modal-btn.cancel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            color: var(--text-dark);
        }

        .custom-modal-btn.cancel:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .custom-modal-btn.confirm {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .custom-modal-btn.confirm:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .custom-modal-btn:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .modal-header {
            background: linear-gradient(45deg, #e9f1ffe6 0%, hsla(355, 100%, 91%, 0.9) 35%, hsla(76, 100%, 80%, 0.9) 70%, rgba(216, 255, 172, 0.9) 100%);
            padding: 18px 25px;
            border-bottom: 3px solid var(--border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: 2px solid var(--border-dark);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .modal-close:hover {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
            transform: rotate(90deg);
        }

        .modal-content {
            padding: 25px;
        }

        .modal-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .modal-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            font-size: 15px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            outline: none;
            margin-bottom: 20px;
        }

        .modal-input:focus {
            border-color: #8B00FF;
            box-shadow: 0 0 0 4px rgba(139, 0, 255, 0.15);
        }

        .modal-btn {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 14px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            color: var(--text-dark);
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(252, 182, 159, 0.4);
        }

        .modal-btn:hover {
            background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 50%, #ee5a24 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .modal-message {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .modal-message.error {
            display: block;
            background: #ffebee;
            border: 2px solid #ef9a9a;
            color: #c62828;
        }
        /*#endregion */

        /*#region ÁÆ°ÁêÜÂëòÈ°µÈù¢Ê†∑Âºè */
        .admin-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(135deg, #00ff88 0%, #0080ff 50%, #be7dff 100%);
            z-index: 100;
        }

        .admin-page.show {
            display: block;
        }

        .manager-page {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
        }

        .manager-page.show {
            display: block;
        }

        .manager-container {
            max-width: 1100px;
            margin: 0 auto;
        }

        .manager-header {
            background: linear-gradient(0.3turn, #ebb9ea, #b29dff, #9becfe);
            border-radius: 20px;
            border: 3px solid var(--border-dark);
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .manager-header-left {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .admin-data-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 20px;
            padding: 15px 0;
        }

        .admin-data-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .admin-data-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .admin-data-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .panel-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-dark);
            margin: 0;
        }

        .add-user-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .add-user-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .user-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-button {
            position: relative;
            padding: 15px 20px;
            background: linear-gradient(135deg,
                rgba(255, 154, 162, 0.9) 0%,
                rgba(255, 206, 84, 0.9) 25%,
                rgba(168, 255, 120, 0.9) 50%,
                rgba(120, 219, 255, 0.9) 75%,
                rgba(200, 181, 255, 0.9) 100%);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15),
                        0 0 30px rgba(255, 154, 162, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.5);
            overflow: hidden;
        }

        .user-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .user-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.2),
                        0 0 40px rgba(255, 154, 162, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        .user-button-content {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-server-count-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 25%, #c44569 50%, #ff6b6b 75%, #ee5a6f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.5),
                        inset 0 2px 5px rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            flex-shrink: 0;
        }

        .user-button-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .user-button-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-id-text {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .user-manage-btn {
            padding: 6px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid var(--border-dark);
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .user-manage-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .user-button-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #555;
            margin-top: 5px;
        }

        .user-stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-stat-label {
            font-weight: 500;
        }

        .user-stat-value {
            font-weight: bold;
            color: var(--text-dark);
        }

        .server-buttons-grid-new {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-top: 15px;
        }

        .server-buttons-grid-new > button,
        .server-buttons-grid-new button {
            flex: none;
            width: 50px;
            height: 50px;
            min-width: 50px;
            max-width: 50px;
            padding: 0;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffa500 100%);
            cursor: pointer;
            transition: transform 0.6s ease, box-shadow 0.3s ease, opacity 0.3s ease;
            filter: none;
            opacity: 1;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4), 0 0 20px rgba(255, 165, 0, 0.3);
            text-align: center;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 11px;
            position: relative;
            overflow: visible;
            white-space: nowrap;
            text-overflow: ellipsis;
            z-index: 1;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .server-buttons-grid-new > button::before,
        .server-buttons-grid-new button::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: repeating-conic-gradient(from 0deg, rgba(255, 215, 0, 0.8) 0deg 30deg, rgba(255, 237, 78, 0.8) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(255, 165, 0, 0.8) 0deg 20deg, rgba(255, 215, 0, 0.8) 40deg 60deg, transparent 90deg);
            background-size: 200% 200%;
            opacity: 0.6;
            filter: blur(2px);
            animation: rotate 8s linear infinite;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .server-buttons-grid-new > button::after,
        .server-buttons-grid-new button::after {
            content: '';
            position: absolute;
            inset: 10%;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.6), rgba(255, 237, 78, 0.6), rgba(255, 165, 0, 0.6));
            opacity: 0.4;
            filter: blur(8px);
            z-index: -2;
            animation: rotate 12s linear infinite reverse;
        }

        .server-buttons-grid-new > button.active,
        .server-buttons-grid-new button.active {
            opacity: 1;
            background: radial-gradient(circle at 30% 30%, #ff4dff 0%, #f700ff 40%, #cc00cc 100%);
            box-shadow: 0 0 45px rgba(247, 0, 255, 0.7), 
                        0 0 65px rgba(247, 0, 255, 0.5),
                        inset 0 2px 15px rgba(255, 255, 255, 0.4);
            transform: scale(1.1) rotateY(0deg);
            filter: none;
            animation: pulsePurple 1.8s ease-in-out infinite, rotate3D 4s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.active::before,
        .server-buttons-grid-new button.active::before {
            opacity: 0.9;
            background: repeating-conic-gradient(from 0deg, rgba(247, 0, 255, 0.9) 0deg 30deg, rgba(255, 77, 255, 0.9) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(204, 0, 204, 0.9) 0deg 20deg, rgba(247, 0, 255, 0.9) 40deg 60deg, transparent 90deg);
            animation: rotate 5s linear infinite, glowPurple 1.8s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.active::after,
        .server-buttons-grid-new button.active::after {
            background: radial-gradient(circle at 50% 50%, rgba(247, 0, 255, 0.6), rgba(255, 77, 255, 0.4), rgba(204, 0, 204, 0.3));
            opacity: 0.4;
            animation: rotate 8s linear infinite reverse, pulsePurpleGlow 1.8s ease-in-out infinite;
        }

        .server-buttons-grid-new > button:hover,
        .server-buttons-grid-new button:hover {
            opacity: 1;
            transform: scale(1.05) rotateY(15deg);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 165, 0, 0.4);
        }

        .server-buttons-grid-new > button:active {
            transform: scale(0.95) rotateY(-15deg);
        }

        .server-buttons-grid-new > button.connected,
        .server-buttons-grid-new button.connected {
            background: radial-gradient(circle at 30% 30%, #b4ff4a 0%, #89fc23 40%, #6fd100 100%);
            box-shadow: 0 4px 20px rgba(137, 252, 35, 0.6), 
                        0 0 30px rgba(137, 252, 35, 0.4),
                        inset 0 2px 10px rgba(255, 255, 255, 0.3);
            opacity: 1;
            filter: none;
            animation: pulseGreen 2s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.connected::before {
            background: repeating-conic-gradient(from 0deg, rgba(137, 252, 35, 0.9) 0deg 30deg, rgba(180, 255, 74, 0.9) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(111, 209, 0, 0.9) 0deg 20deg, rgba(137, 252, 35, 0.9) 40deg 60deg, transparent 90deg);
            animation: rotate 6s linear infinite, glowGreen 2s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.disconnected,
        .server-buttons-grid-new button.disconnected {
            background: radial-gradient(circle at 30% 30%, #ff4d4d 0%, #f70707 40%, #cc0000 100%);
            box-shadow: 0 4px 20px rgba(247, 7, 7, 0.5), 
                        0 0 30px rgba(247, 7, 7, 0.3),
                        inset 0 2px 10px rgba(255, 255, 255, 0.2);
            animation: pulseRed 2.5s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.disconnected::before {
            background: repeating-conic-gradient(from 0deg, rgba(247, 7, 7, 0.8) 0deg 30deg, rgba(255, 77, 77, 0.8) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(204, 0, 0, 0.8) 0deg 20deg, rgba(247, 7, 7, 0.8) 40deg 60deg, transparent 90deg);
            animation: rotate 8s linear infinite, glowRed 2.5s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.selected,
        .server-buttons-grid-new button.selected {
            opacity: 1;
            background: radial-gradient(circle at 30% 30%, #ff4dff 0%, #f700ff 40%, #cc00cc 100%);
            box-shadow: 0 0 45px rgba(247, 0, 255, 0.7), 
                        0 0 65px rgba(247, 0, 255, 0.5),
                        inset 0 2px 15px rgba(255, 255, 255, 0.4);
            transform: scale(1.08);
            filter: none;
            animation: pulsePurple 1.8s ease-in-out infinite, rotate3D 4s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.selected::before,
        .server-buttons-grid-new button.selected::before {
            opacity: 0.9;
            background: repeating-conic-gradient(from 0deg, rgba(247, 0, 255, 0.9) 0deg 30deg, rgba(255, 77, 255, 0.9) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(204, 0, 204, 0.9) 0deg 20deg, rgba(247, 0, 255, 0.9) 40deg 60deg, transparent 90deg);
            animation: rotate 5s linear infinite, glowPurple 1.8s ease-in-out infinite;
        }

        .server-buttons-grid-new > button.selected::after,
        .server-buttons-grid-new button.selected::after {
            background: radial-gradient(circle at 50% 50%, rgba(247, 0, 255, 0.6), rgba(255, 77, 255, 0.4), rgba(204, 0, 204, 0.3));
            opacity: 0.4;
            animation: rotate 8s linear infinite reverse, pulsePurpleGlow 1.8s ease-in-out infinite;
        }

        .user-detail-panel {
            max-width: 900px;
            width: 90vw;
            max-height: 85vh;
            aspect-ratio: 1.2;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .user-detail-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }

        .user-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-dark);
            flex-shrink: 0;
        }

        .user-detail-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .user-detail-stat-card {
            padding: 10px;
            background: rgba(139, 0, 255, 0.1);
            border-radius: 8px;
            border: 2px solid rgba(139, 0, 255, 0.2);
        }

        .user-detail-stat-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }

        .user-detail-stat-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .user-detail-server-section {
            margin-top: 5px;
            flex-shrink: 0;
        }

        .user-detail-server-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-detail-server-hint {
            font-size: 12px;
            color: #888;
            font-style: italic;
        }

        .user-detail-server-explanation {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .user-detail-server-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            max-height: 120px;
            overflow-y: auto;
        }

        .user-detail-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 10px;
            border-top: 2px solid var(--border-dark);
            flex-shrink: 0;
        }

        .manager-section {
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .manager-section h3 {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .user-manage-row {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-bottom: 15px;
        }

        .user-manage-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
        }

        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .user-cancel-btn {
            padding: 4px 10px;
            border: 2px solid var(--border-dark);
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(135deg, #ff9a9a 0%, #ff6b6b 50%, #ee5a24 100%);
            color: white;
            transition: all 0.2s ease;
        }

        .user-cancel-btn:hover {
            transform: translateX(3px) scale(1.05);
        }

        .create-group-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .create-group-btn:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .group-creation-area {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
        }

        .group-creation-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .group-select-btn {
            padding: 8px 15px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
        }

        .group-select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .group-select-btn.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .user-group-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
        }

        .user-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-group-name {
            font-size: 15px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .user-group-actions {
            display: flex;
            gap: 10px;
        }

        .user-group-servers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .server-tag {
            padding: 8px 15px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .server-tag.private {
            background: linear-gradient(135deg, #ffd6e7 0%, #ff9aa2 100%);
        }

        .server-tag.public {
            background: linear-gradient(135deg, #c1f0ff 0%, #9becfe 100%);
        }

        .server-tag-label {
            font-size: 10px;
            color: rgba(47, 47, 47, 0.6);
            margin-top: 5px;
        }
        /*#endregion */

        /*#region ÊúçÂä°Âô®ÁÆ°ÁêÜÈù¢ÊùøÊ†∑Âºè */
        .admin-container {
            max-width: 1100px;
            margin: 0 auto;
        }

        .server-manager-header {
            background: linear-gradient(0.3turn, #ebb9ea, #b29dff, #9becfe);
            border-radius: 20px;
            border: 3px solid var(--border-dark);
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .server-manager-header h1 {
            font-size: 20px;
            font-weight: 900;
            color: var(--text-dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-back-btn {
            padding: 12px 25px;
            border: 2px solid var(--border-dark);
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            color: var(--text-dark);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-back-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            transform: translateY(-2px);
        }

        .admin-back-btn.password-setting-btn {
            background: linear-gradient(135deg, rgba(139, 0, 255, 0.8) 0%, rgba(139, 0, 255, 0.6) 100%);
            color: white;
            padding: 12px 25px;
            font-size: 14px;
            width: auto;
            min-width: auto;
        }

        .admin-back-btn.password-setting-btn:hover {
            background: linear-gradient(135deg, rgba(139, 0, 255, 1) 0%, rgba(100, 0, 200, 1) 100%);
            color: white;
            transform: translateY(-2px);
        }

        /* IDÂ∫ìÊåâÈíÆ - ÈùíËâ≤Ê∏êÂèò */
        .admin-back-btn.btn-id-library {
            background: linear-gradient(135deg, #00d4aa 0%, #00b894 50%, #00a085 100%);
            color: white;
        }
        .admin-back-btn.btn-id-library:hover {
            background: linear-gradient(135deg, #00f5c4 0%, #00d4aa 50%, #00b894 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 170, 0.4);
        }

        /* ÂÖÖÂÄºÊåâÈíÆ - ÈáëËâ≤Ê∏êÂèò */
        .admin-back-btn.btn-recharge {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 50%, #ff9500 100%);
            color: #2f2f2f;
        }
        .admin-back-btn.btn-recharge:hover {
            background: linear-gradient(135deg, #ffe44d 0%, #ffc966 50%, #ffb347 100%);
            color: #2f2f2f;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        /* ‰øÆÊîπÂØÜÁ†ÅÊåâÈíÆ - Á¥´Ëâ≤Ê∏êÂèò */
        .admin-back-btn.btn-password {
            background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 50%, #7c3aed 100%);
            color: white;
        }
        .admin-back-btn.btn-password:hover {
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 50%, #8b5cf6 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* ‰øùÂ≠òÈÄÄÂá∫ÊåâÈíÆ - ÁèäÁëöÁ∫¢Ê∏êÂèò */
        .admin-back-btn.btn-exit {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 50%, #e74c3c 100%);
            color: white;
        }
        .admin-back-btn.btn-exit:hover {
            background: linear-gradient(135deg, #ff8787 0%, #ff6b6b 50%, #ee5a52 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        /*#endregion */

        /*#region IDÂ∫ìÈù¢ÊùøÊ†∑Âºè */
        .id-library-panel {
            width: 75%;
            max-width: 900px;
            height: 80vh;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 50%, #f0fdf4 100%);
        }

        .id-library-header {
            background: linear-gradient(135deg, #00d4aa 0%, #00b894 50%, #00a085 100%);
            padding: 18px 25px;
        }

        .id-library-header .custom-modal-title {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .id-library-header .custom-modal-close {
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .id-library-header .custom-modal-close:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .id-library-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .id-library-toolbar {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            padding: 18px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(240, 253, 244, 0.85) 100%);
            border-radius: 16px;
            border: 2px solid var(--border-dark);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .id-library-input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .id-library-input-group label {
            font-size: 12px;
            font-weight: bold;
            color: var(--text-dark);
            letter-spacing: 1px;
        }

        .id-library-input {
            padding: 10px 14px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 14px;
            background: white;
            transition: all 0.3s ease;
            width: 220px;
        }

        .id-library-input:focus {
            outline: none;
            border-color: #00d4aa;
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.15);
        }

        .password-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .password-input-wrapper .id-library-input {
            padding-right: 40px;
        }

        .password-toggle-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .password-toggle-btn:hover {
            opacity: 1;
        }

        .id-library-btn {
            padding: 10px 18px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .id-library-btn.btn-save {
            background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
            color: white;
        }

        .id-library-btn.btn-save:hover {
            background: linear-gradient(135deg, #00f5c4 0%, #00d4aa 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 212, 170, 0.4);
        }

        .id-library-btn.btn-import {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .id-library-btn.btn-import:hover {
            background: linear-gradient(135deg, #7c8ff7 0%, #8b5cb5 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .id-library-btn.btn-clear {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .id-library-btn.btn-clear:hover {
            background: linear-gradient(135deg, #ff8787 0%, #ff6b6b 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .id-library-list-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 16px;
            border: 2px solid var(--border-dark);
            overflow: hidden;
        }

        .id-library-list-header {
            display: flex;
            padding: 14px 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 2px solid var(--border-dark);
            font-weight: bold;
            font-size: 13px;
            color: var(--text-dark);
        }

        .header-col {
            display: flex;
            align-items: center;
        }

        .header-col.col-index {
            width: 50px;
            justify-content: center;
        }

        .header-col.col-account {
            flex: 2;
            min-width: 200px;
        }

        .header-col.col-password {
            flex: 1.5;
            min-width: 150px;
        }

        .header-col.col-status {
            width: 80px;
            justify-content: center;
        }

        .header-col.col-usage-status {
            width: 100px;
            justify-content: center;
        }

        .header-col.col-actions {
            width: 120px;
            justify-content: center;
        }

        .id-library-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .id-library-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, rgba(240, 253, 244, 0.8) 0%, rgba(224, 242, 254, 0.6) 100%);
            border: 1px solid rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .id-library-item:hover {
            background: linear-gradient(135deg, rgba(220, 252, 231, 0.9) 0%, rgba(186, 230, 253, 0.7) 100%);
            transform: translateX(3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .id-library-item.error {
            background: linear-gradient(135deg, rgba(254, 226, 226, 0.8) 0%, rgba(254, 215, 215, 0.6) 100%);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .item-col {
            display: flex;
            align-items: center;
        }

        .item-col.col-index {
            width: 50px;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: #64748b;
            background: rgba(255, 255, 255, 0.6);
            padding: 6px 10px;
            border-radius: 8px;
        }

        .item-col.col-account {
            flex: 2;
            min-width: 200px;
            font-size: 14px;
            color: var(--text-dark);
            font-weight: 500;
            word-break: break-all;
        }

        .item-col.col-password {
            flex: 1.5;
            min-width: 150px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            color: #64748b;
        }

        .item-col.col-status {
            width: 80px;
            justify-content: center;
        }

        .item-col.col-usage-status {
            width: 100px;
            justify-content: center;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-badge.normal {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #15803d;
            border: 1px solid #86efac;
        }

        .status-badge.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
            border: 1px solid #fca5a5;
        }

        .usage-status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .usage-status-badge.new {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1d4ed8;
            border: 1px solid #93c5fd;
        }

        .usage-status-badge.new:hover {
            background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
            transform: scale(1.05);
        }

        .usage-status-badge.used {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .usage-status-badge.used:hover {
            background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
            transform: scale(1.05);
        }

        .item-col.col-actions {
            width: 120px;
            justify-content: center;
            gap: 8px;
        }

        .item-action-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-dark);
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .item-action-btn.btn-fill {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1d4ed8;
        }

        .item-action-btn.btn-fill:hover {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
            color: white;
        }

        .item-action-btn.btn-delete {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }

        .item-action-btn.btn-delete:hover {
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%);
            color: white;
        }

        .id-library-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .id-library-empty .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .id-library-empty .empty-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .id-library-empty .empty-hint {
            font-size: 13px;
            opacity: 0.7;
        }

        .id-library-footer {
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(240, 253, 244, 0.85) 100%);
            border-radius: 12px;
            border: 2px solid var(--border-dark);
            margin-top: 15px;
        }

        .id-library-stats {
            display: flex;
            gap: 30px;
            justify-content: center;
        }

        .id-library-stats .stat-item {
            font-size: 14px;
            color: var(--text-dark);
        }

        .id-library-stats .stat-item strong {
            font-size: 16px;
            margin-left: 5px;
        }

        /* IDÂ∫ìÈù¢ÊùøÊªöÂä®Êù°Ê†∑Âºè */
        .id-library-list::-webkit-scrollbar {
            width: 8px;
        }

        .id-library-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .id-library-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
            border-radius: 4px;
        }

        .id-library-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #00f5c4 0%, #00d4aa 100%);
        }

        .server-manager-section {
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .server-manager-section h3 {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .server-add-row {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .server-input-group {
            flex: 1;
            min-width: 0;
        }

        .server-input-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 8px;
            height: 20px;
            line-height: 20px;
        }

        .server-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            outline: none;
            box-sizing: border-box;
        }

        .server-input:focus {
            border-color: #8B00FF;
            box-shadow: 0 0 0 3px rgba(139, 0, 255, 0.15);
        }

        .server-connect-btn {
            flex: none;
            padding: 8px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .server-connect-btn:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .server-connect-btn:active {
            background: linear-gradient(120deg, #f50bce 0%, hsl(346, 99%, 57%) 50%, hsla(0, 100%, 60%, 0.86) 100%);
            border-width: 3px;
            box-shadow: 0 3px 10px rgba(240, 147, 251, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 900;
            transform: translateX(5px) scale(1.05);
        }

        .server-connect-btn.connecting {
            background: linear-gradient(135deg, #ffb347 0%, #ff9a56 50%, #ff6b6b 100%);
            cursor: not-allowed;
        }

        .server-list-section {
            margin-top: 15px;
        }

        .server-list-label {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .server-buttons-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .server-buttons-grid > button,
        .server-buttons-grid .server-button {
            flex: none;
            width: 98px;
            height: 70px;
            min-width: 98px;
            max-width: 98px;
            padding: 0;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffa500 100%);
            cursor: pointer;
            transition: all 0.3s ease;
            filter: none;
            opacity: 1;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4), 0 0 20px rgba(255, 165, 0, 0.3);
            text-align: center;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            z-index: 1;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .server-buttons-grid > button::before,
        .server-buttons-grid .server-button::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;

            background:
                linear-gradient(135deg, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.08) 35%, transparent 60%),
                repeating-linear-gradient(
                    180deg,
                    rgba(0,0,0,0.18) 0px,
                    rgba(0,0,0,0.18) 2px,
                    transparent 2px,
                    transparent 7px
                );
            opacity: 0.35;
            filter: blur(0.2px);
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .server-buttons-grid > button::after,
        .server-buttons-grid .server-button::after {
            content: '';
            position: absolute;
            inset: 8%;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.35), rgba(255, 237, 78, 0.25), rgba(255, 165, 0, 0.25));
            opacity: 0.35;
            filter: blur(10px);
            z-index: -2;
        }

        .server-buttons-grid > button.active,
        .server-buttons-grid .server-button.active {
            opacity: 1;
            background: radial-gradient(circle at 30% 30%, #ff4dff 0%, #f700ff 40%, #cc00cc 100%);
            box-shadow: 0 0 45px rgba(247, 0, 255, 0.7), 
                        0 0 65px rgba(247, 0, 255, 0.5),
                        inset 0 2px 15px rgba(255, 255, 255, 0.4);
            transform: scale(1.1) rotateY(0deg);
            filter: none;
            animation: pulsePurple 1.8s ease-in-out infinite, rotate3D 4s ease-in-out infinite;
        }

        .server-buttons-grid > button.active::before,
        .server-buttons-grid .server-button.active::before {
            opacity: 0.9;
            background: repeating-conic-gradient(from 0deg, rgba(247, 0, 255, 0.9) 0deg 30deg, rgba(255, 77, 255, 0.9) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(204, 0, 204, 0.9) 0deg 20deg, rgba(247, 0, 255, 0.9) 40deg 60deg, transparent 90deg);
            animation: rotate 5s linear infinite, glowPurple 1.8s ease-in-out infinite;
        }

        .server-buttons-grid > button.active::after,
        .server-buttons-grid .server-button.active::after {
            background: radial-gradient(circle at 50% 50%, rgba(247, 0, 255, 0.6), rgba(255, 77, 255, 0.4), rgba(204, 0, 204, 0.3));
            opacity: 0.4;
            animation: rotate 8s linear infinite reverse, pulsePurpleGlow 1.8s ease-in-out infinite;
        }

        @keyframes pulsePurple {
            0%, 100% {
                box-shadow: 0 0 45px rgba(247, 0, 255, 0.7), 
                            0 0 65px rgba(247, 0, 255, 0.5),
                            inset 0 2px 15px rgba(255, 255, 255, 0.4);
                transform: scale(1.1) rotateY(0deg);
            }
            50% {
                box-shadow: 0 0 55px rgba(247, 0, 255, 0.9), 
                            0 0 75px rgba(247, 0, 255, 0.7),
                            inset 0 2px 15px rgba(255, 255, 255, 0.5);
                transform: scale(1.12) rotateY(5deg);
            }
        }

        @keyframes glowPurple {
            0%, 100% {
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
        }

        @keyframes pulsePurpleGlow {
            0%, 100% {
                opacity: 0.4;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.1);
            }
        }

        @keyframes rotate3D {
            0%, 100% {
                transform: scale(1.1) rotateY(0deg) rotateX(0deg);
            }
            25% {
                transform: scale(1.12) rotateY(5deg) rotateX(2deg);
            }
            50% {
                transform: scale(1.1) rotateY(0deg) rotateX(0deg);
            }
            75% {
                transform: scale(1.12) rotateY(-5deg) rotateX(-2deg);
            }
        }

        .server-buttons-grid > button:hover,
        .server-buttons-grid .server-button:hover {
            opacity: 1;
            transform: scale(1.05) rotateY(15deg);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 165, 0, 0.4);
        }

        .server-buttons-grid > button,
        .server-buttons-grid .server-button {
            transition: transform 0.6s ease, box-shadow 0.3s ease, opacity 0.3s ease;
        }

        .server-buttons-grid > button:hover {
            transform: scale(1.05) rotateY(15deg);
        }

        .server-buttons-grid > button:active {
            transform: scale(0.95) rotateY(-15deg);
        }

        .server-buttons-grid > button:hover .server-tooltip,
        .server-buttons-grid .server-button:hover .server-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-10px);
        }

        .server-buttons-grid > button:active,
        .server-buttons-grid .server-button:active {
            transform: translateY(0) scale(1);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
        }

        .server-tooltip {
            position: absolute;
            bottom: 82px;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 99999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .server-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .server-buttons-grid > button.connecting,
        .server-buttons-grid .server-button.connecting {
            background: linear-gradient(135deg, #ffb347 0%, #ff9a56 50%, #ff6b6b 100%);
            cursor: not-allowed;
            color: white;
        }

        .server-buttons-grid > button.connected,
        .server-buttons-grid .server-button.connected {
            background: radial-gradient(circle at 30% 30%, #b4ff4a 0%, #89fc23 40%, #6fd100 100%);
            box-shadow: 0 4px 20px rgba(137, 252, 35, 0.6), 
                        0 0 30px rgba(137, 252, 35, 0.4),
                        inset 0 2px 10px rgba(255, 255, 255, 0.3);
            opacity: 1;
            filter: none;
            animation: pulseGreen 2s ease-in-out infinite;
        }

        .server-buttons-grid > button.connected::before {
            background: repeating-conic-gradient(from 0deg, rgba(137, 252, 35, 0.9) 0deg 30deg, rgba(180, 255, 74, 0.9) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(111, 209, 0, 0.9) 0deg 20deg, rgba(137, 252, 35, 0.9) 40deg 60deg, transparent 90deg);
            animation: rotate 6s linear infinite, glowGreen 2s ease-in-out infinite;
        }

        @keyframes pulseGreen {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(137, 252, 35, 0.6), 
                            0 0 30px rgba(137, 252, 35, 0.4),
                            inset 0 2px 10px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 4px 25px rgba(137, 252, 35, 0.8), 
                            0 0 40px rgba(137, 252, 35, 0.6),
                            inset 0 2px 10px rgba(255, 255, 255, 0.4);
            }
        }

        @keyframes glowGreen {
            0%, 100% {
                opacity: 0.6;
            }
            50% {
                opacity: 0.9;
            }
        }

        .server-buttons-grid > button.disconnected,
        .server-buttons-grid .server-button.disconnected {
            background: radial-gradient(circle at 30% 30%, #ff4d4d 0%, #f70707 40%, #cc0000 100%);
            box-shadow: 0 4px 20px rgba(247, 7, 7, 0.5), 
                        0 0 30px rgba(247, 7, 7, 0.3),
                        inset 0 2px 10px rgba(255, 255, 255, 0.2);
            position: relative;
            padding-right: 80px;
            animation: pulseRed 2.5s ease-in-out infinite;
        }

        .server-buttons-grid > button.disconnected::before {
            background: repeating-conic-gradient(from 0deg, rgba(247, 7, 7, 0.8) 0deg 30deg, rgba(255, 77, 77, 0.8) 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, rgba(204, 0, 0, 0.8) 0deg 20deg, rgba(247, 7, 7, 0.8) 40deg 60deg, transparent 90deg);
            animation: rotate 8s linear infinite, glowRed 2.5s ease-in-out infinite;
        }

        @keyframes pulseRed {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(247, 7, 7, 0.5), 
                            0 0 30px rgba(247, 7, 7, 0.3),
                            inset 0 2px 10px rgba(255, 255, 255, 0.2);
            }
            50% {
                box-shadow: 0 4px 25px rgba(247, 7, 7, 0.7), 
                            0 0 35px rgba(247, 7, 7, 0.5),
                            inset 0 2px 10px rgba(255, 255, 255, 0.3);
            }
        }

        @keyframes glowRed {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 0.8;
            }
        }

        .server-buttons-grid > button.disconnected .server-action-btn,
        .server-buttons-grid .server-button.disconnected .server-action-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .auto-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 99999;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .auto-toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .auto-toast-success {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
        }

        .auto-toast-info {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
        }

        .auto-toast-error {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
        }

        .server-buttons-grid .server-button-name {
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 6px rgba(0,0,0,0.25);
            margin-bottom: 0;
        }

        .server-buttons-grid > button.connecting .server-button-name,
        .server-buttons-grid .server-button.connecting .server-button-name,
        .server-buttons-grid > button.connected .server-button-name,
        .server-buttons-grid .server-button.connected .server-button-name,
        .server-buttons-grid > button.disconnected .server-button-name,
        .server-buttons-grid .server-button.disconnected .server-button-name {
            color: white;
        }

        .server-buttons-grid .server-button-url {
            display: none;
        }

        .server-buttons-grid > button.connecting .server-button-url,
        .server-buttons-grid .server-button.connecting .server-button-url {
            display: none;
        }

        .server-status-section {
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .server-status-header {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .server-status-header .count {
            font-size: 14px;
            color: rgba(47, 47, 47, 0.7);
            font-weight: 600;
        }

        .server-status-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, var(--border-dark) 20%, var(--border-dark) 80%, transparent 100%);
            margin: 25px 0;
            border-radius: 2px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            margin-left: auto;
        }

        .status-badge.online {
            background: #c8e6c9;
            color: #2e7d32;
            border: 2px solid #81c784;
        }

        .status-badge.offline {
            background: #ffcdd2;
            color: #c62828;
            border: 2px solid #e57373;
        }

        .server-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .server-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .server-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .server-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .server-dot.online {
            background: #4CAF50;
            box-shadow: 0 0 8px #4CAF50;
        }

        .server-dot.offline {
            background: #f44336;
            box-shadow: 0 0 8px #f44336;
        }

        .server-info {
            flex: 1;
        }

        .server-name {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .server-url {
            font-size: 11px;
            color: rgba(47, 47, 47, 0.6);
            margin-top: 2px;
        }

        .server-action-btn {
            padding: 6px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .server-action-btn.connect {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .server-action-btn.connect:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(250, 112, 154, 0.5);
        }

        .server-action-btn.reconnect {
            background: linear-gradient(135deg, #ff9a9a 0%, #ff6b6b 50%, #ee5a24 100%);
            color: white;
        }

        .server-action-btn.reconnect:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #c62828 100%);
            transform: translateX(3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5);
        }
        /*#endregion */

        /*#region ÁÆ°ÁêÜÂëòË¥¶Êà∑ÁÆ°ÁêÜÊ†∑Âºè */
        .admin-account-section {
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 50%, #c5ffc1 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .admin-account-section h3 {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .admin-account-form-row {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .admin-account-input-group {
            flex: 1;
            min-width: 0;
        }

        .admin-account-input-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .admin-account-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            outline: none;
            box-sizing: border-box;
        }

        .admin-account-input:focus {
            border-color: #8B00FF;
            box-shadow: 0 0 0 3px rgba(139, 0, 255, 0.15);
        }

        .admin-account-btn {
            flex: none;
            padding: 8px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .admin-account-btn.cancel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            color: var(--text-dark);
        }

        .admin-account-btn.cancel:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .admin-account-btn.confirm {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .admin-account-btn.confirm:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            border-color: #0a0909;
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }

        .admin-account-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .admin-account-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .admin-account-name {
            min-width: 100px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-account-badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff5722 0%, #ff6f00 50%, #ff9800 100%);
            border: 2px solid var(--border-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(255, 87, 34, 0.4);
        }

        .admin-account-actions {
            display: flex;
            gap: 5px;
        }

        .admin-account-action-btn {
            padding: 4px 10px;
            border: 2px solid var(--border-dark);
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .admin-account-action-btn.edit {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .admin-account-action-btn.edit:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            transform: translateX(3px) scale(1.05);
        }

        .admin-account-action-btn.delete {
            background: linear-gradient(135deg, #ff9a9a 0%, #ff6b6b 50%, #ee5a24 100%);
            color: white;
        }

        .admin-account-action-btn.delete:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #c62828 100%);
            transform: translateX(3px) scale(1.05);
        }

        .admin-account-action-btn.manage {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .admin-account-action-btn.manage:hover {
            background: linear-gradient(20deg, #d0fcc4 0%, #2eef68 50%, #02ff0a 100%);
            transform: translateX(3px) scale(1.05);
        }
        /*#endregion */

        /*#region ÁÆ°ÁêÜÂëòÊùÉÈôêÂºπÁ™óÊ†∑Âºè */
        .admin-manage-modal {
            width: 600px;
            max-width: 90vw;
        }

        .admin-manage-content {
            padding: 20px;
        }

        .admin-manage-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
        }

        .admin-manage-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .admin-manage-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .admin-manage-info-label {
            min-width: 60px;
        }

        .admin-manage-actions {
            display: flex;
            gap: 10px;
        }

        .admin-manage-permission-row {
            margin-bottom: 20px;
        }

        .admin-manage-permission-label {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .admin-manage-user-count {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .admin-manage-user-count input {
            width: 100px;
            padding: 8px 12px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.9);
        }

        .admin-manage-servers-label {
            font-size: 13px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .admin-manage-servers-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 15px;
            justify-content: flex-start;
        }

        .admin-manage-server-btn {
            flex: none;
            width: 50px;
            height: 50px;
            min-width: 50px;
            max-width: 50px;
            padding: 0;
            border: none;
            border-radius: 50%;
            background: radial-gradient(circle at top left, #ff0 0%, transparent 50%),
                        radial-gradient(circle at bottom right, #ff0 0%, transparent 60%);
            cursor: pointer;
            transition: all 2s ease;
            filter: blur(1px);
            opacity: 0.3;
            box-shadow: 0 0 25px rgba(255,255,0,0.2);
            text-align: center;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 11px;
            position: relative;
            overflow: visible;
            white-space: nowrap;
            text-overflow: ellipsis;
            z-index: 1;
        }

        .admin-manage-server-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: repeating-conic-gradient(from 0deg, #ff0 0deg 30deg, #0f0 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, #ff0 0deg 20deg, #0f0 40deg 60deg, transparent 90deg);
            background-size: 200% 200%;
            opacity: 0.4;
            filter: blur(8px);
            animation: rotate 20s linear infinite paused;
            transition: opacity 2s ease;
            z-index: -1;
        }

        .admin-manage-server-btn::after {
            content: '';
            position: absolute;
            inset: 10%;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff0, #0f0, #0ff);
            opacity: 0.15;
            filter: blur(12px);
            z-index: -2;
        }

        .admin-manage-server-btn.active {
            opacity: 1;
            background: radial-gradient(circle at top left, #0f0 0%, transparent 50%),
                        radial-gradient(circle at bottom right, #0f0 0%, transparent 60%);
            box-shadow: 0 0 50px #0f0;
            transform: scale(1.08);
            filter: blur(0.5px);
        }

        .admin-manage-server-btn.active::before {
            opacity: 0.9;
            background: repeating-conic-gradient(from 0deg, #0f0 0deg 30deg, #0ff 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, #0f0 0deg 20deg, #0ff 40deg 60deg, transparent 90deg);
            animation-play-state: running;
        }

        .admin-manage-server-btn.active::after {
            background: linear-gradient(135deg, #0f0, #00f, #0ff);
            opacity: 0.3;
        }

        .admin-manage-server-btn:hover {
            opacity: 0.6;
        }

        .admin-manage-server-btn.selected {
            opacity: 1;
            background: radial-gradient(circle at top left, #0f0 0%, transparent 50%),
                        radial-gradient(circle at bottom right, #0f0 0%, transparent 60%);
            box-shadow: 0 0 50px #0f0;
            transform: scale(1.08);
            filter: blur(0.5px);
        }

        .admin-manage-server-btn.selected::before {
            opacity: 0.9;
            background: repeating-conic-gradient(from 0deg, #0f0 0deg 30deg, #0ff 60deg 90deg, transparent 120deg),
                        repeating-conic-gradient(from 45deg, #0f0 0deg 20deg, #0ff 40deg 60deg, transparent 90deg);
            animation-play-state: running;
        }

        .admin-manage-server-btn.selected::after {
            background: linear-gradient(135deg, #0f0, #00f, #0ff);
            opacity: 0.3;
        }

        .admin-manage-footer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .admin-manage-footer-btn {
            flex: 1;
            padding: 10px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .admin-manage-footer-btn.reset {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            color: var(--text-dark);
        }

        .admin-manage-footer-btn.select-all {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            color: var(--text-dark);
        }

        .admin-manage-footer-btn.confirm {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #666bff 100%);
            color: white;
        }

        .admin-manage-footer-btn:hover {
            transform: translateX(5px) scale(1.08);
            box-shadow: 0 6px 15px rgba(250, 112, 154, 0.5);
        }
        /*#endregion */

        /*#region ÂàÜÁªÑÁÆ°ÁêÜÊ†∑Âºè */
        .admin-group-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffb347 100%);
            border-radius: 18px;
            border: 3px solid var(--border-dark);
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .admin-group-section h3 {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        .group-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .group-card {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--border-dark);
            border-radius: 14px;
            padding: 15px 20px;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .group-name {
            font-size: 15px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .group-name.public {
            color: #2196F3;
        }

        .group-name.private {
            color: #9C27B0;
        }

        .group-count {
            font-size: 12px;
            color: rgba(47, 47, 47, 0.6);
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 10px;
        }

        .group-servers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .group-server-tag {
            padding: 6px 12px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #64b5f6;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: #1565c0;
            cursor: move;
            transition: all 0.3s ease;
        }

        .group-server-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(100, 181, 246, 0.4);
        }

        .group-server-tag.private {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border-color: #ba68c8;
            color: #7b1fa2;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: rgba(47, 47, 47, 0.5);
            font-size: 14px;
            font-weight: 600;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #a8c8ff 0%, #ff9aa2 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8bb5ff 0%, #ff7a8a 100%);
        }
        /*#endregion */

        /*#region ÁôªÂΩïÈ°µÈù¢ÂìçÂ∫îÂºèÊ†∑Âºè */
        @media (max-width: 768px) {
            .login-panel {
                width: 90%;
                max-width: 400px;
            }

            .modal-panel {
                width: 90%;
                max-width: 360px;
            }

            .admin-status-section {
                grid-template-columns: 1fr;
            }

            .admin-form-row {
                flex-direction: column;
            }

            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        /*#endregion */

        /*#region È°µÈù¢ÂàáÊç¢Âä®Áîª */
        .admin-page.show {
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .server-buttons-grid > div {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .server-buttons-grid > div::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            transform: translateX(-100%);
        }

        .server-buttons-grid > div:hover::after {
            animation: shine 1.5s ease-in-out infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .server-status-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .server-status-badge.online {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            animation: pulseOnline 2s infinite;
        }

        .server-status-badge.offline {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
        }

        .server-status-badge.connecting {
            background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%);
            animation: pulseConnecting 1.5s infinite;
        }

        @keyframes pulseOnline {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }

        @keyframes pulseConnecting {
            0% { box-shadow: 0 0 0 0 rgba(255, 170, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 170, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 170, 0, 0); }
        }

        .manager-page.show {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .user-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            animation: fadeIn 0.6s ease-out;
        }

        .user-button {
            transform-origin: center;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .user-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .user-button-content {
            position: relative;
            z-index: 2;
        }

        .user-server-count-badge {
            position: relative;
            overflow: hidden;
        }

        .user-server-count-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.4) 50%,
                transparent 70%
            );
            animation: badgeShine 3s infinite linear;
        }

        @keyframes badgeShine {
            0% { transform: rotate(0deg) translate(-50%, -50%); }
            100% { transform: rotate(360deg) translate(-50%, -50%); }
        }

        .server-buttons-grid-new {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .server-buttons-grid-new > div {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .server-buttons-grid-new > div::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .server-buttons-grid-new > div:hover::before {
            transform: translateX(0);
        }

        .server-buttons-grid-new > div.selected {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        /*#endregion */

        /*#region ÁªüËÆ°Âç°ÁâáÂíåÊï∞ÊçÆË°®Ê†ºÊ†∑Âºè */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg,
                rgba(255, 214, 231, 0.3) 0%,
                rgba(193, 240, 255, 0.3) 50%,
                rgba(197, 255, 193, 0.3) 100%);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.05) 50%,
                transparent 100%);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-card-icon {
            font-size: 24px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 900;
            color: var(--text-dark);
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-card-label {
            font-size: 13px;
            color: rgba(47, 47, 47, 0.7);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table-container {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.25) 0%,
                rgba(255, 255, 255, 0.15) 100%);
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            overflow: hidden;
            margin: 20px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            color: white;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .search-filter-area {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.25) 0%,
                rgba(255, 255, 255, 0.15) 100%);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            backdrop-filter: blur(20px);
        }

        .search-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid rgba(47, 47, 47, 0.3);
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: rgba(139, 0, 255, 0.6);
            box-shadow: 0 0 0 4px rgba(139, 0, 255, 0.15);
            background: rgba(255, 255, 255, 1);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 18px;
            border: 2px solid var(--border-dark);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .filter-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .filter-btn span {
            position: relative;
            z-index: 2;
        }

        .filter-btn.active {
            color: white;
            border-color: rgba(102, 126, 234, 0.8);
        }

        .filter-btn.active::before {
            opacity: 1;
        }

        .filter-btn:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 70px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .action-btn.edit {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .action-btn.delete {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .action-btn.view {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        /*#endregion */

        /*#region Âä†ËΩΩÁä∂ÊÄÅÂíåÁ©∫Áä∂ÊÄÅÊ†∑Âºè */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(47, 47, 47, 0.5);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 14px;
            opacity: 0.7;
        }
        /*#endregion */

        /*#region ÂàÜÈ°µÁªÑ‰ª∂Ê†∑Âºè */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid rgba(47, 47, 47, 0.1);
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-dark);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pagination-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .pagination-btn span {
            position: relative;
            z-index: 2;
        }

        .pagination-btn.active {
            color: white;
        }

        .pagination-btn.active::before {
            opacity: 1;
        }

        .pagination-btn:hover:not(.disabled):not(.active) {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .pagination-ellipsis {
            color: rgba(47, 47, 47, 0.5);
            font-weight: bold;
            padding: 0 10px;
        }
        /*#endregion */

        /*#region Áî®Êà∑ËØ¶ÊÉÖÈù¢ÊùøÊ†∑Âºè */
        .user-detail-panel {
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .user-detail-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .user-detail-stat-card {
            padding: 15px;
            background: linear-gradient(135deg,
                rgba(139, 0, 255, 0.1) 0%,
                rgba(139, 0, 255, 0.05) 100%);
            border-radius: 12px;
            border: 2px solid rgba(139, 0, 255, 0.2);
            transition: all 0.3s ease;
        }

        .user-detail-stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 0, 255, 0.15);
        }

        .user-detail-stat-label {
            font-size: 12px;
            color: rgba(47, 47, 47, 0.6);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-detail-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--text-dark);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tag {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .tag-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: #c3e6cb;
        }

        .tag-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-color: #ffeaa7;
        }

        .tag-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-color: #f5c6cb;
        }

        .tag-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border-color: #bee5eb;
        }

        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        /*#endregion */

        /*#region ÁÆ°ÁêÜÈ°µÈù¢ÂìçÂ∫îÂºèÊ†∑Âºè */
        @media (max-width: 1024px) {
            .user-buttons-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .server-buttons-grid-new {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .server-manager-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .server-add-row {
                flex-direction: column;
            }

            .server-input-group {
                width: 100%;
            }

            .user-buttons-grid {
                grid-template-columns: 1fr;
            }

            .server-buttons-grid-new {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .data-table-container {
                overflow-x: auto;
            }

            .data-table {
                min-width: 600px;
            }

            .search-input-group {
                flex-direction: column;
            }

            .search-input {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .manager-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .server-buttons-grid-new {
                grid-template-columns: 1fr;
            }

            .filter-buttons {
                justify-content: center;
            }

            .action-buttons {
                justify-content: center;
            }

            .pagination {
                flex-wrap: wrap;
            }
        }
        /*#endregion */

        /*#region ÊªöÂä®Êù°Ëá™ÂÆö‰πâÊ†∑Âºè */
        .admin-page::-webkit-scrollbar,
        .manager-page::-webkit-scrollbar {
            width: 10px;
        }

        .admin-page::-webkit-scrollbar-track,
        .manager-page::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .admin-page::-webkit-scrollbar-thumb,
        .manager-page::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .admin-page::-webkit-scrollbar-thumb:hover,
        .manager-page::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4299 100%);
        }
        /*#endregion */

        /*#region Â∑•ÂÖ∑ÊèêÁ§∫Âíå‰∫§‰∫íÂä®Áîª */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 99999;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .server-buttons-grid > div:hover .tooltip,
        .user-button:hover .tooltip {
            opacity: 1;
            transform: translateY(0);
        }

        .user-button {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .user-button:nth-child(1) { animation-delay: 0.1s; }
        .user-button:nth-child(2) { animation-delay: 0.2s; }
        .user-button:nth-child(3) { animation-delay: 0.3s; }
        .user-button:nth-child(4) { animation-delay: 0.4s; }
        .user-button:nth-child(5) { animation-delay: 0.5s; }
        .user-button:nth-child(6) { animation-delay: 0.6s; }
        .user-button:nth-child(7) { animation-delay: 0.7s; }
        .user-button:nth-child(8) { animation-delay: 0.8s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-transition-enter {
            opacity: 0;
            transform: translateX(30px);
        }

        .page-transition-enter-active {
            opacity: 1;
            transform: translateX(0);
            transition: opacity 0.4s, transform 0.4s;
        }

        .page-transition-exit {
            opacity: 1;
            transform: translateX(0);
        }

        .page-transition-exit-active {
            opacity: 0;
            transform: translateX(-30px);
            transition: opacity 0.4s, transform 0.4s;
        }

        .skeleton {
            background: linear-gradient(90deg,
                rgba(255, 255, 255, 0.1) 25%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.1) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            height: 120px;
            border-radius: 16px;
            margin-bottom: 15px;
        }

        .skeleton-text {
            height: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .skeleton-text.short {
            width: 60%;
        }
        /*#endregion */

        /*#region ÊåâÈíÆÂíåÈÄöÁü•Âä®Êïà */
        .button-press {
            animation: buttonPress 0.2s ease;
        }

        @keyframes buttonPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            padding: 0 6px;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
            animation: bounce 2s infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        /*#endregion */

        /*#region Âç°ÁâáÁøªËΩ¨ÊïàÊûú */
        .flip-card {
            perspective: 1000px;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .flip-card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .user-button.flip-card {
            height: 120px;
        }

        /*#endregion */

    </style>
</head>

<body>
    <!--#region ÁôªÂΩïÈ°µÈù¢ HTML -->

    <div class="login-page" id="loginPage" style="display: flex;">
        <!-- Âè≥‰∏äËßíÊúçÂä°Âô®ÁÆ°ÁêÜÂÖ•Âè£ÔºàÁã¨Á´ãÂäüËÉΩÔºåÈúÄË¶ÅÁÆ°ÁêÜÂëòÂØÜÁ†ÅÈ™åËØÅÔºâ -->
        <button class="admin-entry-btn" onclick="showAdminModal()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
            </svg>
            ÊúçÂä°Âô®ÁÆ°ÁêÜ
        </button>

        <!-- Ê†áÈ¢òÂå∫Âüü -->
        <div class="login-title-area">
            <div class="login-main-title">AutoSender Pro</div>
            <div class="login-main-subtitle">IMessage sender</div>
        </div>

        <!-- ÁôªÂΩïÈù¢Êùø -->
        <div class="login-panel" id="loginPanel">
            <div class="login-panel-header">
                <h1 class="login-logo">Áî®Êà∑ÁôªÂΩï</h1>
            </div>

            <div class="login-panel-content">
                <!-- Admin ÂàáÊç¢ÊåâÈíÆ -->
                <div class="user-admin-toggle">
                    <button class="toggle-btn btn-admin" id="adminToggle" onclick="switchToAdmin()">Admin</button>
                </div>

                <!-- Áî®Êà∑ÁôªÂΩïË°®Âçï -->
                <div id="userLoginForm">
                    <form novalidate onsubmit="handleLogin(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="loginUsername" placeholder="Áî®Êà∑Âêç" autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="loginPassword" placeholder="ÂØÜÁ†Å"
                                       autocomplete="current-password">
                                <button type="button" class="show-password-btn"
                                        onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="forgot-password">
                            <a href="#" class="forgot-password-link"
                               onclick="handleForgotPassword(); return false;">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</a>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary btn-register" onclick="showRegister()">Ê≥®ÂÜå</button>
                            <button type="submit" class="btn-primary">ÁôªÂΩï</button>
                        </div>
                    </form>
                </div>

                <!-- ÁÆ°ÁêÜÂëòÁôªÂΩïË°®Âçï -->
                <div id="adminLoginForm" style="display: none;">
                    <form novalidate onsubmit="handleAdminLogin(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="adminLoginUsername" placeholder="ÁÆ°ÁêÜÂëòÁî®Êà∑Âêç" autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="adminLoginPassword" placeholder="ÁÆ°ÁêÜÂëòÂØÜÁ†Å"
                                       autocomplete="current-password">
                                <button type="button" class="show-password-btn"
                                        onclick="togglePassword('adminLoginPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="forgot-password" style="visibility: hidden;">
                            <a href="#" class="forgot-password-link">Âç†‰Ωç</a>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary" onclick="switchToUser()">ËøîÂõû</button>
                            <button type="submit" class="btn-primary">ÁôªÂΩï</button>
                        </div>
                    </form>
                </div>

                <!-- Ê≥®ÂÜåË°®Âçï -->
                <div id="registerForm" style="display: none;">
                    <form novalidate onsubmit="handleRegister(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="registerUsername" placeholder="ËØ∑ËÆæÁΩÆÁî®Êà∑Âêç" autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="registerPassword" placeholder="ËØ∑ËÆæÁΩÆÂØÜÁ†Å,Ëá≥Â∞ë4‰Ωç"
                                       autocomplete="new-password">
                                <button type="button" class="show-password-btn"
                                        onclick="togglePassword('registerPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="registerConfirmPassword" placeholder="ËØ∑Á°ÆËÆ§ÂØÜÁ†Å,Ëá≥Â∞ë4‰Ωç"
                                       autocomplete="new-password">
                                <button type="button" class="show-password-btn"
                                        onclick="togglePassword('registerConfirmPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary" onclick="showLogin()">ËøîÂõû</button>
                            <button type="submit" class="btn-primary">Á°ÆÂÆö</button>
                        </div>
                    </form>
                </div>

                <div class="message-box" id="authMessage"></div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region Ëá™ÂÆö‰πâÂºπÁ™ó HTML -->

    <div class="custom-modal-overlay" id="customModal">
        <div class="custom-modal-panel" id="customModalPanel">
            <div class="custom-modal-header">
                <span class="custom-modal-title" id="customModalTitle">ÊèêÁ§∫</span>
                <button class="custom-modal-close" onclick="closeCustomModal()">√ó</button>
            </div>
            <div class="custom-modal-content" id="customModalContent">
                <div class="custom-modal-message" id="customModalMessage"></div>
                <input type="text" class="custom-modal-input" id="customModalInput" style="display: none;"
                    placeholder="">
                <div class="custom-modal-buttons" id="customModalButtons">
                    <!-- Âä®ÊÄÅÁîüÊàêÊåâÈíÆ -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÂºπÁ™ó HTML -->

    <div class="modal-overlay" id="adminModal">
        <div class="modal-panel">
            <div class="modal-header">
                <span class="modal-title">
                    <svg viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">
                        <path
                            d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                    </svg>
                    ÊúçÂä°Âô®ÁÆ°ÁêÜ
                </span>
                <button class="modal-close" onclick="closeAdminModal()">√ó</button>
            </div>
            <div class="modal-content">
                <form onsubmit="event.preventDefault(); verifyAdminPassword();" autocomplete="off">
                    <label class="modal-label">ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔºö</label>
                    <input type="password" class="modal-input" id="adminPasswordInput" placeholder="ÁÆ°ÁêÜÂëòÂØÜÁ†Å" autocomplete="current-password">
                    <button type="submit" class="modal-btn">Á°Æ ËÆ§</button>
                    <div class="modal-message" id="adminMessage"></div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region ÊúçÂä°Âô®ÁÆ°ÁêÜÂØÜÁ†Å‰øÆÊîπÂºπÁ™ó HTML -->

    <div class="custom-modal-overlay" id="passwordChangeModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">üîê ÊúçÂä°Âô®ÁÆ°ÁêÜÂØÜÁ†ÅËÆæÁΩÆ</span>
                <button class="custom-modal-close" onclick="closePasswordChangeModal()">√ó</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); updateServerManagerPassword();" autocomplete="off">
                    <input type="password" class="custom-modal-input" id="oldPasswordInput" placeholder="ËØ∑ËæìÂÖ•ÊóßÂØÜÁ†Å" autocomplete="current-password">
                    <input type="password" class="custom-modal-input" id="newPasswordInput" placeholder="Êñ∞ÂØÜÁ†Å" autocomplete="new-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel" onclick="closePasswordChangeModal()">ÂèñÊ∂à</button>
                        <button type="submit" class="custom-modal-btn confirm">Á°ÆÂÆö</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region IDÂ∫ìÈù¢Êùø HTML -->
    <div class="custom-modal-overlay" id="idLibraryModal" style="display: none;">
        <div class="custom-modal-panel id-library-panel">
            <div class="custom-modal-header id-library-header">
                <span class="custom-modal-title">üìã IDÂ∫ì - Ë¥¶Âè∑ÁÆ°ÁêÜ</span>
                <button class="custom-modal-close" onclick="closeIdLibraryModal()">√ó</button>
            </div>
            <div class="custom-modal-content id-library-content">
                <!-- È°∂ÈÉ®Êìç‰ΩúÊ†è -->
                <form onsubmit="event.preventDefault(); saveIdLibraryAccount();" autocomplete="off">
                    <div class="id-library-toolbar">
                        <div class="id-library-input-group">
                            <label>APPLE ID</label>
                            <input type="text" class="id-library-input" id="idLibraryAppleId" placeholder="ËæìÂÖ•Apple IDÈÇÆÁÆ±" autocomplete="username">
                        </div>
                        <div class="id-library-input-group">
                            <label>PASSWORD</label>
                            <div class="password-input-wrapper">
                                <input type="password" class="id-library-input" id="idLibraryPassword" placeholder="ËæìÂÖ•ÂØÜÁ†Å" autocomplete="current-password">
                                <button type="button" class="password-toggle-btn" onclick="toggleIdLibraryPassword()">üëÅ</button>
                            </div>
                        </div>
                        <button type="submit" class="id-library-btn btn-save">üíæ ‰øùÂ≠ò</button>
                        <button type="button" class="id-library-btn btn-import" onclick="importIdLibraryAccounts()">üìÇ ÂØºÂÖ•</button>
                        <button type="button" class="id-library-btn btn-clear" onclick="clearAllIdLibraryAccounts()">üóëÔ∏è Ê∏ÖÁ©∫</button>
                    </div>
                </form>

                <!-- Ë¥¶Âè∑ÂàóË°®Âå∫Âüü -->
                <div class="id-library-list-container">
                    <div class="id-library-list-header">
                        <span class="header-col col-index">#</span>
                        <span class="header-col col-account">Ë¥¶Âè∑</span>
                        <span class="header-col col-password">ÂØÜÁ†Å</span>
                        <span class="header-col col-status">Áä∂ÊÄÅ</span>
                        <span class="header-col col-usage-status">‰ΩøÁî®Áä∂ÊÄÅ</span>
                        <span class="header-col col-actions">Êìç‰Ωú</span>
                    </div>
                    <div class="id-library-list" id="idLibraryList">
                        <!-- Ë¥¶Âè∑ÂàóË°®È°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                        <div class="id-library-empty">
                            <div class="empty-icon">üì≠</div>
                            <div class="empty-text">ÊöÇÊó†Ë¥¶Âè∑</div>
                            <div class="empty-hint">ÁÇπÂáª"‰øùÂ≠ò"Ê∑ªÂä†Ë¥¶Âè∑ÔºåÊàñ"ÂØºÂÖ•"ÊâπÈáèÂØºÂÖ•</div>
                        </div>
                    </div>
                </div>

                <!-- Â∫ïÈÉ®ÁªüËÆ°Ê†è -->
                <div class="id-library-footer">
                    <div class="id-library-stats">
                        <span class="stat-item">ÊÄªÊï∞: <strong id="idLibraryTotal">0</strong></span>
                        <span class="stat-item">Ê≠£Â∏∏: <strong id="idLibraryNormal" style="color: #00d4aa;">0</strong></span>
                        <span class="stat-item">ÂºÇÂ∏∏: <strong id="idLibraryError" style="color: #ff6b6b;">0</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->

    <!--#region ÁßØÂàÜÂÖÖÂÄºÈù¢Êùø HTML -->

    <div class="custom-modal-overlay" id="rechargeModal" style="display: none;">
        <div class="custom-modal-panel" style="width: 70%; max-width: 800px; height: 85vh; max-height: 85vh; overflow-y: auto;">
            <div class="custom-modal-header">
                <span class="custom-modal-title">üí∞ ÁßØÂàÜÂÖÖÂÄº</span>
                <button class="custom-modal-close" onclick="closeRechargeModal()">√ó</button>
            </div>
            <div class="custom-modal-content" style="padding: 20px; display: flex; flex-direction: column; height: calc(85vh - 100px);">
                <!-- Á¨¨‰∏ÄË°åÔºöÁî®Êà∑ÂêçËæìÂÖ•„ÄÅÈ™åËØÅÊåâÈíÆ„ÄÅÂÖÖÂÄºËæìÂÖ•„ÄÅÁ°ÆÂÆöÊåâÈíÆ -->
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px; flex-wrap: wrap; height: 40px;">
                    <div style="display: flex; align-items: center; gap: 8px; height: 36px;">
                        <label style="font-weight: bold; white-space: nowrap; font-size: 14px; line-height: 36px;">Áî®Êà∑Âêç:</label>
                        <input type="text" class="custom-modal-input" id="rechargeUserIdInput" placeholder="ËæìÂÖ•Áî®Êà∑Ê≥®ÂÜåÁöÑÁî®Êà∑Âêç" style="width: 200px; height: 36px; box-sizing: border-box;">
                        <button class="custom-modal-btn" onclick="verifyRechargeUser()" style="white-space: nowrap; padding: 0 15px; height: 36px; line-height: 36px;">È™åËØÅ</button>
                    </div>
                    <div style="width: 1px; height: 24px; background: #ddd;"></div>
                    <div style="display: flex; align-items: center; gap: 8px; height: 36px;">
                        <label style="font-weight: bold; white-space: nowrap; font-size: 14px; line-height: 36px;">ÂÖÖÂÄº:</label>
                        <input type="number" class="custom-modal-input" id="rechargeAmountInput" placeholder="ÈáëÈ¢ù" style="width: 100px; height: 36px; box-sizing: border-box;" min="0.01" step="0.01">
                        <button class="custom-modal-btn confirm" onclick="confirmRecharge()" style="white-space: nowrap; padding: 0 15px; height: 36px; line-height: 36px;">Á°ÆÂÆö</button>
                    </div>
                </div>

                <!-- Á¨¨‰∫åË°åÔºöÁî®Êà∑‰ø°ÊÅØÊòæÁ§∫Âå∫ÂüüÔºàÂõ∫ÂÆöÈ´òÂ∫¶Ôºå‰∏§Ë°åÂ∏ÉÂ±ÄÔºâ -->
                <div id="rechargeUserInfo" style="display: none; padding: 15px; background: #f5f5f5; border-radius: 8px; margin-bottom: 15px; height: 120px; border: 1px solid #ddd; overflow: hidden;">
                    <!-- Á¨¨‰∏ÄË°åÔºöÁî®Êà∑ID„ÄÅÁî®Êà∑ÁºñÂè∑„ÄÅÊ≥®ÂÜåÊó∂Èó¥ -->
                    <div style="display: flex; gap: 30px; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">Áî®Êà∑ID:</strong>
                            <span id="rechargeInfoUserId" style="color: #333; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">Áî®Êà∑ÁºñÂè∑:</strong>
                            <span id="rechargeInfoUsername" style="color: #333; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">Ê≥®ÂÜåÊó∂Èó¥:</strong>
                            <span id="rechargeInfoCreated" style="color: #333; font-size: 14px;">-</span>
                        </div>
                    </div>
                    <!-- Á¨¨‰∫åË°åÔºö‰ΩôÈ¢ù„ÄÅ‰∏äÊ¨°ÂÖÖÂÄº„ÄÅÊÄªÊ∂àË¥π -->
                    <div style="display: flex; gap: 30px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">‰ΩôÈ¢ù:</strong>
                            <span id="rechargeInfoCredits" style="color: #4CAF50; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">‰∏äÊ¨°ÂÖÖÂÄº:</strong>
                            <span id="rechargeInfoLastRecharge" style="color: #333; font-size: 13px;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">ÊÄªÊ∂àË¥π:</strong>
                            <span id="rechargeInfoTotalSpent" style="color: #FF9800; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                    </div>
                </div>

                <!-- ÂÖÖÂÄºËÆ∞ÂΩïÂå∫Âüü -->
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333; font-size: 18px;">ÂÖÖÂÄºËÆ∞ÂΩï</h3>
                    <div id="rechargeRecordsList" style="background: white; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; max-height: 400px; overflow-y: auto;">
                        <div style="padding: 15px; text-align: center; color: #999;">ËØ∑ÂÖàÈ™åËØÅÁî®Êà∑‰ª•Êü•ÁúãÂÖÖÂÄºËÆ∞ÂΩï</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region Ê∑ªÂä†ÁÆ°ÁêÜÂëòÂºπÁ™ó HTML -->

    <div class="custom-modal-overlay" id="addAdminModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">üë§ Ê∑ªÂä†ÁÆ°ÁêÜÂëòË¥¶Âè∑</span>
                <button class="custom-modal-close" onclick="closeAddAdminModal()">√ó</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); addAdminAccount();" autocomplete="off">
                    <input type="text" class="custom-modal-input" id="newAdminId" placeholder="ÁÆ°ÁêÜÂëòID" autocomplete="username">
                    <input type="password" class="custom-modal-input" id="newAdminPassword" placeholder="ÂØÜÁ†Å" autocomplete="new-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel" onclick="closeAddAdminModal()">ÂèñÊ∂à</button>
                        <button type="submit" class="custom-modal-btn confirm">Á°ÆÂÆö</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region ÊúçÂä°Âô®ÁÆ°ÁêÜÈù¢Êùø HTML -->

    <div class="admin-page" id="adminPage">
        <div class="admin-container">
            <!-- Â§¥ÈÉ® -->
            <div class="server-manager-header">
                <h1>üîß Server Manager</h1>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="admin-back-btn btn-id-library" onclick="showIdLibraryModal()">üìã IDÂ∫ì</button>
                    <button class="admin-back-btn btn-recharge" onclick="showRechargeModal()">üí∞ ÂÖÖÂÄº</button>
                    <button class="admin-back-btn btn-password" onclick="showPasswordChangeModal()">‰øÆÊîπÁÆ°ÁêÜÂØÜÁ†Å</button>
                    <button class="admin-back-btn btn-exit" onclick="backToLogin()">‰øùÂ≠òÈÄÄÂá∫</button>
                </div>
            </div>

            <!-- Â∑≤ËøûÊé•ÂíåÂ∑≤Êñ≠ÂºÄÊúçÂä°Âô® -->
            <div class="server-status-section">
                <div class="server-status-header">
                    Â∑≤ËøûÊé• <span class="count" id="connectedCount">(0)</span>
                </div>
                <div class="server-buttons-grid" id="connectedServers">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>

                <div class="server-status-divider"></div>

                <div class="server-status-header">
                    Â∑≤Êñ≠ÂºÄ <span class="count" id="disconnectedCount">(0)</span>
                </div>
                <div class="server-buttons-grid" id="disconnectedServers">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>

            <!-- ÁÆ°ÁêÜÂëòË¥¶Êà∑ÁÆ°ÁêÜÔºàÁî®‰∫éÁôªÂΩïÁ™óÂè£ÁöÑÁÆ°ÁêÜÂëòË¥¶Âè∑Ôºâ -->
            <div class="admin-account-section">
                <h3>üë§ ÂàõÂª∫ÁÆ°ÁêÜÂëòË¥¶Âè∑</h3>
                <div style="margin-bottom: 15px;">
                    <button class="admin-account-btn confirm" onclick="showAddAdminModal()">Ê∑ªÂä†ÁÆ°ÁêÜÂëò</button>
                </div>
                <div class="admin-account-list" id="adminAccountList">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region ÁÆ°ÁêÜÂëòÈ°µÈù¢ HTML -->

    <div class="manager-page" id="managerPage">
        <div class="manager-container">
            <!-- Header -->
            <div class="manager-header">
                <button class="admin-back-btn password-setting-btn" onclick="showPasswordChangeModal()">‰øÆÊîπÂØÜÁ†Å</button>
                <button class="admin-back-btn" onclick="backToLoginFromManager()">‰øùÂ≠òÈÄÄÂá∫</button>
            </div>

            <!-- Èù¢Êùø1ÔºöÁÆ°ÁêÜÂëòÊï∞ÊçÆ -->
            <div class="manager-section" id="adminDataPanel">
                <div class="admin-data-row">
                    <div class="admin-data-item">
                        <span class="admin-data-label">ÁÆ°ÁêÜÂëò:</span>
                        <span class="admin-data-value" id="managerIdDisplay">-</span>
                    </div>
                    <div class="admin-data-item">
                        <span class="admin-data-label">ÁÆ°ÁêÜÁî®Êà∑Êï∞Èáè:</span>
                        <span class="admin-data-value" id="managerUserCountDisplay">0</span>
                    </div>
                    <div class="admin-data-item">
                        <span class="admin-data-label">ÊÄª‰∏öÁª©:</span>
                        <span class="admin-data-value" id="totalPerformanceDisplay">0</span>
                    </div>
                </div>
            </div>

            <!-- Èù¢Êùø2ÔºöÁî®Êà∑ÂàóË°® -->
            <div class="manager-section" id="userListPanel">
                <div class="panel-header-row">
                    <h3 class="panel-title">Áî®Êà∑ÂàóË°®</h3>
                    <button class="add-user-btn" onclick="showAddUserModal()">Ê∑ªÂä†Áî®Êà∑</button>
                </div>
                <div class="user-buttons-grid" id="userList">
                    <!-- Âä®ÊÄÅÁîüÊàêÁî®Êà∑ÊåâÈíÆ -->
                </div>
            </div>

            <!-- Èù¢Êùø3ÔºöÂèØÂàÜÈÖçÊúçÂä°Âô® -->
            <div class="manager-section" id="availableServersPanel">
                <h3 class="panel-title">ÂèØÂàÜÈÖçÊúçÂä°Âô®</h3>
                <div class="server-buttons-grid" id="managerAvailableServers">
                    <!-- Âä®ÊÄÅÁîüÊàêÊúçÂä°Âô®ÊåâÈíÆ -->
                </div>
            </div>
        </div>
    </div>
            <!--#region Ê∑ªÂä†Áî®Êà∑ÂºπÁ™ó HTML -->

            <div class="custom-modal-overlay" id="addUserModal">
                <div class="custom-modal-panel">
                    <div class="custom-modal-header">
                        <span class="custom-modal-title">üë§ Ê∑ªÂä†Áî®Êà∑</span>
                        <button class="custom-modal-close" onclick="closeAddUserModal()">√ó</button>
                    </div>
                    <div class="custom-modal-content">
                        <input type="text" class="custom-modal-input" id="addUserUsername" placeholder="Áî®Êà∑Âêç">
                        <input type="text" class="custom-modal-input" id="addUserUserId" placeholder="Áî®Êà∑ID">
                        <div class="custom-modal-buttons">
                            <button class="custom-modal-btn cancel" onclick="closeAddUserModal()">ÂèñÊ∂à</button>
                            <button class="custom-modal-btn confirm" onclick="confirmAddUser()">Á°ÆÂÆö</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--#endregion -->

            <!--#region Áî®Êà∑ËØ¶ÊÉÖÁÆ°ÁêÜÂºπÁ™ó HTML -->

            <div class="custom-modal-overlay" id="userDetailModal">
                <div class="custom-modal-panel user-detail-panel">
                    <div class="custom-modal-header">
                        <span class="custom-modal-title">üë§ Áî®Êà∑ËØ¶ÊÉÖ</span>
                        <button class="custom-modal-close" onclick="closeUserDetailModal()">√ó</button>
                    </div>
                    <div class="custom-modal-content user-detail-content" id="userDetailContent">
                        <!-- Âä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
            <!--#endregion -->

            <!--#endregion -->
    <!--#region ‰∏ªÂ∫îÁî®È°µÈù¢ HTML -->

    <div class="content-wrapper" style="display: none;">
        <!-- ÂØºËà™ÊåâÈíÆÊ†è -->
        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn active" id="navHomeBtn">‰∏ªÈ°µÈù¢</button>
                <button class="nav-btn" id="navAccountBtn">Ë¥¶Âè∑ÁÆ°ÁêÜ</button>
                <button class="nav-btn" id="navSendBtn">IMessage</button>
                <button class="nav-btn" id="navInboxBtn">Êî∂‰ª∂ÁÆ±
                    <div class="notification-count">0</div>
                </button>
                <button class="nav-btn" id="navLogoutBtn" onclick="handleLogout()">ÈÄÄÂá∫Ë¥¶Âè∑</button>
            </div>
        </div>
        <div class="main-container" style="display: none;">
            <!-- Â∑•‰ΩúÂå∫A+B -->
            <div class="workspace-ab" id="workspaceAB" style="display: none;">
                <!-- AÁâàÈù¢Êùø -->
                <div class="panel-a">
                    <div class="panel-header">
                        <span>AutoSender Pro</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="userInfoDisplay"
                                style="font-family: 'Xiaolai', sans-serif; font-size: 12px; color: var(--text-dark); display: none;">
                                <span id="currentUsername"></span> | ÁßØÂàÜ: <span id="currentCredits">-</span>
                            </span>
                            <div class="connection-status" id="connectionStatus"><span>ËøûÊé•‰∏≠...</span></div>
                        </div>
                    </div>

                    <div class="panel-content">
                        <div class="content-area">
                            <!-- Â∑¶‰æßÂè∑Á†ÅËæìÂÖ•Ê°Ü -->
                            <div class="numbers-container">
                                <div class="input-header">
                                    <div class="input-title">ÂèëÈÄÅÂè∑Á†Å</div>
                                    <div class="input-actions">
                                        <button class="btn-icon" id="importNumbersBtn" title="ÂØºÂÖ•">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon" id="clearNumbersBtn" title="Ê∏ÖÁ©∫">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="input-area">
                                    <textarea id="numbersText" placeholder="ËæìÂÖ•ÁõÆÊ†áÂè∑Á†ÅÔºåÊØèË°å‰∏Ä‰∏™"></textarea>
                                    <div class="char-count" id="numbersCount">Âè∑Á†Å: 0</div>
                                </div>
                                <!-- Âª∂ÈïøÊåâÈíÆ -->
                                <div class="anchor-trigger" id="numTrigger"></div>
                            </div>

                            <!-- Âè≥‰æßÊ∂àÊÅØËæìÂÖ•Ê°Ü -->
                            <div class="message-container">
                                <div class="input-header">
                                    <div class="input-title">ÂèëÈÄÅÂÜÖÂÆπ</div>
                                    <div class="input-actions">
                                        <button class="btn-icon" id="importMessageBtn" title="ÂØºÂÖ•">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon" id="clearMessageBtn" title="Ê∏ÖÁ©∫">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="input-area">
                                    <textarea id="messageText" placeholder="ËæìÂÖ•Ë¶ÅÂèëÈÄÅÁöÑÊ∂àÊÅØÂÜÖÂÆπ"></textarea>
                                    <div class="char-count" id="messageCount">Â≠óÁ¨¶: 0</div>
                                </div>
                            </div>
                        </div>

                        <div class="control-bar">
                            <button class="btn-log-panel" id="logPanelBtn">Êó•ÂøóÈù¢Êùø</button>
                            <!-- AÁâà‰∏≠ÁöÑÁªüËÆ°Ê†èÔºàÂΩìBÁâàÊú™ÊâìÂºÄÊó∂ÊòæÁ§∫Ôºâ -->
                            <div class="stats-bar-inline" id="statsBarInline">
                                <div class="stat-item">‰ªªÂä°Ê¨°Êï∞: <span class="stat-value" id="taskCountInline">0</span>
                                </div>
                                <div class="stat-item">ÊÄªÂè∑Á†Å: <span class="stat-value" id="phoneCountInline">0</span>
                                </div>
                                <div class="stat-item">ÊÄªÊï∞Èáè: <span class="stat-value" id="totalSentCountInline">0</span>
                                </div>
                                <div class="stat-item">ÊàêÂäü: <span class="stat-value" id="successCountInline">0</span>
                                </div>
                                <div class="stat-item">Â§±Ë¥•: <span class="stat-value" id="failCountInline">0</span></div>
                                <div class="stat-item">ÊàêÂäüÁéá: <span class="stat-value" id="successRateInline">0%</span>
                                </div>
                            </div>
                            <div class="interval-control">
                                <span class="interval-label">ÂèëÈÄÅÈó¥Èöî:</span>
                                <select class="interval-select" id="intervalInput">
                                    <option value="0.3">0.3s</option>
                                    <option value="0.7">0.7s</option>
                                    <option value="1.0" selected>1.0s</option>
                                    <option value="1.5">1.5s</option>
                                    <option value="2.0">2.0s</option>
                                </select>
                            </div>
                            <button class="btn-send" id="sendBtn">ÂèëÈÄÅ</button>
                        </div>
                    </div>
                </div>
                <!-- BÁâàÈù¢ÊùøÔºàÊ°åÈù¢Á´ØABÂπ∂ÊéíÔºâ -->
                <div class="panel-b desktop-only">
                    <div class="panel-header">
                        <span>‰ªªÂä°Êó•Âøó</span>
                    </div>
                    <div class="panel-content" style="position: relative;">
                        <div class="log-box" id="statusList">
                            <!-- Êó•ÂøóÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                        </div>
                        <!-- Ê∏ÖÁ©∫ÊåâÈíÆ - ÊîæÂú®Êó•ÂøóÂÆπÂô®Âè≥‰∏ãËßí -->
                        <button class="btn-clear-logs" id="clearLogsBtn" title="Ê∏ÖÁ©∫Êó•Âøó">Ê∏ÖÁ©∫</button>
                        <div class="stats-bar">
                            <div class="stat-item">‰ªªÂä°Ê¨°Êï∞: <span class="stat-value" id="taskCount">0</span></div>
                            <div class="stat-item">ÊÄªÂè∑Á†Å: <span class="stat-value" id="phoneCount">0</span></div>
                            <div class="stat-item">ÊÄªÊï∞Èáè: <span class="stat-value" id="totalSentCount">0</span></div>
                            <div class="stat-item">ÊàêÂäü: <span class="stat-value" id="successCount">0</span></div>
                            <div class="stat-item">Â§±Ë¥•: <span class="stat-value" id="failCount">0</span></div>
                            <div class="stat-item">ÊàêÂäüÁéá: <span class="stat-value" id="successRate">0%</span></div>
                        </div>
                        <!-- Âª∂ÈïøÊåâÈíÆ -->
                        <div class="anchor-trigger" id="logTrigger"></div>
                    </div>
                </div>
            </div>
            <!-- BÁâàÈù¢ÊùøÔºàÁßªÂä®Á´ØÁã¨Á´ãÊòæÁ§∫Ôºâ -->
            <div class="panel-b-mobile" id="panelB">
                <div class="panel-header">
                    <span>‰ªªÂä°Êó•Âøó</span>
                </div>
                <div class="panel-content">
                    <div class="log-box" id="statusListMobile">
                        <!-- Êó•ÂøóÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                    </div>
                    <div class="stats-bar">
                        <div class="stat-item">‰ªªÂä°Ê¨°Êï∞: <span class="stat-value" id="taskCountMobile">0</span></div>
                        <div class="stat-item">ÊÄªÂè∑Á†Å: <span class="stat-value" id="phoneCountMobile">0</span></div>
                        <div class="stat-item">ÊÄªÊï∞Èáè: <span class="stat-value" id="totalSentCountMobile">0</span></div>
                        <div class="stat-item">ÊàêÂäü: <span class="stat-value" id="successCountMobile">0</span></div>
                        <div class="stat-item">Â§±Ë¥•: <span class="stat-value" id="failCountMobile">0</span></div>
                        <div class="stat-item">ÊàêÂäüÁéá: <span class="stat-value" id="successRateMobile">0%</span></div>
                    </div>
                    <!-- Â∫ïÈÉ®ÊåâÈíÆÂå∫Âüü -->
                    <div class="panel-b-controls">
                        <button class="btn-back-to-send" id="backToSendBtn">IMessage</button>
                        <button class="btn-clear-logs-mobile" id="clearLogsBtnMobile" title="Ê∏ÖÁ©∫Êó•Âøó">Ê∏ÖÁ©∫</button>
                    </div>
                </div>
            </div>
            <!-- Á©∫ÁôΩÈù¢Êùø -->
            <div class="panel-d" id="panelD" style="display: none;">
                <div class="main-title">AutoSender Pro</div>
                <div class="main-subtitle">IMessage sender</div>
            </div>
            <!-- Êî∂‰ª∂ÁÆ±Èù¢Êùø -->
            <div class="panel-c" id="panelC" style="display: none;">
                <div class="panel-header">
                    <span>Êî∂‰ª∂ÁÆ±</span>
                    <span id="inboxStats"
                        style="font-family: 'Xiaolai', sans-serif; font-size: 13px; padding: 4px 10px; background: rgba(47, 47, 47, 0.1); border-radius: 12px;">Êé•Êî∂:
                        0 ÂèëÈÄÅ: 0 ÊÄªÊï∞: 0</span>
                </div>
                <div class="panel-content">
                    <div class="inbox-layout">
                        <div class="contact-list" id="contactList" style="position: relative;">
                            <!-- ËÅîÁ≥ª‰∫∫ÂàóË°®Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                            <button class="btn-clear-inbox" id="clearInboxBtn" title="ÂÖ®ÈÉ®Âà†Èô§">ÂÖ®ÈÉ®Âà†Èô§</button>
                        </div>
                        <div class="chat-area">
                            <div class="chat-header" id="chatHeader" style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                                <span class="phone-number" id="chatPhoneNumber" style="flex: 1;">ÈÄâÊã©‰∏Ä‰∏™ÂØπËØù</span>
                                <div id="exclusivePhoneSelector" style="display: none; position: relative;">
                                    <button id="exclusivePhoneBtn" style="padding: 6px 12px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); border: 2px solid var(--border-dark); border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                        Êú¨Êú∫Âè∑Á†Å: <span id="currentPhoneDisplay">-</span> <span style="font-size: 10px;">‚ñº</span>
                                    </button>
                                    <div id="exclusivePhoneDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 5px; background: white; border: 2px solid var(--border-dark); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; min-width: 150px; max-height: 200px; overflow-y: auto;">
                                        <!-- Âä®ÊÄÅÁîüÊàêÂè∑Á†ÅÂàóË°® -->
                                    </div>
                                </div>
                            </div>
                            <div class="chat-display" id="conversationDisplay">
                                <!-- ÂØπËØùÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                            </div>
                            <div class="reply-bar">
                                <input type="text" class="reply-input" id="replyInput" placeholder="ËæìÂÖ•ÂõûÂ§çÊ∂àÊÅØ...">
                                <button class="btn-send-reply" id="sendReplyBtn">ÂèëÈÄÅ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Ë¥¶Âè∑ÁÆ°ÁêÜÈù¢Êùø -->
            <div class="panel-e" id="panelE" style="display: none;">
                <div class="panel-header">
                    <span>Ë¥¶Âè∑ÁÆ°ÁêÜ</span>
                </div>
                <div class="panel-content">
                    <!-- Ë¥¶Âè∑ÁÆ°ÁêÜÂÜÖÂÆπÂå∫Âüü -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region Êñá‰ª∂ËæìÂÖ• HTML -->
    <input type="file" id="numbersFile" class="file-input" accept=".txt,.csv">
    <input type="file" id="messageFile" class="file-input" accept=".txt">
    <!--#endregion -->
    <script>
        //#region ÂÖ®Â±ÄÂèòÈáèÂ£∞Êòé
        let currentUserId = null;
        let authToken = null;
        let activeWs = null;
        let activeWsServer = null;
        //#endregion

        //#region ÁôªÂΩïËÆ§ËØÅÊ®°ÂùóÔºàÁî®Êà∑ÁôªÂΩï„ÄÅÁÆ°ÁêÜÂëòÁôªÂΩï„ÄÅÊ≥®ÂÜåÔºâ
        function switchToUser() {
            const loginPanel = document.getElementById('loginPanel');
            const adminToggle = document.getElementById('adminToggle');

            document.getElementById('userLoginForm').style.display = 'block';
            document.getElementById('adminLoginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';

            loginPanel.classList.remove('admin-mode');
            adminToggle.classList.remove('active');

            document.querySelector('.login-logo').textContent = 'Áî®Êà∑ÁôªÂΩï';
            if (adminToggle) {
                adminToggle.textContent = 'Admin';
            }

            clearMessage();
        }

        window.switchToAdmin = function switchToAdmin() {
            const loginPanel = document.getElementById('loginPanel');
            const adminToggle = document.getElementById('adminToggle');
            const isAdminMode = loginPanel.classList.contains('admin-mode');

            if (isAdminMode) {
                document.getElementById('userLoginForm').style.display = 'block';
                document.getElementById('adminLoginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'none';
                adminToggle.classList.remove('active');
                loginPanel.classList.remove('admin-mode');
                document.querySelector('.login-logo').textContent = 'Áî®Êà∑ÁôªÂΩï';
                adminToggle.textContent = 'Admin';
            } else {
                document.getElementById('userLoginForm').style.display = 'none';
                document.getElementById('adminLoginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                adminToggle.classList.add('active');
                loginPanel.classList.add('admin-mode');
                document.querySelector('.login-logo').textContent = 'ÁÆ°ÁêÜÂëòÁôªÂΩï';
                adminToggle.textContent = 'User';
            }
            clearMessage();
        }

        //#endregion
        //#region ÁôªÂΩï/Ê≥®ÂÜåÂàáÊç¢ÂäüËÉΩ
        function showRegister() {
            document.getElementById('userLoginForm').style.display = 'none';
            document.getElementById('adminLoginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            clearMessage();
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('adminLoginForm').style.display = 'none';
            document.getElementById('userLoginForm').style.display = 'block';
            clearMessage();
        }

        function clearMessage() {
            const msg = document.getElementById('authMessage');
            msg.className = 'message-box';
            msg.textContent = '';
        }

        function showAutoToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `auto-toast auto-toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.classList.add('show');
            });

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function showMessage(text, type) {
            if (type === 'error') {
                showAutoToast(text, type);
            } else {
                showAutoToast(text, type);
            }
        }

        async function handleLogin() {
            const usernameEl = document.getElementById('loginUsername');
            const passwordEl = document.getElementById('loginPassword');

            if (!usernameEl || !passwordEl) {
                console.error('Êâæ‰∏çÂà∞ÁôªÂΩïËæìÂÖ•Ê°Ü');
                return;
            }

            const username = usernameEl.value.trim();
            const password = passwordEl.value.trim();

            if (!username || !password) {
                if (typeof showMessage === 'function') {
                    showMessage('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å', 'error');
                } else {
                    await customAlert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                }
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok && (data.ok || data.success)) {
                    localStorage.setItem('user_id', data.user_id);
                    localStorage.setItem('auth_token', data.token);
                    localStorage.setItem('username', username);

                    if (data.balance !== undefined) {
                        localStorage.setItem('user_balance', data.balance);
                    }
                    if (data.usage_records) {
                        localStorage.setItem('user_usage_records', JSON.stringify(data.usage_records));
                    }
                    if (data.access_records) {
                        localStorage.setItem('user_access_records', JSON.stringify(data.access_records));
                    }
                    if (data.inbox_conversations) {
                        localStorage.setItem('user_inbox_conversations', JSON.stringify(data.inbox_conversations));
                    }
                    if (data.task_results || data.history_tasks) {
                        localStorage.setItem('user_history_tasks', JSON.stringify(data.task_results || data.history_tasks));
                    }

                    if (typeof showMessage === 'function') {
                        showMessage('ÁôªÂΩïÊàêÂäüÔºÅÊ≠£Âú®Ë∑≥ËΩ¨...', 'success');
                    }

                    setTimeout(() => {
                        const loginPage = document.getElementById('loginPage');
                        const contentWrapper = document.querySelector('.content-wrapper');
                        const mainContainer = document.querySelector('.main-container');

                        if (loginPage) loginPage.style.display = 'none';
                        document.body.classList.remove('login-mode');
                        if (contentWrapper) contentWrapper.style.display = 'flex';
                        if (mainContainer) mainContainer.style.display = 'flex';

                        if (data.balance !== undefined && typeof updateUserInfoDisplay === 'function') {
                            updateUserInfoDisplay(data.balance);
                        }

                        if (typeof showMainApp === 'function') {
                            showMainApp();
                        }

                        if (typeof window.init === 'function') {
                            window.init();
                        }
                    }, 500);
                } else {
                    const errorMsg = data.message || 'ÂØÜÁ†ÅÈîôËØØ';
                    if (typeof showMessage === 'function') {
                        showMessage(errorMsg, 'error');
                    } else {
                        await customAlert(errorMsg);
                    }
                }
            } catch (error) {
                let errorMsg = 'ÁôªÂΩïÂ§±Ë¥•';
                try {
                    if (error.response) {
                        const errorData = await error.response.json();
                        errorMsg = errorData.message || 'ÂØÜÁ†ÅÈîôËØØ';
                    } else if (error.message && error.message.includes('fetch')) {
                        errorMsg = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï';
                    }
                } catch (e) {
                    errorMsg = 'ÂØÜÁ†ÅÈîôËØØ';
                }

                if (typeof showMessage === 'function') {
                    showMessage(errorMsg, 'error');
                } else {
                    await customAlert(errorMsg);
                }
            }
        }
        window.handleLogin = handleLogin;
        async function handleAdminLogin() {
            const username = document.getElementById('adminLoginUsername').value.trim();
            const password = document.getElementById('adminLoginPassword').value.trim();

            if (!username || !password) {
                showMessage('ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÁî®Êà∑ÂêçÂíåÂØÜÁ†Å', 'error');
                return;
            }

            // ÂßãÁªà‰ºòÂÖàËµ∞ API ÁÆ°ÁêÜÂëòÁôªÂΩïÔºåÊãøÂà∞ÁúüÂÆû admin_tokenÔºàÂê¶Âàô /admin/account ‰ºö 403Ôºâ
            // Ê≥®ÊÑèÔºö‰∏•Á¶ÅÊää password/token ÊâìÂà∞Êó•ÂøóÈáå
            async function doAdminLogin() {
                try {
                    if (typeof showMessage === 'function') {
                        showMessage('Ê≠£Âú®È™åËØÅÁÆ°ÁêÜÂëòË∫´‰ªΩ...', 'info');
                    }

                    const response = await fetch(`${API_BASE_URL}/admin/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ admin_id: username, password: password })
                    });

                    const data = await response.json().catch(() => ({}));

                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:handleAdminLogin',message:'admin_login_response',data:{status:response.status,ok:!!response.ok,has_token:!!data.token,has_ok:!!data.ok,has_success:!!data.success,msg:(data.message||'').slice(0,120)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix1',hypothesisId:'H'})}).catch(()=>{});
                    // #endregion

                    if (response.ok && (data.ok || data.success) && data.token) {
                        localStorage.setItem('admin_id', data.admin_id || username);
                        localStorage.setItem('admin_token', data.token);
                        localStorage.setItem('admin_username', username);

                        showMessage('ÁÆ°ÁêÜÂëòÁôªÂΩïÊàêÂäüÔºÅÊ≠£Âú®Ë∑≥ËΩ¨...', 'success');
                        setTimeout(() => {
                            // ‰∏çÂÜç‰æùËµñ data.has_manager_accessÔºàAPI ‰∏ç‰∏ÄÂÆöËøîÂõûËØ•Â≠óÊÆµÔºâ
                            loginAsManager(username);
                        }, 500);
                        return;
                    }

                    const errorMsg = data.message || 'ÁÆ°ÁêÜÂëòÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å';
                    if (typeof showMessage === 'function') showMessage(errorMsg, 'error');
                    else await customAlert(errorMsg);
                } catch (error) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:handleAdminLogin',message:'admin_login_exception',data:{err:(error&&error.message||String(error)).slice(0,200)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix1',hypothesisId:'H'})}).catch(()=>{});
                    // #endregion
                    const errorMsg = (error && error.message && error.message.includes('fetch')) ? 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï' : 'ÁÆ°ÁêÜÂëòÁôªÂΩïÂ§±Ë¥•';
                    if (typeof showMessage === 'function') showMessage(errorMsg, 'error');
                    else await customAlert(errorMsg);
                }
            }

            await doAdminLogin();
        }

        async function handleRegister() {
            const usernameEl = document.getElementById('registerUsername');
            const passwordEl = document.getElementById('registerPassword');
            const confirmPasswordEl = document.getElementById('registerConfirmPassword');

            if (!usernameEl || !passwordEl || !confirmPasswordEl) {
                console.error('Êâæ‰∏çÂà∞Ê≥®ÂÜåËæìÂÖ•Ê°Ü');
                return;
            }

            const username = usernameEl.value.trim();
            const password = passwordEl.value.trim();
            const confirmPassword = confirmPasswordEl.value.trim();

            if (!username) {
                if (typeof showMessage === 'function') {
                    showMessage('ËØ∑ËæìÂÖ•Áî®Êà∑Âêç', 'error');
                } else {
                    await customAlert('ËØ∑ËæìÂÖ•Áî®Êà∑Âêç');
                }
                return;
            }

            if (username.length < 4) {
                if (typeof showMessage === 'function') {
                    showMessage('Áî®Êà∑ÂêçËá≥Â∞ëÈúÄË¶Å4‰Ωç', 'error');
                } else {
                    await customAlert('Áî®Êà∑ÂêçËá≥Â∞ëÈúÄË¶Å4‰Ωç');
                }
                return;
            }

            if (!/^[a-zA-Z0-9]+$/.test(username)) {
                if (typeof showMessage === 'function') {
                    showMessage('Áî®Êà∑ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØçÊàñÊï∞Â≠ó', 'error');
                } else {
                    await customAlert('Áî®Êà∑ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØçÊàñÊï∞Â≠ó');
                }
                return;
            }

            if (!password) {
                if (typeof showMessage === 'function') {
                    showMessage('ËØ∑ËæìÂÖ•ÂØÜÁ†Å', 'error');
                } else {
                    await customAlert('ËØ∑ËæìÂÖ•ÂØÜÁ†Å');
                }
                return;
            }

            if (password.length < 4) {
                if (typeof showMessage === 'function') {
                    showMessage('ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å4‰Ωç', 'error');
                } else {
                    await customAlert('ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å4‰Ωç');
                }
                return;
            }

            if (!confirmPassword) {
                if (typeof showMessage === 'function') {
                    showMessage('ËØ∑Á°ÆËÆ§ÂØÜÁ†Å', 'error');
                } else {
                    await customAlert('ËØ∑Á°ÆËÆ§ÂØÜÁ†Å');
                }
                return;
            }

            if (password !== confirmPassword) {
                if (typeof showMessage === 'function') {
                    showMessage('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥', 'error');
                } else {
                    await customAlert('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
                }
                return;
            }

            async function doRegister() {
                try {
                    if (typeof showMessage === 'function') {
                        showMessage('Ê≠£Âú®Ê≥®ÂÜå...', 'info');
                    }

                    const response = await fetch(`${API_BASE_URL}/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password
                        })
                    });

                    const data = await response.json();

                    if (response.ok && (data.ok || data.success)) {
                        document.getElementById('registerUsername').value = '';
                        document.getElementById('registerPassword').value = '';
                        document.getElementById('registerConfirmPassword').value = '';

                        if (typeof showLogin === 'function') {
                            showLogin();
                        }
                        const loginUsernameEl = document.getElementById('loginUsername');
                        const loginPasswordEl = document.getElementById('loginPassword');
                        if (loginUsernameEl) {
                            loginUsernameEl.value = username;
                        }
                        if (loginPasswordEl) {
                            loginPasswordEl.value = '';
                        }

                        setTimeout(async () => {
                            await customAlert('Ê≥®ÂÜåÊàêÂäüÔºÅ');
                        }, 300);
                    } else {
                        const errorMsg = data.message || 'Ê≥®ÂÜåÂ§±Ë¥•';
                        if (typeof showMessage === 'function') {
                            showMessage(errorMsg, 'error');
                        } else {
                            await customAlert(errorMsg);
                        }
                    }
                } catch (error) {
                    let errorMsg = 'Ê≥®ÂÜåÂ§±Ë¥•';
                    if (error.message && error.message.includes('fetch')) {
                        errorMsg = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï';
                    } else {
                        try {
                            if (error.response) {
                                const errorData = await error.response.json();
                                errorMsg = errorData.message || 'Ê≥®ÂÜåÂ§±Ë¥•';
                            }
                        } catch (e) {
                            errorMsg = 'Ê≥®ÂÜåÂ§±Ë¥•';
                        }
                    }

                    if (typeof showMessage === 'function') {
                        showMessage(errorMsg, 'error');
                    } else {
                        await customAlert(errorMsg);
                    }
                }
            }

            doRegister();
        }
        window.showAdminModal = function showAdminModal() {
            const modal = document.getElementById('adminModal');
            if (!modal) return;

            requestAnimationFrame(() => {
                modal.classList.add('show');
                setTimeout(() => {
                    document.getElementById('adminPasswordInput').focus();
                }, 50);
            });
        }

        function closeAdminModal() {
            const modal = document.getElementById('adminModal');
            if (!modal) return;

            modal.classList.remove('show');

            setTimeout(() => {
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminMessage').className = 'modal-message';
            }, 300);
        }

        async function verifyAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            const msg = document.getElementById('adminMessage');

            if (!password) {
                msg.className = 'modal-message error';
                msg.textContent = 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å';
                setTimeout(() => {
                    msg.className = 'modal-message';
                    msg.textContent = '';
                }, 3000);
                return;
            }
            // ÊóßÁöÑ‚Äúpassword===1 Áõ¥Êé•ÁªïËøá‚Äù‰ºöÂØºËá¥È°µÈù¢‰∏çÊãâÊï∞ÊçÆÔºàÁ©∫ÁôΩÔºâÔºåÁé∞Êîπ‰∏∫Áªü‰∏ÄËµ∞ API Ê†°È™å
            // if (password === '1') { ... return; }

            try {
                const response = await fetch(`${API_BASE_URL}/server-manager/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });

                const data = await response.json();
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:verifyAdminPassword',message:'server_manager_verify',data:{status:response.status,ok:!!response.ok,success:!!data.success,msg:(data.message||'').slice(0,120)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix2',hypothesisId:'K'})}).catch(()=>{});
                // #endregion

                if (!response.ok || !data.success) {
                    const errorMsg = data.message || 'ÂØÜÁ†ÅÈîôËØØ';
                    msg.className = 'modal-message error';
                    msg.textContent = errorMsg;
                    setTimeout(() => {
                        msg.className = 'modal-message';
                        msg.textContent = '';
                    }, 5000);
                    return;
                }

                if (data.success) {
                    closeAdminModal();
                    const loginPage = document.getElementById('loginPage');
                    const adminPage = document.getElementById('adminPage');

                    if (loginPage) {
                        loginPage.style.display = 'none';
                        document.body.classList.remove('login-mode');
                    }

                    if (adminPage) {
                        adminPage.style.display = 'block';
                        adminPage.classList.add('show');

                        const scheduleUpdate = (callback) => {
                            if (window.requestIdleCallback) {
                                requestIdleCallback(callback, { timeout: 1000 });
                            } else {
                                setTimeout(callback, 100);
                            }
                        };

                        const scheduleServerUpdate = (callback) => {
                            if (window.requestIdleCallback) {
                                requestIdleCallback(callback, { timeout: 500 });
                            } else {
                                setTimeout(callback, 200);
                            }
                        };

                        // ÂÖ≥ÈîÆÔºöÂÖàÊãâÂèñÊï∞ÊçÆÔºåÂÜçÊ∏≤ÊüìÔºàÂê¶ÂàôÈ°µÈù¢‰∏∫Á©∫Ôºâ
                        scheduleServerUpdate(async () => {
                            try { await loadServersFromAPI(); } catch { /* ignore */ }
                            try { updateServerDisplay(); } catch { /* ignore */ }
                        });

                        scheduleUpdate(async () => {
                            try { await loadAdminAccountsFromAPI(); } catch { /* ignore */ }
                            try { updateAdminAccountDisplay(); } catch { /* ignore */ }
                        });
                    }
                } else {
                    msg.className = 'modal-message error';
                    msg.textContent = data.message || 'ÂØÜÁ†ÅÈîôËØØÔºåËØ∑ÈáçËØï';
                    setTimeout(() => {
                        msg.className = 'modal-message';
                        msg.textContent = '';
                    }, 5000);
                }
            } catch (error) {
                let errorMsg = 'ÂØÜÁ†ÅÈîôËØØ';
                try {
                    if (error.response) {
                        const errorData = await error.response.json();
                        errorMsg = errorData.message || 'ÂØÜÁ†ÅÈîôËØØ';
                    } else if (error.message && error.message.includes('fetch')) {
                        errorMsg = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï';
                    }
                } catch (e) {
                    errorMsg = 'ÂØÜÁ†ÅÈîôËØØ';
                }

                msg.className = 'modal-message error';
                msg.textContent = errorMsg;
                setTimeout(() => {
                    msg.className = 'modal-message';
                    msg.textContent = '';
                }, 5000);
            }
        }

        async function backToLogin() {
            try {
                // localStorage.setItem('serverData', JSON.stringify(serverData));
                localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
            }

            const result = await showCustomModal('ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'alert', '', [
                { text: 'ËøîÂõûÁôªÂΩïÁïåÈù¢', value: 'login' },
                { text: 'ËøõÂÖ•‰∏ªÈù¢Êùø', value: 'main' }
            ]);

            if (result === 'login') {
                const adminPage = document.getElementById('adminPage');
                const loginPage = document.getElementById('loginPage');
                if (adminPage) {
                    adminPage.classList.remove('show');
                    adminPage.style.display = 'none';
                }
                if (loginPage) {
                    loginPage.style.display = 'flex';
                    document.body.classList.add('login-mode');
                }
                const userLoginTab = document.querySelector('.login-tab[data-tab="user"]');
                const adminLoginTab = document.querySelector('.login-tab[data-tab="admin"]');
                if (userLoginTab && adminLoginTab) {
                    userLoginTab.classList.add('active');
                    adminLoginTab.classList.remove('active');
                    const userLoginForm = document.getElementById('userLoginForm');
                    const adminLoginForm = document.getElementById('adminLoginForm');
                    if (userLoginForm && adminLoginForm) {
                        userLoginForm.style.display = 'block';
                        adminLoginForm.style.display = 'none';
                    }
                }
            } else if (result === 'main') {
                const adminPage = document.getElementById('adminPage');
                const loginPage = document.getElementById('loginPage');
                if (adminPage) {
                    adminPage.classList.remove('show');
                    adminPage.style.display = 'none';
                }
                if (loginPage) {
                    loginPage.style.display = 'none';
                    document.body.classList.remove('login-mode');
                }
                const contentWrapper = document.querySelector('.content-wrapper');
                const mainContainer = document.querySelector('.main-container');
                if (contentWrapper) {
                    contentWrapper.style.display = 'flex';
                }
                if (mainContainer) {
                    mainContainer.style.display = 'flex';
                }
                const navHomeBtn = document.getElementById('navHomeBtn');
                if (navHomeBtn && typeof navHomeBtn.click === 'function') {
                    navHomeBtn.click();
                }
            }
        }

        document.getElementById('adminPasswordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                verifyAdminPassword();
            }
        });

        document.getElementById('loginPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });

        document.getElementById('adminLoginPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleAdminLogin();
            }
        });

        document.getElementById('registerUsername').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                document.getElementById('registerPassword').focus();
            }
        });

        document.getElementById('registerPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                document.getElementById('registerConfirmPassword').focus();
            }
        });

        document.getElementById('registerConfirmPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleRegister();
            }
        });
 
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }
        let customModalResolve = null;

        function showCustomModal(title, message, type = 'alert', defaultValue = '', customButtons = null) {
            const modal = document.getElementById('customModal');
            const panel = document.getElementById('customModalPanel');
            const titleEl = document.getElementById('customModalTitle');
            const messageEl = document.getElementById('customModalMessage');
            const inputEl = document.getElementById('customModalInput');
            const buttonsEl = document.getElementById('customModalButtons');

            panel.className = 'custom-modal-panel';

            titleEl.textContent = title;
            if (typeof message === 'string') {
                messageEl.textContent = message;
            } else {
                messageEl.innerHTML = message;
            }

            if (type === 'prompt') {
                inputEl.style.display = 'block';
                inputEl.value = defaultValue;
                inputEl.focus();
            } else {
                inputEl.style.display = 'none';
            }

            buttonsEl.innerHTML = '';
            if (customButtons && Array.isArray(customButtons)) {
                customButtons.forEach(btnConfig => {
                    const btn = document.createElement('button');
                    btn.className = 'custom-modal-btn confirm';
                    btn.textContent = btnConfig.text;
                    btn.onclick = () => closeCustomModal(btnConfig.value);
                    buttonsEl.appendChild(btn);
                });
            } else if (type === 'alert') {
                const btn = document.createElement('button');
                btn.className = 'custom-modal-btn confirm';
                btn.textContent = 'Á°ÆÂÆö';
                btn.onclick = () => closeCustomModal(true);
                buttonsEl.appendChild(btn);
            } else if (type === 'confirm') {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'custom-modal-btn cancel';
                cancelBtn.textContent = 'ÂèñÊ∂à';
                cancelBtn.onclick = () => closeCustomModal(false);
                buttonsEl.appendChild(cancelBtn);

                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'custom-modal-btn confirm';
                confirmBtn.textContent = 'Á°ÆÂÆö';
                confirmBtn.onclick = () => closeCustomModal(true);
                buttonsEl.appendChild(confirmBtn);
            } else if (type === 'prompt') {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'custom-modal-btn cancel';
                cancelBtn.textContent = 'ÂèñÊ∂à';
                cancelBtn.onclick = () => closeCustomModal(null);
                buttonsEl.appendChild(cancelBtn);

                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'custom-modal-btn confirm';
                confirmBtn.textContent = 'Á°ÆÂÆö';
                confirmBtn.onclick = () => {
                    const value = inputEl.value.trim();
                    closeCustomModal(value || null);
                };
                buttonsEl.appendChild(confirmBtn);
            }

            requestAnimationFrame(() => {
                modal.classList.add('show');
            });

            const handleEnter = (e) => {
                if (e.key === 'Enter') {
                    if (type === 'prompt') {
                        const value = inputEl.value.trim();
                        closeCustomModal(value || null);
                    } else {
                        closeCustomModal(true);
                    }
                    inputEl.removeEventListener('keypress', handleEnter);
                }
            };
            if (type === 'prompt') {
                inputEl.addEventListener('keypress', handleEnter);
            }

            return new Promise((resolve) => {
                customModalResolve = resolve;
            });
        }

        function closeCustomModal(result) {
            const modal = document.getElementById('customModal');
            const panel = document.getElementById('customModalPanel');
            const content = document.getElementById('customModalContent');

            if (!modal) {
                if (customModalResolve) {
                    customModalResolve(result);
                    customModalResolve = null;
                }
                return;
            }

            modal.classList.remove('show');

            setTimeout(() => {
                if (panel) panel.className = 'custom-modal-panel';
                if (content) content.className = 'custom-modal-content';

                if (customModalResolve) {
                    customModalResolve(result);
                    customModalResolve = null;
                }
            }, 300);
        }

        async function customAlert(message) {
            await showCustomModal('ÊèêÁ§∫', message, 'alert');
        }

        async function customConfirm(message) {
            return await showCustomModal('Á°ÆËÆ§', message, 'confirm');
        }

        async function customPrompt(message, defaultValue = '') {
            return await showCustomModal('ËæìÂÖ•', message, 'prompt', defaultValue);
        }
        function handleForgotPassword() {
            customAlert('ËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂπ∂Êèê‰æõÊ≠£Á°ÆÁöÑÁî®Êà∑Âêç');
        }

        //#endregion
        //#region ÊúçÂä°Âô®ÁÆ°ÁêÜÊ®°ÂùóÔºàAPIË∞ÉÁî®„ÄÅÊúçÂä°Âô®ËøûÊé•Ôºâ
        let serverData = {
            connected: [],
            disconnected: []
        };

        try {
            const savedServerData = localStorage.getItem('serverData');
            if (savedServerData) {
                localStorage.removeItem('serverData');
                // console.log('Â∑≤Ê∏ÖÈô§localStorage‰∏≠ÁöÑÊóßÊúçÂä°Âô®Êï∞ÊçÆ');
            }
        } catch (error) {
            console.error('Ê∏ÖÁêÜlocalStorageÂ§±Ë¥•:', error);
        }

        let adminAccounts = [];
        try {
            const savedAccounts = localStorage.getItem('adminAccounts');
            if (savedAccounts) {
                adminAccounts = JSON.parse(savedAccounts);
            }
        } catch (error) {
            console.error('Âä†ËΩΩÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•:', error);
        }

        // Áªü‰∏ÄÂéªÈáçÔºàÈÅøÂÖçÂá∫Áé∞‚ÄúÁÇπ‰∏ÄÊ¨°Âá∫Êù•Â§ö‰∏™‚ÄùÔºâ
        function _dedupeAdminAccounts(list) {
            const map = new Map();
            (Array.isArray(list) ? list : []).forEach(a => {
                if (!a || !a.id) return;
                const key = String(a.id).trim();
                if (!key) return;
                const prev = map.get(key) || {};
                map.set(key, {
                    id: key,
                    password: (a.password !== undefined && a.password !== null) ? String(a.password) : (prev.password || ''),
                    selectedServers: Array.isArray(a.selectedServers) ? a.selectedServers : (Array.isArray(prev.selectedServers) ? prev.selectedServers : []),
                    userGroups: Array.isArray(a.userGroups) ? a.userGroups : (Array.isArray(prev.userGroups) ? prev.userGroups : undefined),
                });
            });
            return Array.from(map.values());
        }
        adminAccounts = _dedupeAdminAccounts(adminAccounts);

        async function loadAdminAccountsFromAPI() {
            try {
                const resp = await fetch(`${API_BASE_URL}/admin/account?t=${Date.now()}`, { method: 'GET' });
                const data = await resp.json().catch(() => ({}));
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:loadAdminAccountsFromAPI',message:'admin_accounts_load',data:{status:resp.status,ok:!!resp.ok,count:(data.admins&&data.admins.length)||0,success:!!data.success},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix2',hypothesisId:'J'})}).catch(()=>{});
                // #endregion
                if (resp.ok && data.success && Array.isArray(data.admins)) {
                    const existing = new Map((_dedupeAdminAccounts(adminAccounts)).map(a => [a.id, a]));
                    data.admins.forEach(row => {
                        const id = String((row && row.admin_id) || '').trim();
                        if (!id) return;
                        const prev = existing.get(id) || { id, password: '', selectedServers: [] };
                        existing.set(id, { ...prev, id });
                    });
                    adminAccounts = _dedupeAdminAccounts(Array.from(existing.values()));
                    try { localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts)); } catch { /* ignore */ }
                }
            } catch (e) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:loadAdminAccountsFromAPI',message:'admin_accounts_load_exception',data:{err:(e&&e.message||String(e)).slice(0,200)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix2',hypothesisId:'J'})}).catch(()=>{});
                // #endregion
            }
        }

        // Âº∫Âà∂‰ΩøÁî® Railway API (‰øÆÂ§çÊú¨Âú∞Êï∞ÊçÆÂ∫ìËøûÊé•ÈóÆÈ¢ò)
        const isLocalDev = false;  // ‰∏¥Êó∂Á¶ÅÁî®Êú¨Âú∞ÂºÄÂèëÊ®°Âºè
        const API_BASE_URL = 'https://autosender.up.railway.app/api';  // ËøúÁ®ãAPIÂú∞ÂùÄ
        
        // Â¶ÇÊûúÈúÄË¶Å‰ΩøÁî®Êú¨Âú∞API,ÂèñÊ∂à‰∏ãÈù¢ÁöÑÊ≥®ÈáäÂπ∂Ê≥®ÈáäÊéâ‰∏äÈù¢ÁöÑ‰ª£Á†Å
        // const isLocalDev = window.location.hostname === 'localhost' ||
        //                   window.location.hostname === '127.0.0.1' ||
        //                   window.location.hostname === '';
        // const API_BASE_URL = isLocalDev
        //     ? 'http://127.0.0.1:5000/api'  // Êú¨Âú∞APIÂú∞ÂùÄÔºàÁ´ØÂè£5000Ôºâ
        //     : 'https://autosender.up.railway.app/api';  // ËøúÁ®ãAPIÂú∞ÂùÄ

        //console.log('API Base URL:', API_BASE_URL, '(Local Dev:', isLocalDev + ')');

        // Â∏¶Ë∂ÖÊó∂ÁöÑfetchÂáΩÊï∞ (60ÁßíË∂ÖÊó∂ÔºåÈÄÇÂ∫îÊÖ¢ÈÄüAPI)
        async function fetchWithTimeout(url, options = {}, timeout = 60000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error(`ËØ∑Ê±ÇË∂ÖÊó∂ (${timeout/1000}Áßí)`);
                }
                throw error;
            }
        }

        async function testAPIConnection() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(`${API_BASE_URL}/servers`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return { success: true, status: response.status };
            } catch (error) {
                console.error('APIËøûÊé•ÊµãËØïÂ§±Ë¥•:', error);
                return {
                    success: false,
                    error: error.message,
                    details: {
                        name: error.name,
                        message: error.message,
                        type: error.name === 'AbortError' ? 'timeout' :
                              error.message.includes('Failed to fetch') ? 'network' :
                              error.message.includes('CORS') ? 'cors' : 'unknown'
                    }
                };
            }
        }

        let _serversLoadedOnce = false;
        async function loadServersFromAPI() {
            try {
                // ÂàõÂª∫Â∏¶Ë∂ÖÊó∂ÁöÑ fetch controller (30ÁßíË∂ÖÊó∂)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                const response = await fetch(`${API_BASE_URL}/servers?t=${Date.now()}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`APIÂìçÂ∫îÈîôËØØ: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                if (data.success && data.servers) {
                    // console.log('Âä†ËΩΩÊúçÂä°Âô®ÂàóË°®ÊàêÂäüÔºåÊúçÂä°Âô®Êï∞Èáè:', data.servers.length);

                    serverData.connected = [];
                    serverData.disconnected = [];

                    data.servers.forEach(s => {
                        const serverItem = {
                            name: s.server_name || s.server_id,
                            url: s.server_url || '',
                            server_id: s.server_id,
                            status: (s.status || '').toLowerCase(),
                            assigned_user_id: s.assigned_user_id || null,
                            last_seen: s.last_seen
                        };

                        if (serverItem.status === 'connected') {
                            serverData.connected.push(serverItem);
                        } else if (serverItem.status === 'available') {
                            serverItem.status = 'connected';
                            serverData.connected.push(serverItem);
                        } else if (serverItem.status === 'disconnected') {
                            serverData.disconnected.push(serverItem);
                        } else {
                        }
                    });

                    _serversLoadedOnce = true;

                    const realNames = new Set([...serverData.connected].map(s => String(s.name || '').trim()).filter(Boolean));
                    let cleaned = false;
                    try {
                        adminAccounts.forEach(acc => {
                            if (Array.isArray(acc.selectedServers)) {
                                const before = acc.selectedServers.length;
                                acc.selectedServers = acc.selectedServers.filter(n => realNames.has(String(n).trim()));
                                if (acc.selectedServers.length !== before) cleaned = true;
                            }
                            if (Array.isArray(acc.userGroups)) {
                                acc.userGroups.forEach(g => {
                                    if (Array.isArray(g.servers)) {
                                        const b = g.servers.length;
                                        g.servers = g.servers.filter(n => realNames.has(String(n).trim()));
                                        if (g.servers.length !== b) cleaned = true;
                                    }
                                });
                            }
                        });
                        if (Array.isArray(managerUserGroups)) {
                            managerUserGroups.forEach(g => {
                                if (Array.isArray(g.servers)) {
                                    const b = g.servers.length;
                                    g.servers = g.servers.filter(n => realNames.has(String(n).trim()));
                                    if (g.servers.length !== b) cleaned = true;
                                }
                            });
                        }
                        if (cleaned) {
                            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                        }
                    } catch (e) {
                        console.warn('Ê∏ÖÁêÜÊóßÊúçÂä°Âô®ÁºìÂ≠òÂ§±Ë¥•:', e);
                    }

                    updateServerDisplay();
                    connectToAvailableServers();

                    if (document.getElementById('adminManageServersGrid')) {
                    }

                } else {
                    // console.warn('APIËøîÂõûÊï∞ÊçÆÊ†ºÂºèÂºÇÂ∏∏:', data);
                }
            } catch (error) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØÔºå‰∏çÂΩ±ÂìçÈ°µÈù¢ÂäüËÉΩ
                console.error('Âä†ËΩΩÊúçÂä°Âô®ÂàóË°®Â§±Ë¥•:', error);
                // Â¶ÇÊûúÊòØË∂ÖÊó∂ÊàñÁΩëÁªúÈîôËØØÔºåÂèØ‰ª•ËÄÉËôëÈáçËØï
                if (error.name === 'AbortError') {
                    console.warn('ÊúçÂä°Âô®ÂàóË°®Âä†ËΩΩË∂ÖÊó∂ÔºåÂ∞Ü‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
                }
            }
        }

        let exclusivePhoneNumbers = [];
        let currentSelectedPhone = null;

        async function loadExclusivePhoneNumbers() {
            if (!currentUserId) {
                document.getElementById('exclusivePhoneSelector').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/users/${currentUserId}/available-servers`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.exclusive_servers && data.exclusive_servers.length > 0) {
                        exclusivePhoneNumbers = [];
                        for (const server of data.exclusive_servers) {
                            const phoneNumber = server.phone_number || server.server_name || server.server_id;
                            if (phoneNumber && !exclusivePhoneNumbers.find(p => p.phone === phoneNumber)) {
                                exclusivePhoneNumbers.push({
                                    phone: phoneNumber,
                                    server_id: server.server_id,
                                    server_name: server.server_name
                                });
                            }
                        }

                        if (exclusivePhoneNumbers.length > 0) {
                            document.getElementById('exclusivePhoneSelector').style.display = 'block';
                            if (!currentSelectedPhone && exclusivePhoneNumbers.length > 0) {
                                currentSelectedPhone = exclusivePhoneNumbers[0].phone;
                            }
                            updateExclusivePhoneDisplay();
                        } else {
                            document.getElementById('exclusivePhoneSelector').style.display = 'none';
                        }
                    } else {
                        document.getElementById('exclusivePhoneSelector').style.display = 'none';
                    }
                } else {
                    document.getElementById('exclusivePhoneSelector').style.display = 'none';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁã¨‰∫´ÊúçÂä°Âô®ÁîµËØùÂè∑Á†ÅÂ§±Ë¥•:', error);
                document.getElementById('exclusivePhoneSelector').style.display = 'none';
            }
        }

        function updateExclusivePhoneDisplay() {
            const currentPhoneDisplay = document.getElementById('currentPhoneDisplay');
            const dropdown = document.getElementById('exclusivePhoneDropdown');
            const btn = document.getElementById('exclusivePhoneBtn');

            if (currentSelectedPhone && currentPhoneDisplay) {
                currentPhoneDisplay.textContent = currentSelectedPhone;
            }

            if (dropdown) {
                dropdown.innerHTML = '';
                exclusivePhoneNumbers.forEach(item => {
                    const option = document.createElement('div');
                    option.style.cssText = 'padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #eee; transition: background 0.2s;';
                    if (item.phone === currentSelectedPhone) {
                        option.style.background = 'rgba(76, 175, 80, 0.2)';
                        option.style.fontWeight = 'bold';
                    }
                    option.textContent = item.phone;
                    option.onclick = () => {
                        currentSelectedPhone = item.phone;
                        updateExclusivePhoneDisplay();
                        dropdown.style.display = 'none';
                        loadInboxForPhone(item.phone);
                    };
                    option.onmouseenter = () => {
                        if (item.phone !== currentSelectedPhone) {
                            option.style.background = 'rgba(76, 175, 80, 0.1)';
                        }
                    };
                    option.onmouseleave = () => {
                        if (item.phone !== currentSelectedPhone) {
                            option.style.background = 'transparent';
                        }
                    };
                    dropdown.appendChild(option);
                });
            }

            if (btn) {
                if (exclusivePhoneNumbers.length === 1) {
                    btn.innerHTML = `Êú¨Êú∫Âè∑Á†Å: <span id="currentPhoneDisplay">${currentSelectedPhone || '-'}</span>`;
                    btn.onclick = null;
                    btn.style.cursor = 'default';
                } else {
                    btn.innerHTML = `Êú¨Êú∫Âè∑Á†Å: <span id="currentPhoneDisplay">${currentSelectedPhone || '-'}</span> <span style="font-size: 10px;">‚ñº</span>`;
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        const dropdown = document.getElementById('exclusivePhoneDropdown');
                        if (dropdown) {
                            const isVisible = dropdown.style.display === 'block';
                            dropdown.style.display = isVisible ? 'none' : 'block';
                        }
                    };
                    btn.style.cursor = 'pointer';
                }
            }
        }

        function loadInboxForPhone(phoneNumber) {
            console.log('ÂàáÊç¢Âà∞ÁîµËØùÂè∑Á†Å:', phoneNumber);
        }

        document.addEventListener('click', (e) => {
            const selector = document.getElementById('exclusivePhoneSelector');
            const dropdown = document.getElementById('exclusivePhoneDropdown');
            if (selector && dropdown && !selector.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        async function deleteServer(serverId) {
            if (!await customConfirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊúçÂä°Âô®ÂêóÔºü')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/servers/${serverId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showMessage('ÊúçÂä°Âô®Âà†Èô§ÊàêÂäü', 'success');
                        await loadServersFromAPI();
                    } else {
                        await customAlert('Âà†Èô§ÊúçÂä°Âô®Â§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'));
                    }
                } else {
                    const error = await response.json();
                    await customAlert('Âà†Èô§ÊúçÂä°Âô®Â§±Ë¥•: ' + (error.message || 'ÁΩëÁªúÈîôËØØ'));
                }
            } catch (error) {
                await customAlert('Âà†Èô§ÊúçÂä°Âô®Â§±Ë¥•: ' + error.message);
            }
        }

        async function connectToAssignedServers() {
            const user_id = localStorage.getItem('user_id');
            if (!user_id) return;
            currentUserId = currentUserId || user_id;
            authToken = authToken || localStorage.getItem('auth_token');

            // loadServersFromAPI(); // Â∑≤Âú® init() ‰∏≠Ë∞ÉÁî®ÔºåÈÅøÂÖçÈáçÂ§ç
            connectToBackendWS(null);
        }

        let inboxPollingInterval = null;

        function startInboxPolling(userId) {
        }

        function stopInboxPolling() {
            if (inboxPollingInterval) {
                clearInterval(inboxPollingInterval);
                inboxPollingInterval = null;
            }
        }

        async function pollInbox(userId) {
            return;
        }

        async function loadConversationMessages(chatId) {
            requestConversation(chatId);
        }

        if (localStorage.getItem('user_id')) {
            connectToAssignedServers();
        }

        async function reconnectServer(serverName) {
            await loadServersFromAPI();
            showMessage(`Â∑≤Âà∑Êñ∞ÊúçÂä°Âô® ${serverName} ÁöÑÁä∂ÊÄÅ`, 'success');
        }

        let updateServerDisplayTimer = null;
  
        function updateServerDisplay() {
            if (updateServerDisplayTimer) {
                clearTimeout(updateServerDisplayTimer);
            }
            updateServerDisplayTimer = setTimeout(() => {
                const connectedContainer = document.getElementById('connectedServers');
                const disconnectedContainer = document.getElementById('disconnectedServers');
                if (!connectedContainer && !disconnectedContainer) {
                    return;
                }

                const serverExclusiveMap = new Map();
                [...serverData.connected, ...(serverData.disconnected || [])].forEach(server => {
                    if (server.assigned_user_id) {
                        serverExclusiveMap.set(server.name, server.assigned_user_id);
                    }
                });
                adminAccounts.forEach(account => {
                    if (account.userGroups) {
                        account.userGroups.forEach(group => {
                            if (group.servers) {
                                group.servers.forEach(serverName => {
                                    if (!serverExclusiveMap.has(serverName)) {
                                        serverExclusiveMap.set(serverName, group.userId);
                                    }
                                });
                            }
                        });
                    }
                });

                const getExclusiveInfo = (serverName) => {
                    const userId = serverExclusiveMap.get(serverName);
                    return userId ? { isExclusive: true, displayName: `Áã¨‰∫´-${userId}` } : { isExclusive: false, displayName: serverName };
                };
                if (connectedContainer) {
                    const connectedFragment = document.createDocumentFragment();
                    connectedContainer.innerHTML = '';
                    serverData.connected.forEach(server => {
                        const btn = document.createElement('button');
                        btn.className = 'server-button connected';

                        const exclusiveInfo = getExclusiveInfo(server.name);
                        if (exclusiveInfo.isExclusive) {
                            btn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #c44569 100%)';
                            btn.style.color = 'white';
                        }

                        const portMatch = (server.url || '').match(/:(\d+)/);
                        const port = portMatch ? portMatch[1] : (server.port || (server.name || '').match(/\d+/)?.[0] || '?');

                        btn.innerHTML = `
                            <div class="server-button-name">${port}</div>
                            <div class="server-tooltip">
                                <div style="font-weight: bold; margin-bottom: 4px;">${server.name}</div>
                                <div style="font-size: 11px; opacity: 0.9;">${server.url || ''}</div>
                                ${exclusiveInfo.isExclusive ? '<div style="font-size: 11px; color: #ff6b6b; margin-top: 4px;">Áã¨‰∫´ÊúçÂä°Âô®</div>' : ''}
                            </div>
                        `;
                        btn.onclick = () => btn.classList.toggle('active');
                        connectedFragment.appendChild(btn);
                    });
                    connectedContainer.appendChild(connectedFragment);
                    const countEl = document.getElementById('connectedCount');
                    if (countEl) countEl.textContent = `(${serverData.connected.length})`;
                }

                if (disconnectedContainer) {
                    const disconnectedFragment = document.createDocumentFragment();
                    disconnectedContainer.innerHTML = '';
                    serverData.disconnected.forEach(server => {
                        const btn = document.createElement('button');
                        btn.className = 'server-button disconnected';

                        const portMatch = (server.url || '').match(/:(\d+)/);
                        const port = portMatch ? portMatch[1] : (server.port || (server.name || '').match(/\d+/)?.[0] || '?');

                        btn.innerHTML = `
                            <div class="server-button-name">${port}</div>
                            <div class="server-tooltip">
                                <div style="font-weight: bold; margin-bottom: 4px;">${server.name}</div>
                                <div style="font-size: 11px; opacity: 0.9;">${server.url || ''}</div>
                            </div>
                        `;
                        btn.onclick = (e) => {
                            if (e.target !== reconnectBtn) {
                                btn.classList.toggle('active');
                            }
                        };
                        const reconnectBtn = document.createElement('button');
                        reconnectBtn.className = 'server-action-btn reconnect';
                        reconnectBtn.textContent = 'ÈáçËøû';
                        reconnectBtn.onclick = () => reconnectServer(server.name);
                        btn.appendChild(reconnectBtn);
                        disconnectedFragment.appendChild(btn);
                    });
                    disconnectedContainer.appendChild(disconnectedFragment);
                    const disconnectedCountEl = document.getElementById('disconnectedCount');
                    if (disconnectedCountEl) disconnectedCountEl.textContent = `(${serverData.disconnected.length})`;
                }
            }, 50);
        }
  
        function showAddAdminModal() {
            const modal = document.getElementById('addAdminModal');
            if (!modal) return;

            const idInput = document.getElementById('newAdminId');
            const passwordInput = document.getElementById('newAdminPassword');

            idInput.value = '';
            passwordInput.value = '';

            const idHandler = idInput._enterHandler;
            const passwordHandler = passwordInput._enterHandler;
            if (idHandler) idInput.removeEventListener('keypress', idHandler);
            if (passwordHandler) passwordInput.removeEventListener('keypress', passwordHandler);

            const idEnterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    passwordInput.focus();
                }
            };
            const passwordEnterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addAdminAccount();
                }
            };

            idInput.addEventListener('keypress', idEnterHandler);
            passwordInput.addEventListener('keypress', passwordEnterHandler);

            idInput._enterHandler = idEnterHandler;
            passwordInput._enterHandler = passwordEnterHandler;

            requestAnimationFrame(() => {
                modal.classList.add('show');
                setTimeout(() => {
                    idInput.focus();
                }, 50);
            });
        }

        function closeAddAdminModal() {
            const modal = document.getElementById('addAdminModal');
            if (!modal) return;

            modal.classList.remove('show');

            setTimeout(() => {
                document.getElementById('newAdminId').value = '';
                document.getElementById('newAdminPassword').value = '';
            }, 150);
        }

        async function addAdminAccount() {
            const id = document.getElementById('newAdminId').value.trim();
            const password = document.getElementById('newAdminPassword').value.trim();

            if (!id || !password) {
                await customAlert('ËØ∑Â°´ÂÜôÁÆ°ÁêÜÂëòIDÂíåÂØÜÁ†Å');
                return;
            }

            if (adminAccounts.some(a => a.id === id)) {
                closeAddAdminModal();
                setTimeout(async () => {
                    await customAlert('ËØ•ÁÆ°ÁêÜÂëòIDÂ∑≤Â≠òÂú®');
                }, 300);
                return;
            }

            try {
                // Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÁÆ°ÁêÜÂëòÁöÑ tokenÔºà‰ªé localStorageÔºâ
                const adminToken = localStorage.getItem('admin_token');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                // Â¶ÇÊûúÊúâÁÆ°ÁêÜÂëò tokenÔºåÊ∑ªÂä†ËÆ§ËØÅÂ§¥
                if (adminToken) {
                    headers['Authorization'] = `Bearer ${adminToken}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/admin/account`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        admin_id: id,
                        password: password
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.warn('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Âà∞Êï∞ÊçÆÂ∫ìÂ§±Ë¥•:', errorData.message || response.statusText);
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:addAdminAccount',message:'admin_account_create_failed',data:{status:response.status,ok:!!response.ok,has_admin_token:!!adminToken,msg:(errorData.message||response.statusText||'').slice(0,160)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix1',hypothesisId:'I'})}).catch(()=>{});
                    // #endregion
                    // Â¶ÇÊûúÊòØ 403 ÈîôËØØÔºåÊèêÁ§∫Áî®Êà∑ÈúÄË¶ÅÂÖàÁôªÂΩï
                    if (response.status === 403) {
                        closeAddAdminModal();
                        setTimeout(async () => {
                            await customAlert('ÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôêÊâçËÉΩÊ∑ªÂä†Êñ∞Ë¥¶Âè∑ÔºöËØ∑ÂÖàÁî®‚ÄúÁÆ°ÁêÜÂëòÁôªÂΩï‚ÄùËé∑Âèñ admin_tokenÔºà‰ªÖËæìÂÖ•ÊúçÂä°Âô®ÁÆ°ÁêÜÂØÜÁ†Å‰∏çÂ§üÔºâ');
                        }, 300);
                        return;
                    }
                    closeAddAdminModal();
                    setTimeout(async () => {
                        await customAlert(`‰øùÂ≠òÂ§±Ë¥•Ôºö${errorData.message || response.statusText || 'Êú™Áü•ÈîôËØØ'}`);
                    }, 300);
                    return;
                }
                
                // ÊàêÂäüÂêéÂÜçËêΩÊú¨Âú∞ÔºàÈÅøÂÖç‚ÄúÊï∞ÊçÆÂ∫ìÂ§±Ë¥•‰ΩÜÊú¨Âú∞ÊàêÂäü‚ÄùÁöÑÂÅáÂêåÊ≠•Ôºâ
                adminAccounts.push({ id, password, selectedServers: [] });
                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Âà∞localStorageÂ§±Ë¥•:', error);
                }

                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:addAdminAccount',message:'admin_account_create_ok',data:{status:response.status,has_admin_token:!!adminToken},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix1',hypothesisId:'I'})}).catch(()=>{});
                // #endregion
            } catch (error) {
                console.warn('Êó†Ê≥ïËøûÊé•Âà∞APIÊúçÂä°Âô®‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Ôºå‰ΩÜÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞:', error);
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/661a1d3a-ec13-48f6-864e-98e22d2f8027',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'WEB.html:addAdminAccount',message:'admin_account_create_exception',data:{err:(error&&error.message||String(error)).slice(0,200)},timestamp:Date.now(),sessionId:'debug-session',runId:'admin-fix1',hypothesisId:'I'})}).catch(()=>{});
                // #endregion
                closeAddAdminModal();
                setTimeout(async () => {
                    await customAlert('Êó†Ê≥ïËøûÊé•Âà∞API‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑ÔºàÊú™ÂÜôÂÖ•Êï∞ÊçÆÂ∫ìÔºâÔºåÊú¨Ê¨°‰∏ç‰ºö‰øùÂ≠òÂà∞Êú¨Âú∞‰ª•ÂÖçÈÄ†Êàê‰∏çÂêåÊ≠•');
                }, 300);
                return;
            }

            closeAddAdminModal();

            setTimeout(async () => {
                await customAlert('ÁÆ°ÁêÜÂëòË¥¶Âè∑Â∑≤Ê∑ªÂä†');
                updateAdminAccountDisplay();
            }, 150);
        }
 
        function showPasswordChangeModal() {
            const modal = document.getElementById('passwordChangeModal');
            if (!modal) return;

            const oldPasswordInput = document.getElementById('oldPasswordInput');
            const newPasswordInput = document.getElementById('newPasswordInput');

            oldPasswordInput.value = '';
            newPasswordInput.value = '';

            const oldHandler = oldPasswordInput._enterHandler;
            const newHandler = newPasswordInput._enterHandler;
            if (oldHandler) oldPasswordInput.removeEventListener('keypress', oldHandler);
            if (newHandler) newPasswordInput.removeEventListener('keypress', newHandler);

            const oldEnterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    newPasswordInput.focus();
                }
            };
            const newEnterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    updateServerManagerPassword();
                }
            };

            oldPasswordInput.addEventListener('keypress', oldEnterHandler);
            newPasswordInput.addEventListener('keypress', newEnterHandler);

            oldPasswordInput._enterHandler = oldEnterHandler;
            newPasswordInput._enterHandler = newEnterHandler;

            requestAnimationFrame(() => {
                modal.classList.add('show');
                setTimeout(() => {
                    oldPasswordInput.focus();
                }, 50);
            });
        }

        function closePasswordChangeModal() {
            const modal = document.getElementById('passwordChangeModal');
            if (!modal) return;

            modal.classList.remove('show');

            setTimeout(() => {
                document.getElementById('oldPasswordInput').value = '';
                document.getElementById('newPasswordInput').value = '';
            }, 150);
        }
 
        function showRechargeModal() {
            const modal = document.getElementById('rechargeModal');
            if (!modal) return;

            document.getElementById('rechargeUserIdInput').value = '';
            document.getElementById('rechargeAmountInput').value = '';
            document.getElementById('rechargeUserInfo').style.display = 'none';
            document.getElementById('rechargeRecordsList').innerHTML = '<div style="padding: 15px; text-align: center; color: #999;">ËØ∑ÂÖàÈ™åËØÅÁî®Êà∑‰ª•Êü•ÁúãÂÖÖÂÄºËÆ∞ÂΩï</div>';
            currentRechargeUserId = null;

            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
                document.getElementById('rechargeUserIdInput').focus();
            }, 10);

            const userIdInput = document.getElementById('rechargeUserIdInput');
            const amountInput = document.getElementById('rechargeAmountInput');

            if (userIdInput._enterHandler) {
                userIdInput.removeEventListener('keypress', userIdInput._enterHandler);
            }
            if (amountInput._enterHandler) {
                amountInput.removeEventListener('keypress', amountInput._enterHandler);
            }

            userIdInput._enterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    verifyRechargeUser();
                }
            };
            userIdInput.addEventListener('keypress', userIdInput._enterHandler);

            amountInput._enterHandler = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    confirmRecharge();
                }
            };
            amountInput.addEventListener('keypress', amountInput._enterHandler);
        }

        function closeRechargeModal() {
            const modal = document.getElementById('rechargeModal');
            if (!modal) return;

            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                document.getElementById('rechargeUserIdInput').value = '';
                document.getElementById('rechargeAmountInput').value = '';
                document.getElementById('rechargeUserInfo').style.display = 'none';
            }, 150);
        }

        //#region IDÂ∫ìÂäüËÉΩÊ®°Âùó
        let idLibraryAccounts = [];
        const ID_LIBRARY_STORAGE_KEY = 'idLibraryAccounts';

        function loadIdLibraryFromStorage() {
            try {
                const stored = localStorage.getItem(ID_LIBRARY_STORAGE_KEY);
                if (stored) {
                    idLibraryAccounts = JSON.parse(stored);
                    // Á°Æ‰øùÊØè‰∏™Ë¥¶Âè∑ÈÉΩÊúâusageStatusÂ≠óÊÆµ
                    idLibraryAccounts.forEach(acc => {
                        if (!acc.usageStatus) {
                            acc.usageStatus = 'new';
                        }
                    });
                }
            } catch (e) {
                console.error('Âä†ËΩΩIDÂ∫ìÂ§±Ë¥•:', e);
                idLibraryAccounts = [];
            }
        }

        function saveIdLibraryToStorage() {
            try {
                localStorage.setItem(ID_LIBRARY_STORAGE_KEY, JSON.stringify(idLibraryAccounts));
            } catch (e) {
                console.error('‰øùÂ≠òIDÂ∫ìÂ§±Ë¥•:', e);
            }
        }

        // ‰ªéÊúçÂä°Âô®ÂêåÊ≠•IDÂ∫ì
        async function syncIdLibraryFromServer() {
            try {
                // Ê£ÄÊü• API_BASE_URL ÊòØÂê¶ÂÆö‰πâ
                if (typeof API_BASE_URL === 'undefined') {
                    // console.warn('API_BASE_URL Êú™ÂÆö‰πâÔºåË∑≥ËøáÊúçÂä°Âô®ÂêåÊ≠•');
                    return false;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ÁßíË∂ÖÊó∂ÔºåÊõ¥Âø´Â§±Ë¥•

                const response = await fetch(`${API_BASE_URL}/id-library`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.accounts) {
                        idLibraryAccounts = data.accounts;
                        saveIdLibraryToStorage();
                        renderIdLibraryList();
                        console.log('‚úì IDÂ∫ìÂ∑≤‰ªéÊúçÂä°Âô®ÂêåÊ≠•');
                        return true;
                    }
                } else {
                    // console.warn('‰ªéÊúçÂä°Âô®ÂêåÊ≠•IDÂ∫ìÂ§±Ë¥•: HTTP', response.status);
                }
            } catch (e) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØÔºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩ
                // Âè™Âú®ÂºÄÂèëÊ®°Âºè‰∏ãËæìÂá∫ËØ¶ÁªÜÈîôËØØ
                // if (e.name === 'AbortError') {
                //     console.warn('‰ªéÊúçÂä°Âô®ÂêåÊ≠•IDÂ∫ìË∂ÖÊó∂');
                // } else {
                //     console.warn('‰ªéÊúçÂä°Âô®ÂêåÊ≠•IDÂ∫ìÂ§±Ë¥•:', e.message || e);
                // }
            }
            return false;
        }

        // ÂêåÊ≠•IDÂ∫ìÂà∞ÊâÄÊúâÊúçÂä°Âô®
        async function syncIdLibraryToServer() {
            try {
                // Ê£ÄÊü• API_BASE_URL ÊòØÂê¶ÂÆö‰πâ
                if (typeof API_BASE_URL === 'undefined') {
                    // console.warn('API_BASE_URL Êú™ÂÆö‰πâÔºåË∑≥ËøáÊúçÂä°Âô®ÂêåÊ≠•');
                    return false;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ÁßíË∂ÖÊó∂

                const response = await fetch(`${API_BASE_URL}/id-library`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accounts: idLibraryAccounts.map(acc => ({
                            appleId: acc.appleId,
                            password: acc.password,
                            status: acc.status || 'normal',
                            usageStatus: acc.usageStatus || 'new'
                        }))
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        console.log('‚úì IDÂ∫ìÂ∑≤ÂêåÊ≠•Âà∞ÊúçÂä°Âô®');
                        return true;
                    }
                } else {
                    // console.warn('ÂêåÊ≠•IDÂ∫ìÂà∞ÊúçÂä°Âô®Â§±Ë¥•: HTTP', response.status);
                }
            } catch (e) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØÔºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩ
                // if (e.name === 'AbortError') {
                //     console.warn('ÂêåÊ≠•IDÂ∫ìÂà∞ÊúçÂä°Âô®Ë∂ÖÊó∂');
                // } else {
                //     console.warn('ÂêåÊ≠•IDÂ∫ìÂà∞ÊúçÂä°Âô®Â§±Ë¥•:', e.message || e);
                // }
            }
            return false;
        }

        // ‰ªéÊúçÂä°Âô®Âà†Èô§ID
        async function deleteIdFromServer(appleId) {
            try {
                // Ê£ÄÊü• API_BASE_URL ÊòØÂê¶ÂÆö‰πâ
                if (typeof API_BASE_URL === 'undefined') {
                    return false;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ÁßíË∂ÖÊó∂

                const response = await fetch(`${API_BASE_URL}/id-library/${encodeURIComponent(appleId)}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return response.ok;
            } catch (e) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØ
                if (e.name !== 'AbortError') {
                    console.warn('‰ªéÊúçÂä°Âô®Âà†Èô§IDÂ§±Ë¥•:', e.message || e);
                }
                return false;
            }
        }

        // Êõ¥Êñ∞IDÁöÑ‰ΩøÁî®Áä∂ÊÄÅÂà∞ÊúçÂä°Âô®
        async function updateIdUsageStatusOnServer(appleId, usageStatus) {
            try {
                // Ê£ÄÊü• API_BASE_URL ÊòØÂê¶ÂÆö‰πâ
                if (typeof API_BASE_URL === 'undefined') {
                    return false;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ÁßíË∂ÖÊó∂

                const response = await fetch(`${API_BASE_URL}/id-library/${encodeURIComponent(appleId)}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        usageStatus: usageStatus
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return response.ok;
            } catch (e) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØ
                if (e.name !== 'AbortError') {
                    console.warn('Êõ¥Êñ∞ID‰ΩøÁî®Áä∂ÊÄÅÂ§±Ë¥•:', e.message || e);
                }
                return false;
            }
        }

        async function showIdLibraryModal() {
            const modal = document.getElementById('idLibraryModal');
            if (!modal) return;

            // ÂÖàÂ∞ùËØï‰ªéÊúçÂä°Âô®ÂêåÊ≠•Êï∞ÊçÆÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
            try {
                await syncIdLibraryFromServer();
            } catch (e) {
                // ÂøΩÁï•ÂêåÊ≠•ÈîôËØØ
            }
            
            // Â¶ÇÊûúÊúçÂä°Âô®ÂêåÊ≠•Â§±Ë¥•ÊàñÊ≤°ÊúâÊï∞ÊçÆÔºåÂàô‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩ
            if (idLibraryAccounts.length === 0) {
                loadIdLibraryFromStorage();
            }
            renderIdLibraryList();

            document.getElementById('idLibraryAppleId').value = '';
            document.getElementById('idLibraryPassword').value = '';

            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
                document.getElementById('idLibraryAppleId').focus();
            }, 10);
        }

        function closeIdLibraryModal() {
            const modal = document.getElementById('idLibraryModal');
            if (!modal) return;

            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 150);
        }

        function toggleIdLibraryPassword() {
            const input = document.getElementById('idLibraryPassword');
            const btn = input.parentElement.querySelector('.password-toggle-btn');
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅ';
            }
        }

        async function saveIdLibraryAccount() {
            const appleId = document.getElementById('idLibraryAppleId').value.trim();
            const password = document.getElementById('idLibraryPassword').value.trim();

            if (!appleId) {
                await customAlert('ËØ∑ËæìÂÖ•Apple ID');
                return;
            }
            if (!password) {
                await customAlert('ËØ∑ËæìÂÖ•ÂØÜÁ†Å');
                return;
            }

            const exists = idLibraryAccounts.find(acc => acc.appleId.toLowerCase() === appleId.toLowerCase());
            if (exists) {
                if (await customConfirm(`Ë¥¶Âè∑ ${appleId} Â∑≤Â≠òÂú®ÔºåÊòØÂê¶Êõ¥Êñ∞ÂØÜÁ†ÅÔºü`)) {
                    exists.password = password;
                    exists.updatedAt = new Date().toISOString();
                } else {
                    return;
                }
            } else {
                idLibraryAccounts.push({
                    appleId: appleId,
                    password: password,
                    status: 'normal',
                    usageStatus: 'new',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
            }

            saveIdLibraryToStorage();
            renderIdLibraryList();
            
            // Â∞ùËØïÂêåÊ≠•Âà∞ÊúçÂä°Âô®ÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
            try {
                await syncIdLibraryToServer();
            } catch (e) {
                // ÂøΩÁï•ÂêåÊ≠•ÈîôËØØ
            }

            document.getElementById('idLibraryAppleId').value = '';
            document.getElementById('idLibraryPassword').value = '';
            document.getElementById('idLibraryAppleId').focus();
        }

        function importIdLibraryAccounts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.csv';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    const lines = text.split(/\r?\n/).filter(line => line.trim());
                    let imported = 0;
                    let skipped = 0;

                    for (const line of lines) {
                        const parts = line.split(/[,\t:\-]+/).map(p => p.trim());
                        if (parts.length >= 2) {
                            const appleId = parts[0];
                            const password = parts[1];

                            if (appleId && password) {
                                const exists = idLibraryAccounts.find(acc => acc.appleId.toLowerCase() === appleId.toLowerCase());
                                if (!exists) {
                                    idLibraryAccounts.push({
                                        appleId: appleId,
                                        password: password,
                                        status: 'normal',
                                        usageStatus: 'new',
                                        createdAt: new Date().toISOString(),
                                        updatedAt: new Date().toISOString()
                                    });
                                    imported++;
                                } else {
                                    skipped++;
                                }
                            }
                        }
                    }

                    saveIdLibraryToStorage();
                    renderIdLibraryList();
                    
                    // Â∞ùËØïÂêåÊ≠•Âà∞ÊúçÂä°Âô®ÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
                    try {
                        await syncIdLibraryToServer();
                    } catch (e) {
                        // ÂøΩÁï•ÂêåÊ≠•ÈîôËØØ
                    }
                    
                    await customAlert(`ÂØºÂÖ•ÂÆåÊàêÔºÅ\nÊñ∞Â¢û: ${imported} ‰∏™\nË∑≥Ëøá(Â∑≤Â≠òÂú®): ${skipped} ‰∏™`);
                } catch (err) {
                    console.error('ÂØºÂÖ•Â§±Ë¥•:', err);
                    await customAlert('ÂØºÂÖ•Â§±Ë¥•: ' + err.message);
                }
            };
            input.click();
        }

        async function clearAllIdLibraryAccounts() {
            if (idLibraryAccounts.length === 0) {
                await customAlert('ÂàóË°®Â∑≤‰∏∫Á©∫');
                return;
            }

            if (await customConfirm(`Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâ ${idLibraryAccounts.length} ‰∏™Ë¥¶Âè∑ÂêóÔºü\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`)) {
                // Â∞ùËØï‰ªéÊúçÂä°Âô®Âà†Èô§ÊâÄÊúâIDÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
                try {
                    for (const account of idLibraryAccounts) {
                        await deleteIdFromServer(account.appleId);
                    }
                } catch (e) {
                    // ÂøΩÁï•Âà†Èô§ÈîôËØØ
                }
                
                idLibraryAccounts = [];
                saveIdLibraryToStorage();
                renderIdLibraryList();
            }
        }

        async function deleteIdLibraryAccount(index) {
            if (index < 0 || index >= idLibraryAccounts.length) return;

            const account = idLibraryAccounts[index];
            if (await customConfirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Ë¥¶Âè∑ ${account.appleId} ÂêóÔºü`)) {
                idLibraryAccounts.splice(index, 1);
                saveIdLibraryToStorage();
                renderIdLibraryList();
                
                // Â∞ùËØï‰ªéÊúçÂä°Âô®Âà†Èô§ÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
                try {
                    await deleteIdFromServer(account.appleId);
                } catch (e) {
                    // ÂøΩÁï•Âà†Èô§ÈîôËØØ
                }
            }
        }

        function fillIdLibraryAccount(index) {
            if (index < 0 || index >= idLibraryAccounts.length) return;

            const account = idLibraryAccounts[index];
            document.getElementById('idLibraryAppleId').value = account.appleId;
            document.getElementById('idLibraryPassword').value = account.password;
            document.getElementById('idLibraryAppleId').focus();
        }

        function toggleIdLibraryAccountStatus(index) {
            if (index < 0 || index >= idLibraryAccounts.length) return;

            const account = idLibraryAccounts[index];
            account.status = account.status === 'normal' ? 'error' : 'normal';
            account.updatedAt = new Date().toISOString();
            saveIdLibraryToStorage();
            renderIdLibraryList();
            
            // Â∞ùËØïÂêåÊ≠•Âà∞ÊúçÂä°Âô®ÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
            try {
                syncIdLibraryToServer();
            } catch (e) {
                // ÂøΩÁï•ÂêåÊ≠•ÈîôËØØ
            }
        }

        async function toggleIdLibraryUsageStatus(index) {
            if (index < 0 || index >= idLibraryAccounts.length) return;

            const account = idLibraryAccounts[index];
            const newStatus = account.usageStatus === 'new' ? 'used' : 'new';
            account.usageStatus = newStatus;
            account.updatedAt = new Date().toISOString();
            saveIdLibraryToStorage();
            renderIdLibraryList();
            
            // Â∞ùËØïÂêåÊ≠•Âà∞ÊúçÂä°Âô®ÔºàÈùôÈªòÂ§±Ë¥•Ôºå‰∏çÂΩ±ÂìçÊú¨Âú∞ÂäüËÉΩÔºâ
            try {
                await updateIdUsageStatusOnServer(account.appleId, newStatus);
            } catch (e) {
                // ÂøΩÁï•ÂêåÊ≠•ÈîôËØØ
            }
        }

        function maskPassword(password) {
            if (!password) return '';
            if (password.length <= 4) return '****';
            return password.substring(0, 2) + '****' + password.substring(password.length - 2);
        }

        function renderIdLibraryList() {
            const listContainer = document.getElementById('idLibraryList');
            if (!listContainer) return;

            if (idLibraryAccounts.length === 0) {
                listContainer.innerHTML = `
                    <div class="id-library-empty">
                        <div class="empty-icon">üì≠</div>
                        <div class="empty-text">ÊöÇÊó†Ë¥¶Âè∑</div>
                        <div class="empty-hint">ÁÇπÂáª"‰øùÂ≠ò"Ê∑ªÂä†Ë¥¶Âè∑ÔºåÊàñ"ÂØºÂÖ•"ÊâπÈáèÂØºÂÖ•</div>
                    </div>
                `;
            } else {
                listContainer.innerHTML = idLibraryAccounts.map((account, index) => `
                    <div class="id-library-item ${account.status === 'error' ? 'error' : ''}">
                        <div class="item-col col-index">${index + 1}</div>
                        <div class="item-col col-account">${escapeHtml(account.appleId)}</div>
                        <div class="item-col col-password">${maskPassword(account.password)}</div>
                        <div class="item-col col-status">
                            <span class="status-badge ${account.status || 'normal'}" onclick="toggleIdLibraryAccountStatus(${index})" style="cursor: pointer;" title="ÁÇπÂáªÂàáÊç¢Áä∂ÊÄÅ">
                                ${(account.status || 'normal') === 'normal' ? 'Ê≠£Â∏∏' : 'ÂºÇÂ∏∏'}
                            </span>
                        </div>
                        <div class="item-col col-usage-status">
                            <span class="usage-status-badge ${account.usageStatus || 'new'}" onclick="toggleIdLibraryUsageStatus(${index})" title="ÁÇπÂáªÂàáÊç¢‰ΩøÁî®Áä∂ÊÄÅ">
                                ${(account.usageStatus || 'new') === 'new' ? 'NEW' : 'USED'}
                            </span>
                        </div>
                        <div class="item-col col-actions">
                            <button class="item-action-btn btn-fill" onclick="fillIdLibraryAccount(${index})" title="Â°´ÂÖÖÂà∞ËæìÂÖ•Ê°Ü">Â°´ÂÖÖ</button>
                            <button class="item-action-btn btn-delete" onclick="deleteIdLibraryAccount(${index})" title="Âà†Èô§Ê≠§Ë¥¶Âè∑">Âà†Èô§</button>
                        </div>
                    </div>
                `).join('');
            }

            const normalCount = idLibraryAccounts.filter(acc => acc.status === 'normal').length;
            const errorCount = idLibraryAccounts.filter(acc => acc.status === 'error').length;

            document.getElementById('idLibraryTotal').textContent = idLibraryAccounts.length;
            document.getElementById('idLibraryNormal').textContent = normalCount;
            document.getElementById('idLibraryError').textContent = errorCount;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        //#endregion

        let currentRechargeUserId = null;
        async function verifyRechargeUser() {
            const userId = document.getElementById('rechargeUserIdInput').value.trim();
            if (!userId) {
                await customAlert('ËØ∑ËæìÂÖ•Áî®Êà∑ID');
                return;
            }

            try {
                const creditsResp = await fetch(`${API_BASE_URL}/user/${userId}/credits`);
                if (!creditsResp.ok) {
                    if (creditsResp.status === 404) {
                        await customAlert('Áî®Êà∑‰∏çÂ≠òÂú®');
                        return;
                    }
                    throw new Error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');
                }

                const creditsData = await creditsResp.json();
                if (!creditsData.success) {
                    await customAlert('Áî®Êà∑‰∏çÂ≠òÂú®');
                    return;
                }

                const userResp = await fetch(`${API_BASE_URL}/user/${userId}/statistics`);
                let userData = null;
                if (userResp.ok) {
                    const data = await userResp.json();
                    if (data.success) {
                        userData = data;
                    }
                }

                currentRechargeUserId = creditsData.user_id || userId;
                const credits = creditsData.credits || 0;

                const usage = userData?.usage || [];
                const rechargeRecords = usage.filter(item => item.action === 'recharge');
                const lastRecharge = rechargeRecords.length > 0 ? rechargeRecords[rechargeRecords.length - 1] : null;

                let totalSpent = 0;
                usage.forEach(item => {
                    if (item.action !== 'recharge' && item.credits) {
                        totalSpent += parseFloat(item.credits) || 0;
                    }
                });

                document.getElementById('rechargeInfoUserId').textContent = currentRechargeUserId;
                document.getElementById('rechargeInfoUsername').textContent = creditsData.username || userData?.username || userId || '-';
                document.getElementById('rechargeInfoCredits').textContent = credits.toFixed(2);
                if (lastRecharge) {
                    const lastRechargeTime = lastRecharge.ts ? new Date(lastRecharge.ts).toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : '-';
                    const lastRechargeAmount = parseFloat(lastRecharge.amount || 0).toFixed(2);
                    document.getElementById('rechargeInfoLastRecharge').textContent = `${lastRechargeTime} (${lastRechargeAmount})`;
                } else {
                    document.getElementById('rechargeInfoLastRecharge').textContent = 'Êó†';
                }
                document.getElementById('rechargeInfoTotalSpent').textContent = totalSpent.toFixed(2);
                const createdDate = userData?.created ? new Date(userData.created).toLocaleString('zh-CN') : '-';
                document.getElementById('rechargeInfoCreated').textContent = createdDate;

                document.getElementById('rechargeUserInfo').style.display = 'block';

                displayRechargeRecords(rechargeRecords);

            } catch (error) {
                console.error('È™åËØÅÁî®Êà∑Â§±Ë¥•:', error);
                await customAlert('È™åËØÅÁî®Êà∑Â§±Ë¥•: ' + error.message);
            }
        }

        function displayRechargeRecords(records) {
            const container = document.getElementById('rechargeRecordsList');
            if (!records || records.length === 0) {
                container.innerHTML = '<div style="padding: 15px; text-align: center; color: #999;">ÊöÇÊó†ÂÖÖÂÄºËÆ∞ÂΩï</div>';
                return;
            }

            const sortedRecords = records.sort((a, b) => {
                const timeA = new Date(a.ts || 0).getTime();
                const timeB = new Date(b.ts || 0).getTime();
                return timeB - timeA;
            });

            let html = '<div style="display: grid; grid-template-columns: 80px 1fr 200px 150px; gap: 15px; padding: 12px 15px; background: #f9f9f9; font-weight: bold; border-bottom: 2px solid #ddd; font-size: 14px;">';
            html += '<div>ËÆ∞ÂΩï</div><div>Áî®Êà∑</div><div>Êó∂Èó¥</div><div style="text-align: right;">ÂÖÖÂÄºÈáëÈ¢ù</div></div>';

            sortedRecords.forEach((record, index) => {
                const time = record.ts ? new Date(record.ts).toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : '-';
                const amount = parseFloat(record.amount || 0).toFixed(2);
                const bgColor = index % 2 === 0 ? '#fff' : '#f9f9f9';
                html += `<div style="display: grid; grid-template-columns: 80px 1fr 200px 150px; gap: 15px; padding: 12px 15px; background: ${bgColor}; border-bottom: 1px solid #eee; font-size: 14px; align-items: center;">`;
                html += `<div style="color: #666;">${index + 1}</div>`;
                html += `<div style="color: #333;">${currentRechargeUserId}</div>`;
                html += `<div style="color: #666; font-size: 13px;">${time}</div>`;
                html += `<div style="color: #4CAF50; font-weight: bold; text-align: right;">+${amount}</div>`;
                html += '</div>';
            });

            container.innerHTML = html;
        }

        async function confirmRecharge() {
            if (!currentRechargeUserId) {
                await customAlert('ËØ∑ÂÖàÈ™åËØÅÁî®Êà∑');
                return;
            }

            const amount = parseFloat(document.getElementById('rechargeAmountInput').value);
            if (!amount || amount <= 0) {
                await customAlert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂÖÖÂÄºÈáëÈ¢ù');
                return;
            }

            if (!await customConfirm(`Á°ÆËÆ§ÁªôÁî®Êà∑ ${currentRechargeUserId} ÂÖÖÂÄº ${amount} ÁßØÂàÜÂêóÔºü`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${currentRechargeUserId}/recharge`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: amount
                    })
                });

                const data = await response.json();
                if (data.success) {
                    await customAlert(`ÂÖÖÂÄºÊàêÂäüÔºÅÁî®Êà∑ÂΩìÂâç‰ΩôÈ¢ù: ${data.credits.toFixed(2)}`);
                    document.getElementById('rechargeAmountInput').value = '';
                    await verifyRechargeUser();
                } else {
                    const errorMsg = data.message || 'Êú™Áü•ÈîôËØØ';
                    await customAlert('ÂÖÖÂÄºÂ§±Ë¥•: ' + errorMsg);
                }
            } catch (error) {
                console.error('ÂÖÖÂÄºÂ§±Ë¥•:', error);
                await customAlert('ÂÖÖÂÄºÂ§±Ë¥•: ' + error.message);
            }
        }

        async function updateServerManagerPassword() {
            const oldPassword = document.getElementById('oldPasswordInput').value.trim();
            const newPassword = document.getElementById('newPasswordInput').value.trim();

            if (!oldPassword) {
                await customAlert('ËØ∑ËæìÂÖ•ÊóßÂØÜÁ†Å');
                document.getElementById('oldPasswordInput').focus();
                return;
            }

            if (!newPassword) {
                await customAlert('ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å');
                document.getElementById('newPasswordInput').focus();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/server-manager/password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        oldPassword: oldPassword,
                        password: newPassword
                    })
                });

                const data = await response.json();

                if (data.success) {
                    setTimeout(async () => {
                        await customAlert('‰øÆÊîπÊàêÂäü');
                        closePasswordChangeModal();
                    }, 100);
                } else {
                    await customAlert(data.message || 'Êõ¥Êñ∞Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊóßÂØÜÁ†ÅÊòØÂê¶Ê≠£Á°Æ');
                    document.getElementById('oldPasswordInput').focus();
                }
            } catch (error) {
                console.error('Êõ¥Êñ∞ÊúçÂä°Âô®ÁÆ°ÁêÜÂØÜÁ†ÅÂ§±Ë¥•:', error);
                await customAlert('ÁΩëÁªúÈîôËØØÔºåËØ∑Ê£ÄÊü•APIÊúçÂä°Âô®ËøûÊé•');
            }
        }

        async function editAdminAccount(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            const newPassword = await customPrompt('ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å:', account.password);
            if (newPassword && newPassword.trim()) {
                account.password = newPassword.trim();
                updateAdminAccountDisplay();
            }
        }

        async function deleteAdminAccount(adminId) {
            const confirmed = await customConfirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•ÁÆ°ÁêÜÂëòË¥¶Êà∑ÂêóÔºü');
            if (confirmed) {
                try {
                    const response = await fetch(`${API_BASE_URL}/admin/account/${adminId}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (response.ok) {
                        adminAccounts = adminAccounts.filter(a => a.id !== adminId);
                        updateAdminAccountDisplay();
                    } else {
                        const errorData = await response.json();
                        await customAlert(errorData.message || 'Âà†Èô§ÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•');
                    }
                } catch (error) {
                    await customAlert('Êó†Ê≥ïËøûÊé•Âà∞APIÊúçÂä°Âô®: ' + error.message);
                }
            }
        }

        function updateAdminAccountDisplay() {
            const container = document.getElementById('adminAccountList');
            const fragment = document.createDocumentFragment();
            container.innerHTML = '';
            adminAccounts.forEach(account => {
                const item = document.createElement('div');
                item.className = 'admin-account-item';
                const serverCount = (account.selectedServers && account.selectedServers.length) || 0;
                item.innerHTML = `
                    <span class="admin-account-name">
                        <span class="admin-account-badge">${serverCount}</span>
                        ${account.id}
                    </span>
                    <div class="admin-account-actions">
                        <button class="admin-account-action-btn manage" onclick="manageAdminAccount('${account.id}')">ÁÆ°ÁêÜ</button>
                    </div>
                `;
                fragment.appendChild(item);
            });
            container.appendChild(fragment);
        }

        async function manageAdminAccount(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            if (!account.selectedServers) account.selectedServers = [];

            const allServerObjs = [...serverData.connected, ...serverData.disconnected];
            const allServers = allServerObjs.map(s => s.name || s.server_name || s.server_id);

            const panel = document.getElementById('customModalPanel');
            panel.classList.add('admin-manage-modal');

            const content = document.getElementById('customModalContent');
            content.className = 'admin-manage-content';

            const titleEl = document.getElementById('customModalTitle');
            const messageEl = document.getElementById('customModalMessage');
            const buttonsEl = document.getElementById('customModalButtons');
            const inputEl = document.getElementById('customModalInput');

            titleEl.textContent = `ÁÆ°ÁêÜÁÆ°ÁêÜÂëò: ${account.id}`;
            messageEl.innerHTML = `
                <div class="admin-manage-info-row">
                    <div class="admin-manage-info">
                        <div class="admin-manage-info-item">
                            <span class="admin-manage-info-label">ID:</span>
                            <span>${account.id}</span>
                        </div>
                        <div class="admin-manage-info-item">
                            <span class="admin-manage-info-label">ÂØÜÁ†Å:</span>
                            <span style="font-family: monospace;">${account.password}</span>
                        </div>
                    </div>
                    <div class="admin-manage-actions">
                        <button class="admin-account-action-btn edit" onclick="editAdminPasswordInModal('${adminId}')">‰øÆÊîπÂØÜÁ†Å</button>
                        <button class="admin-account-action-btn delete" onclick="deleteAdminInModal('${adminId}')">Âà†Èô§Ë¥¶Âè∑</button>
                    </div>
                </div>
                <div class="admin-manage-permission-row">
                    <div class="admin-manage-permission-label">ÁÆ°ÁêÜÊùÉÈôê:</div>
                    <div class="admin-manage-servers-label">ÂèØÁÆ°ÁêÜÁöÑÂêéÁ´ØÊúçÂä°Âô®:</div>
                    <div class="server-buttons-grid" id="adminManageServersGrid">
                        ${allServers.length > 0 ? allServers.map(server => {
                const serverStr = String(server).trim();
                const isSelected = account.selectedServers.some(selected =>
                    String(selected).trim() === serverStr
                );
                const escapedServer = serverStr.replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/\\/g, '\\\\');
                            return `<button class="server-button connected ${isSelected ? 'selected' : ''}"
                                    onclick="toggleServerSelection('${adminId}', '${escapedServer}', this)">
                                        <div class="server-button-name">${escapedServer}</div>
                                </button>`;
                        }).join('') : '<div style="padding: 10px; color: #666; text-align: center;">ÊöÇÊó†ÂèØÁî®ÊúçÂä°Âô®</div>'}
                    </div>
                </div>
            `;
            inputEl.style.display = 'none';

            buttonsEl.innerHTML = `
                <button class="admin-manage-footer-btn reset" onclick="resetAdminSelection('${adminId}')">ÈáçÁΩÆ</button>
                <button class="admin-manage-footer-btn select-all" onclick="selectAllServers('${adminId}')">ÂÖ®ÈÄâ</button>
                <button class="admin-manage-footer-btn confirm" onclick="confirmAdminManage('${adminId}')">Á°ÆÂÆö</button>
            `;

            const modal = document.getElementById('customModal');
            requestAnimationFrame(() => {
                modal.classList.add('show');
            });
        }

        function toggleServerSelection(adminId, serverName, button) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            if (!account.selectedServers) account.selectedServers = [];

            const index = account.selectedServers.indexOf(serverName);
            if (index > -1) {
                account.selectedServers.splice(index, 1);
                button.classList.remove('selected');
            } else {
                account.selectedServers.push(serverName);
                button.classList.add('selected');
            }
        }

        function resetAdminSelection(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            account.selectedServers = [];
            const grid = document.getElementById('adminManageServersGrid');
            const buttons = grid.querySelectorAll('.server-button');
            buttons.forEach(btn => btn.classList.remove('selected'));
        }

        function selectAllServers(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            const allServers = [...serverData.connected, ...serverData.disconnected].map(s => {
                return s.name || s.server_name || s.server_id || String(s);
            });

            account.selectedServers = [...allServers];
            const grid = document.getElementById('adminManageServersGrid');
            const buttons = grid.querySelectorAll('.server-button');
            buttons.forEach(btn => btn.classList.add('selected'));
        }

        async function confirmAdminManage(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            const grid = document.getElementById('adminManageServersGrid');
            if (grid) {
                const selectedButtons = grid.querySelectorAll('.server-button.selected');
                account.selectedServers = Array.from(selectedButtons).map(btn => (btn.textContent || '').trim());
            }

            try {
                localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
            } catch (error) {
                console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Âà∞localStorageÂ§±Ë¥•:', error);
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/account/${adminId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        selected_servers: account.selectedServers || []
                    })
                });

                if (!response.ok) {
                    console.warn('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑ÈÖçÁΩÆÂà∞Êï∞ÊçÆÂ∫ìÂ§±Ë¥•Ôºå‰ΩÜÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞');
                }
            } catch (error) {
                console.warn('Êó†Ê≥ïËøûÊé•Âà∞APIÊúçÂä°Âô®‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑ÈÖçÁΩÆÔºå‰ΩÜÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞:', error);
            }

            closeCustomModal();

            updateAdminAccountDisplay();

            setTimeout(async () => {
                await customAlert('ÁÆ°ÁêÜÂëòÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');
            }, 300);
        }

        async function editAdminPasswordInModal(adminId) {
            const account = adminAccounts.find(a => a.id === adminId);
            if (!account) return;

            const newPassword = await customPrompt('ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å:', account.password);
            if (newPassword && newPassword.trim()) {
                account.password = newPassword.trim();
                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•:', error);
                }
                setTimeout(() => {
                    manageAdminAccount(adminId);
                }, 350);
            }
        }

        async function deleteAdminInModal(adminId) {
            const confirmed = await customConfirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•ÁÆ°ÁêÜÂëòË¥¶Êà∑ÂêóÔºü');
            if (confirmed) {
                adminAccounts = adminAccounts.filter(a => a.id !== adminId);

                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Âà∞localStorageÂ§±Ë¥•:', error);
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/admin/account/${adminId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        console.warn('‰ªéÊï∞ÊçÆÂ∫ìÂà†Èô§ÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•Ôºå‰ΩÜÂ∑≤‰ªéÊú¨Âú∞Âà†Èô§');
                    }
                } catch (error) {
                    console.warn('Êó†Ê≥ïËøûÊé•Âà∞APIÊúçÂä°Âô®Âà†Èô§ÁÆ°ÁêÜÂëòË¥¶Âè∑Ôºå‰ΩÜÂ∑≤‰ªéÊú¨Âú∞Âà†Èô§:', error);
                }

                closeCustomModal();
                updateAdminAccountDisplay();
            }
        }

        //#endregion
        //#region ÁÆ°ÁêÜÂëòÈ°µÈù¢ÂäüËÉΩÊ®°ÂùóÔºàÁî®Êà∑ÁÆ°ÁêÜ„ÄÅÊúçÂä°Âô®ÂàÜÈÖçÔºâ
        let currentManagerId = null;
        let managerUsers = [];
        let managerUserGroups = [];
        let currentGroupCreation = null;

        async function loginAsManager(managerId) {
            const account = adminAccounts.find(a => a.id === managerId);
            if (!account) {
                await customAlert('ÁÆ°ÁêÜÂëòË¥¶Êà∑‰∏çÂ≠òÂú®');
                return;
            }

            currentManagerId = managerId;

            const loginPage = document.getElementById('loginPage');
            if (loginPage) {
                loginPage.style.display = 'none';
            }
            document.body.classList.remove('login-mode');

            const managerPage = document.getElementById('managerPage');
            if (managerPage) {
                managerPage.style.display = 'block';
                managerPage.classList.add('show');
                
                // ‰øÆÂ§çÔºöÊ£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
                const managerIdDisplay = document.getElementById('managerIdDisplay');
                if (managerIdDisplay) {
                    managerIdDisplay.textContent = managerId;
                }
                
                const adminNumberDisplay = document.getElementById('adminNumberDisplay');
                if (adminNumberDisplay) {
                    const adminIndex = adminAccounts.findIndex(a => a.id === managerId);
                    adminNumberDisplay.textContent = adminIndex >= 0 ? (adminIndex + 1) : '1';
                }
            } else {
                console.error('Êâæ‰∏çÂà∞ÁÆ°ÁêÜÂëòÈ°µÈù¢ÂÖÉÁ¥† #managerPage');
                await customAlert('ÁÆ°ÁêÜÂëòÈ°µÈù¢Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                return;
            }

      
        

            if (!account.users) account.users = [];
            if (!account.userGroups) account.userGroups = [];
            managerUsers = account.users || [];
            managerUserGroups = account.userGroups || [];

            try {
                await loadServersFromAPI();
            } catch (error) {
                console.error('Âä†ËΩΩÊúçÂä°Âô®Êï∞ÊçÆÂ§±Ë¥•:', error);
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/account/${managerId}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        if (data.selected_servers) {
                            account.selectedServers = data.selected_servers;
                        }
                        localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                    }
                }
            } catch (error) {
                console.warn('‰ªéAPIÂä†ËΩΩÁÆ°ÁêÜÂëòÈÖçÁΩÆÂ§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ:', error);
            }

            requestAnimationFrame(() => {
                updateManagerDisplay();
            });

            const schedulePerformanceLoad = (callback) => {
                if (window.requestIdleCallback) {
                    requestIdleCallback(callback, { timeout: 2000 });
                } else {
                    setTimeout(callback, 500);
                }
            };

            schedulePerformanceLoad(async () => {
                await loadManagerPerformance();
            });
        }

        async function backToLoginFromManager() {
            if (currentManagerId) {
                const account = adminAccounts.find(a => a.id === currentManagerId);
                if (account) {
                    account.users = managerUsers;
                    account.userGroups = managerUserGroups;
                }

                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòÊï∞ÊçÆÂ§±Ë¥•:', error);
                }
            }

            const result = await showCustomModal('ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'alert', '', [
                { text: 'ËøîÂõûÁôªÂΩïÁïåÈù¢', value: 'login' },
                { text: 'ËøõÂÖ•‰∏ªÈù¢Êùø', value: 'main' }
            ]);

            const managerPage = document.getElementById('managerPage');
            const loginPage = document.getElementById('loginPage');
            const contentWrapper = document.querySelector('.content-wrapper');

            if (managerPage) {
                managerPage.classList.remove('show');
                managerPage.style.display = 'none';
            }

            if (result === 'login') {
                if (loginPage) {
                    loginPage.style.display = 'flex';
                    document.body.classList.add('login-mode');
                }
                if (contentWrapper) {
                    contentWrapper.style.display = 'none';
                }
                currentManagerId = null;
                managerUsers = [];
                managerUserGroups = [];
                const userLoginTab = document.querySelector('.login-tab[data-tab="user"]');
                const adminLoginTab = document.querySelector('.login-tab[data-tab="admin"]');
                if (userLoginTab && adminLoginTab) {
                    userLoginTab.classList.add('active');
                    adminLoginTab.classList.remove('active');
                    const userLoginForm = document.getElementById('userLoginForm');
                    const adminLoginForm = document.getElementById('adminLoginForm');
                    if (userLoginForm && adminLoginForm) {
                        userLoginForm.style.display = 'block';
                        adminLoginForm.style.display = 'none';
                    }
                }
            } else if (result === 'main') {
                if (loginPage) {
                    loginPage.style.display = 'none';
                    document.body.classList.remove('login-mode');
                }
                if (managerPage) {
                    managerPage.style.display = 'none';
                    managerPage.classList.remove('show');
                }
                currentManagerId = null;
                if (contentWrapper) {
                    contentWrapper.style.display = 'flex';
                }
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    mainContainer.style.display = 'flex';
                }
                const navHomeBtn = document.getElementById('navHomeBtn');
                if (navHomeBtn && typeof navHomeBtn.click === 'function') {
                    navHomeBtn.click();
                }
            }
        }

        function isValidUserId(userId) {
            const dateIdPattern = /^(\d{2})(\d{2})(\d{1,3})$/;
            if (dateIdPattern.test(userId)) {
                const month = parseInt(userId.substring(0, 2));
                const day = parseInt(userId.substring(2, 4));
                if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                    return true;
                }
            }
            if (/^[a-zA-Z0-9]{4,}$/.test(userId)) {
                return true;
            }
            return false;
        }

        async function verifyUserExists(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/user/${userId}/credits`);
                if (response.ok) {
                    const data = await response.json();
                    return data.success;
                }
                return false;
            } catch (error) {
                console.error('È™åËØÅÁî®Êà∑Â§±Ë¥•:', error);
                return false;
            }
        }

        function showAddUserModal() {
            const modal = document.getElementById('addUserModal');
            if (!modal) return;

            document.getElementById('addUserUsername').value = '';
            document.getElementById('addUserUserId').value = '';

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    confirmAddUser();
                }
            };

            const usernameInput = document.getElementById('addUserUsername');
            const userIdInput = document.getElementById('addUserUserId');

            usernameInput.removeEventListener('keypress', handleKeyPress);
            userIdInput.removeEventListener('keypress', handleKeyPress);
            usernameInput.addEventListener('keypress', handleKeyPress);
            userIdInput.addEventListener('keypress', handleKeyPress);

            requestAnimationFrame(() => {
                modal.classList.add('show');
                setTimeout(() => {
                    document.getElementById('addUserUsername').focus();
                }, 100);
            });
        }

        function closeAddUserModal() {
            const modal = document.getElementById('addUserModal');
            if (!modal) return;

            modal.classList.remove('show');
            setTimeout(() => {
                document.getElementById('addUserUsername').value = '';
                document.getElementById('addUserUserId').value = '';
            }, 300);
        }

        async function confirmAddUser() {
            const username = document.getElementById('addUserUsername').value.trim();
            const userId = document.getElementById('addUserUserId').value.trim();

            if (!username && !userId) {
                await customAlert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÊàñÁî®Êà∑ID');
                return;
            }

            let finalUserId = userId;

            if (!finalUserId && username) {
                if (!isValidUserId(username)) {
                     await customAlert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁî®Êà∑IDÔºàÊ†ºÂºèÔºöMMDDNÔºåÂ¶Ç12111Ôºâ');
                     return;
                }
                finalUserId = username;
            }

            if (!isValidUserId(finalUserId)) {
                await customAlert('Áî®Êà∑IDÊ†ºÂºèÈîôËØØÔºÅ(Ê†ºÂºèÔºöMMDDNÔºåÂ¶Ç12111)');
                return;
            }

            const exists = await verifyUserExists(finalUserId);
            if (!exists) {
                await customAlert('Áî®Êà∑‰∏çÂ≠òÂú®ÔºÅËØ∑Ê£ÄÊü•IDÊòØÂê¶Ê≠£Á°Æ');
                return;
            }

            if (managerUsers.includes(finalUserId)) {
                await customAlert('ËØ•Áî®Êà∑Â∑≤Âú®ÁÆ°ÁêÜÂàóË°®‰∏≠');
                return;
            }

            managerUsers.push(finalUserId);

            const account = adminAccounts.find(a => a.id === currentManagerId);
            if (account) {
                account.users = managerUsers;
                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•:', error);
                }
            }

            closeAddUserModal();
            updateManagerDisplay();
            await loadManagerPerformance();
        }

        async function addUser() {
            await showAddUserModal();
        }

        async function removeUser(userId) {
            managerUsers = managerUsers.filter(u => u !== userId);
            managerUserGroups = managerUserGroups.filter(g => g.userId !== userId);

            const account = adminAccounts.find(a => a.id === currentManagerId);
            if (account) {
                account.users = managerUsers;
                account.userGroups = managerUserGroups;
                try {
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                } catch (error) {
                    console.error('‰øùÂ≠òÁÆ°ÁêÜÂëòË¥¶Âè∑Â§±Ë¥•:', error);
                }
            }

            updateManagerDisplay();
            await loadManagerPerformance();
        }

        function createGroup() {
            if (managerUsers.length === 0) {
                customAlert('ËØ∑ÂÖàÊ∑ªÂä†Áî®Êà∑');
                return;
            }

            currentGroupCreation = {
                userId: null,
                selectedServers: [],
                showingServers: false
            };

            updateManagerDisplay();
        }

        function selectUserForGroup(userId) {
            if (!currentGroupCreation) return;
            currentGroupCreation.userId = userId;
            updateManagerDisplay();
        }

        function showServerSelection() {
            if (!currentGroupCreation) return;
            currentGroupCreation.showingServers = !currentGroupCreation.showingServers;
            updateManagerDisplay();
        }

        function toggleServerForGroup(serverName) {
            if (!currentGroupCreation) return;

            const index = currentGroupCreation.selectedServers.indexOf(serverName);
            if (index > -1) {
                currentGroupCreation.selectedServers.splice(index, 1);
            } else {
                currentGroupCreation.selectedServers.push(serverName);
            }
            updateManagerDisplay();
        }

        async function confirmGroupCreation() {
            if (!currentGroupCreation || !currentGroupCreation.userId) {
                await customAlert('ËØ∑ÈÄâÊã©Áî®Êà∑');
                return;
            }

            if (currentGroupCreation.selectedServers.length === 0) {
                await customAlert('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÊúçÂä°Âô®');
                return;
            }

            const allServers = [
                ...serverData.connected,
                ...serverData.disconnected
            ];

            for (const serverName of currentGroupCreation.selectedServers) {
                const server = allServers.find(s => s.name === serverName);
                if (server && server.server_id) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/servers/${server.server_id}/assign`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                user_id: currentGroupCreation.userId
                            })
                        });
                        if (!response.ok) {
                            console.error(`ÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•`);
                        }
                    } catch (error) {
                        console.error(`ÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•:`, error);
                    }
                }
            }

            const existingGroup = managerUserGroups.find(g => g.userId === currentGroupCreation.userId);
            if (existingGroup) {
                existingGroup.servers = [...currentGroupCreation.selectedServers];
            } else {
                managerUserGroups.push({
                    userId: currentGroupCreation.userId,
                    servers: [...currentGroupCreation.selectedServers]
                });
            }

            currentGroupCreation = null;
            await loadServersFromAPI();
            updateManagerDisplay();
        }

        function resetGroupCreation() {
            currentGroupCreation = null;
            updateManagerDisplay();
        }

        function manageUserGroup(userId) {
            const group = managerUserGroups.find(g => g.userId === userId);
            if (!group) return;

            currentGroupCreation = {
                userId: userId,
                selectedServers: [...group.servers],
                showingServers: false
            };
            updateManagerDisplay();
        }

        async function deleteUserGroup(userId) {
            const group = managerUserGroups.find(g => g.userId === userId);
            if (group) {
                const allServers = [
                    ...serverData.connected,
                    ...serverData.disconnected
                ];

                for (const serverName of group.servers) {
                    const server = allServers.find(s => s.name === serverName);
                    if (server && server.server_id) {
                        try {
                            await fetch(`${API_BASE_URL}/servers/${server.server_id}/unassign`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' }
                            });
                        } catch (error) {
                            console.error(`ÂèñÊ∂àÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•:`, error);
                        }
                    }
                }
            }

            managerUserGroups = managerUserGroups.filter(g => g.userId !== userId);
            await loadServersFromAPI();
            updateManagerDisplay();
        }

        async function loadManagerPerformance() {
            if (!currentManagerId) return;

            try {
                let totalCredits = 0;
                const userPerformanceData = [];

                for (const userId of managerUsers) {
                    try {
                        let userCredits = 0;
                        try {
                            const response = await fetch(`${API_BASE_URL}/user/${userId}/statistics`, {
                                method: 'GET',
                                headers: { 'Content-Type': 'application/json' }
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data.consumption_logs && Array.isArray(data.consumption_logs)) {
                                    userCredits = data.consumption_logs.reduce((sum, log) => sum + (log.amount || 0), 0);
                                }
                            }
                        } catch (apiError) {
                            console.warn(`Ëé∑ÂèñÁî®Êà∑ ${userId} ÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº:`, apiError);
                        }

                        totalCredits += userCredits;
                        userPerformanceData.push({
                            userId: userId,
                            credits: userCredits
                        });
                    } catch (error) {
                        console.error(`Â§ÑÁêÜÁî®Êà∑ ${userId} Êï∞ÊçÆÂ§±Ë¥•:`, error);
                        userPerformanceData.push({
                            userId: userId,
                            credits: 0
                        });
                    }
                }

                const totalPerformanceDisplay = document.getElementById('totalPerformanceDisplay');
                if (totalPerformanceDisplay) {
                    totalPerformanceDisplay.textContent = totalCredits.toFixed(2);
                }

                const container = document.getElementById('performanceBriefContainer');
                container.innerHTML = '';

                userPerformanceData.forEach((item, index) => {
                    if (index % 2 === 0) {
                        const row = document.createElement('div');
                        row.style.display = 'flex';
                        row.style.gap = '10px';
                        row.style.width = '100%';
                        row.style.marginBottom = '10px';

                        const card1 = createPerformanceCard(item.userId, item.credits);
                        row.appendChild(card1);

                        if (index + 1 < userPerformanceData.length) {
                            const nextItem = userPerformanceData[index + 1];
                            const card2 = createPerformanceCard(nextItem.userId, nextItem.credits);
                            row.appendChild(card2);
                        } else {
                            const placeholder = document.createElement('div');
                            placeholder.style.flex = '1';
                            row.appendChild(placeholder);
                        }

                        container.appendChild(row);
                    }
                });
            } catch (error) {
                console.error('Âä†ËΩΩ‰∏öÁª©Êï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        function createPerformanceCard(userId, credits) {
            const card = document.createElement('div');
            card.style.cssText = `
                flex: 1;
                padding: 12px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                border-radius: 12px;
                border: 2px solid var(--border-dark);
                color: white;
                font-weight: bold;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            `;
            card.innerHTML = `
                <div style="font-size: 14px; margin-bottom: 5px;">${userId}</div>
                <div style="font-size: 16px; color: #ffd700;">${credits.toFixed(2)} ÁßØÂàÜ</div>
            `;
            return card;
        }

        async function fetchUserData(userId) {
            let userData = {
                userId: userId,
                credits: 0,
                lastAccess: 'Êú™Áü•',
                lastTaskCount: 0,
                lastSuccessRate: 0,
                lastSentCount: 0,
                lastCreditsUsed: 0,
                totalAccessCount: 0,
                totalSentCount: 0,
                totalSentAmount: 0,
                totalSuccessRate: 0,
                totalCreditsUsed: 0
            };

            try {
                try {
                    const creditsResponse = await fetch(`${API_BASE_URL}/user/${userId}/credits`);
                    if (creditsResponse.ok) {
                        const creditsData = await creditsResponse.json();
                        userData.credits = creditsData.credits || 0;
                    }
                } catch (error) {
                    console.warn('Ëé∑ÂèñÁî®Êà∑ÁßØÂàÜÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº:', error);
                }

                try {
                    const statsResponse = await fetch(`${API_BASE_URL}/user/${userId}/statistics`);
                    if (statsResponse.ok) {
                        const statsData = await statsResponse.json();
                        if (statsData.usage_logs && statsData.usage_logs.length > 0) {
                            const lastLog = statsData.usage_logs[statsData.usage_logs.length - 1];
                            userData.lastTaskCount = lastLog.task_count || 0;
                            userData.lastSentCount = lastLog.sent_count || 0;
                            userData.lastSuccessRate = lastLog.success_rate || 0;
                            userData.lastAccess = lastLog.timestamp || 'Êú™Áü•';
                        }
                        if (statsData.consumption_logs && statsData.consumption_logs.length > 0) {
                            const lastConsumption = statsData.consumption_logs[statsData.consumption_logs.length - 1];
                            userData.lastCreditsUsed = lastConsumption.amount || 0;
                        }

                        userData.totalAccessCount = statsData.usage_logs ? statsData.usage_logs.length : 0;
                        userData.totalSentCount = statsData.usage_logs ? statsData.usage_logs.reduce((sum, log) => sum + (log.sent_count || 0), 0) : 0;
                        userData.totalSentAmount = statsData.usage_logs ? statsData.usage_logs.reduce((sum, log) => sum + (log.total_sent || 0), 0) : 0;
                        userData.totalCreditsUsed = statsData.consumption_logs ? statsData.consumption_logs.reduce((sum, log) => sum + (log.amount || 0), 0) : 0;

                        if (userData.totalSentCount > 0) {
                            const totalSuccess = statsData.usage_logs ? statsData.usage_logs.reduce((sum, log) => sum + (log.success_count || 0), 0) : 0;
                            userData.totalSuccessRate = (totalSuccess / userData.totalSentCount * 100).toFixed(2);
                        }
                    }
                } catch (error) {
                    console.warn('Ëé∑ÂèñÁî®Êà∑ÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº:', error);
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•:', error);
            }

            return userData;
        }

        function generateUserDetailContent(userData, userId, showServerSection = true) {
            let serverSectionHtml = '';

            if (showServerSection) {
                const userGroup = managerUserGroups.find(g => g.userId === userId);
                const assignedServers = userGroup ? userGroup.servers : [];

                const account = adminAccounts.find(a => a.id === currentManagerId);
                const managerAssignedServers = account && account.selectedServers ? account.selectedServers : [];
                const liveServers = [...serverData.connected];

                serverSectionHtml = `
                    <div class="user-detail-server-section">
                        <div class="user-detail-server-header">
                            <div style="font-size: 14px; font-weight: bold;">ÂàÜÈÖçÁßÅÊúâÊúçÂä°Âô®</div>
                            <div class="user-detail-server-hint" style="font-size: 11px;">ËÆæÁΩÆÁã¨‰∫´ÊúçÂä°Âô® Ëé∑ÂæóÁßÅÊúâÂè∑Á†Å ÂÆö‰ΩçÊé•Êî∂‰ø°ÊÅØ ÂºÄÈÄöÊî∂‰ª∂ÁÆ±ÂèåÂêëÂäüËÉΩ</div>
                        </div>
                        <div class="user-detail-server-explanation" style="font-size: 10px; margin-bottom: 8px;">ÂèØÁî®ÊúçÂä°Âô®‰∏∫ ÁßÅÊúâÊúçÂä°Âô®+ÂÖ±‰∫´ÊúçÂä°Âô®</div>
                        <div id="userServerSelectionGrid" class="server-buttons-grid">
                            ${managerAssignedServers.map(serverName => {
                                const isSelected = assignedServers.includes(serverName);
                                const s = liveServers.find(x => String(x.name).trim() === String(serverName).trim());
                                const url = s ? (s.url || '') : '';
                                const portMatch = url.match(/:(\d+)/);
                                const port = portMatch ? portMatch[1] : (s && (s.port || (String(s.name).match(/\d+/)?.[0])) ) || '?';
                                const safeUserId = String(userId).replace(/'/g, "\\'");
                                const safeServerName = String(serverName).replace(/'/g, "\\'");
                                return `<button class="server-button connected ${isSelected ? 'selected' : ''}"
                                            onclick="toggleUserServerSelection('${safeUserId}', '${safeServerName}', this)">
                                        <div class="server-button-name">${port}</div>
                                        <div class="server-tooltip">
                                            <div style="font-weight: bold; margin-bottom: 4px;">${serverName}</div>
                                            <div style="font-size: 11px; opacity: 0.9;">${url || ''}</div>
                                        </div>
                                    </button>`;
                            }).join('')}
                        </div>
                        <div class="user-detail-footer">
                            <button class="admin-manage-footer-btn reset" onclick="resetUserServerSelection('${userId}')">ÈáçÁΩÆ</button>
                            <button class="admin-manage-footer-btn confirm" onclick="confirmUserServerSelection('${userId}')">Á°ÆÂÆö</button>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="user-detail-header">
                    <div style="font-size: 16px; font-weight: bold;">Áî®Êà∑ID: ${userData.userId}</div>
                    <div style="display: flex; gap: 15px; font-size: 13px;">
                        <div>ÁßØÂàÜ‰ΩôÈ¢ù: <span style="color: #4caf50; font-weight: bold;">${userData.credits.toFixed(2)}</span></div>
                        <div>‰∏äÊ¨°ËÆøÈóÆ: <span style="color: #666;">${userData.lastAccess}</span></div>
                    </div>
                </div>

                <div>
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">Áî®Êà∑‰ΩøÁî®Êï∞ÊçÆÔºàÁªüËÆ°Êï∞ÊçÆÔºâ:</div>
                    <div class="user-detail-stats-grid">
                        <div class="user-detail-stat-card">
                            <div class="user-detail-stat-label">‰∏äÊ¨°ÂèëÈÄÅ‰ªªÂä°Ê¨°Êï∞</div>
                            <div class="user-detail-stat-value">${userData.lastTaskCount}</div>
                        </div>
                        <div class="user-detail-stat-card">
                            <div class="user-detail-stat-label">‰∏äÊ¨°ÊàêÂäüÁéá</div>
                            <div class="user-detail-stat-value">${userData.lastSuccessRate.toFixed(2)}%</div>
                        </div>
                        <div class="user-detail-stat-card">
                            <div class="user-detail-stat-label">‰∏äÊ¨°ÂèëÈÄÅÈáè</div>
                            <div class="user-detail-stat-value">${userData.lastSentCount}</div>
                        </div>
                        <div class="user-detail-stat-card">
                            <div class="user-detail-stat-label">‰∏äÊ¨°Ê∂àËÄóÁßØÂàÜ</div>
                            <div class="user-detail-stat-value">${userData.lastCreditsUsed.toFixed(2)}</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">ÊÄªËÆ°Êï∞ÊçÆ:</div>
                    <div class="user-detail-stats-grid">
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <div style="font-size: 11px; color: #666;">ÊÄªËÆøÈóÆÊ¨°Êï∞</div>
                            <div style="font-size: 16px; font-weight: bold;">${userData.totalAccessCount}</div>
                        </div>
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <div style="font-size: 11px; color: #666;">ÊÄªÂèëÈÄÅÊ¨°Êï∞</div>
                            <div style="font-size: 16px; font-weight: bold;">${userData.totalSentCount}</div>
                        </div>
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <div style="font-size: 11px; color: #666;">ÊÄªÂèëÈÄÅÈáè</div>
                            <div style="font-size: 16px; font-weight: bold;">${userData.totalSentAmount}</div>
                        </div>
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <div style="font-size: 11px; color: #666;">ÊàêÂäüÁéá</div>
                            <div style="font-size: 16px; font-weight: bold;">${userData.totalSuccessRate}%</div>
                        </div>
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; grid-column: 1 / -1;">
                            <div style="font-size: 11px; color: #666;">ÁßØÂàÜÊ∂àËÄóÊÄªÊï∞</div>
                            <div style="font-size: 16px; font-weight: bold; color: #f44336;">${userData.totalCreditsUsed.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
                ${serverSectionHtml}
            `;
        }

        async function showUserDetailModal(userId) {
            const modal = document.getElementById('userDetailModal');
            const content = document.getElementById('userDetailContent');
            if (!modal || !content) return;

            const userData = await fetchUserData(userId);

            content.innerHTML = generateUserDetailContent(userData, userId, true);

            requestAnimationFrame(() => {
                modal.classList.add('show');
            });
        }

        async function loadAccountPanelContent() {
            const panelE = document.getElementById('panelE');
            if (!panelE) return;

            const panelContent = panelE.querySelector('.panel-content');
            if (!panelContent) return;

            const userId = localStorage.getItem('user_id');
            if (!userId) {
                panelContent.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Êú™ÁôªÂΩï</div>';
                return;
            }

            panelContent.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Âä†ËΩΩ‰∏≠...</div>';

            const userData = await fetchUserData(userId);

            panelContent.innerHTML = generateUserDetailContent(userData, userId, false);
        }

        function closeUserDetailModal() {
            const modal = document.getElementById('userDetailModal');
            if (!modal) return;
            modal.classList.remove('show');
        }

        function toggleUserServerSelection(userId, serverName, button) {
            const userGroup = managerUserGroups.find(g => g.userId === userId);
            if (!userGroup) {
                managerUserGroups.push({
                    userId: userId,
                    servers: [serverName]
                });
                button.classList.add('selected');
            } else {
                const index = userGroup.servers.indexOf(serverName);
                if (index > -1) {
                    userGroup.servers.splice(index, 1);
                    button.classList.remove('selected');
                } else {
                    userGroup.servers.push(serverName);
                    button.classList.add('selected');
                }
            }
        }

        function resetUserServerSelection(userId) {
            const userGroup = managerUserGroups.find(g => g.userId === userId);
            if (userGroup) {
                userGroup.servers = [];
            }
            const grid = document.getElementById('userServerSelectionGrid');
            if (grid) {
                const buttons = grid.querySelectorAll('.server-button');
                buttons.forEach(btn => btn.classList.remove('selected'));
            }
        }

        async function confirmUserServerSelection(userId) {
            const userGroup = managerUserGroups.find(g => g.userId === userId);
            const selectedServers = userGroup ? userGroup.servers : [];

            const allServers = [
                ...serverData.connected,
                ...serverData.disconnected
            ];

            for (const serverName of selectedServers) {
                const server = allServers.find(s => s.name === serverName);
                if (server && server.server_id) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/servers/${server.server_id}/assign`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                user_id: userId
                            })
                        });
                        if (!response.ok) {
                            console.error(`ÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•`);
                        }
                    } catch (error) {
                        console.error(`ÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•:`, error);
                    }
                }
            }

            const account = adminAccounts.find(a => a.id === currentManagerId);
            const managerAssignedServers = account && account.selectedServers ? account.selectedServers : [];
            for (const serverName of managerAssignedServers) {
                if (!selectedServers.includes(serverName)) {
                    const server = allServers.find(s => s.name === serverName);
                    if (server && server.server_id) {
                        try {
                            await fetch(`${API_BASE_URL}/servers/${server.server_id}/unassign`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' }
                            });
                        } catch (error) {
                            console.error(`ÂèñÊ∂àÂàÜÈÖçÊúçÂä°Âô® ${serverName} Â§±Ë¥•:`, error);
                        }
                    }
                }
            }

            await loadServersFromAPI();
            closeUserDetailModal();
            updateManagerDisplay();
            await customAlert('ÊúçÂä°Âô®ÂàÜÈÖçÂ∑≤‰øùÂ≠ò');
        }

        let updateManagerDisplayTimer = null;

        function updateManagerDisplay() {
            if (updateManagerDisplayTimer) {
                clearTimeout(updateManagerDisplayTimer);
            }

            updateManagerDisplayTimer = setTimeout(async () => {
                const userList = document.getElementById('userList');
                if (!userList) return;

                userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Âä†ËΩΩ‰∏≠...</div>';

                const managerUserCountDisplay = document.getElementById('managerUserCountDisplay');
                if (managerUserCountDisplay) {
                    managerUserCountDisplay.textContent = managerUsers.length;
                }

                const fragment = document.createDocumentFragment();

                const CONCURRENT_LIMIT = 5;
                const userDataPromises = [];

                for (let i = 0; i < managerUsers.length; i += CONCURRENT_LIMIT) {
                    const batch = managerUsers.slice(i, i + CONCURRENT_LIMIT);

                    const batchPromises = batch.map(async (userId) => {
                        const userGroup = managerUserGroups.find(g => g.userId === userId);
                        const serverCount = userGroup ? userGroup.servers.length : 0;

                        let lastSentCount = 0;
                        let creditsBalance = 0;

                        try {
                            const [creditsResponse, statsResponse] = await Promise.all([
                                fetch(`${API_BASE_URL}/user/${userId}/credits`).catch(() => null),
                                fetch(`${API_BASE_URL}/user/${userId}/statistics`).catch(() => null)
                            ]);

                            if (creditsResponse && creditsResponse.ok) {
                                const creditsData = await creditsResponse.json();
                                creditsBalance = creditsData.credits || 0;
                            }

                            if (statsResponse && statsResponse.ok) {
                                const statsData = await statsResponse.json();
                                if (statsData.usage_logs && statsData.usage_logs.length > 0) {
                                    const lastLog = statsData.usage_logs[statsData.usage_logs.length - 1];
                                    lastSentCount = lastLog.sent_count || 0;
                                }
                            }
                        } catch (error) {
                            console.warn(`Ëé∑ÂèñÁî®Êà∑ ${userId} Êï∞ÊçÆÂ§±Ë¥•:`, error);
                        }

                        const userButton = document.createElement('div');
                        userButton.className = 'user-button';
                        const escapedUserId = String(userId).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                        userButton.innerHTML = `
                            <div class="user-button-content">
                                <div class="user-server-count-badge">${serverCount}</div>
                                <div class="user-button-info">
                                    <div class="user-button-top">
                                        <span class="user-id-text">${escapedUserId}</span>
                                        <button class="user-manage-btn" onclick="showUserDetailModal('${escapedUserId}')">ÁÆ°ÁêÜ</button>
                                    </div>
                                    <div class="user-button-stats">
                                        <div class="user-stat-item">
                                            <span class="user-stat-label">last:</span>
                                            <span class="user-stat-value">${lastSentCount}</span>
                                        </div>
                                        <div class="user-stat-item">
                                            <span class="user-stat-label">balance:</span>
                                            <span class="user-stat-value">$${creditsBalance.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        return userButton;
                    });

                    const batchResults = await Promise.all(batchPromises);
                    batchResults.forEach(button => fragment.appendChild(button));

                    if (fragment.children.length > 0) {
                        userList.innerHTML = '';
                        userList.appendChild(fragment.cloneNode(true));
                    }
                }

                userList.innerHTML = '';
                userList.appendChild(fragment);

            const allServers = [
                ...serverData.connected,
                ...serverData.disconnected
            ];

            const availableContainer = document.getElementById('managerAvailableServers');
            if (!availableContainer) {
                return;
            }
            availableContainer.innerHTML = '';

            const account = adminAccounts.find(a => a.id === currentManagerId);
            let managerAssignedServers = [];

            if (account && account.selectedServers) {
                managerAssignedServers = account.selectedServers;
            } else {
                fetch(`${API_BASE_URL}/admin/account/${currentManagerId}`)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        return null;
                    })
                    .then(data => {
                        if (data && data.success && data.selected_servers) {
                            managerAssignedServers = data.selected_servers;
                            if (account) {
                                account.selectedServers = managerAssignedServers;
                                localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                            }
                            updateManagerDisplay();
                        }
                    })
                    .catch(error => {
                        console.warn('‰ªéAPIÂä†ËΩΩÁÆ°ÁêÜÂëòÊúçÂä°Âô®ÈÖçÁΩÆÂ§±Ë¥•:', error);
                    });
            }

            const assignedServers = new Set();
            managerUserGroups.forEach(group => {
                group.servers.forEach(s => assignedServers.add(s));
            });

            const managerServers = allServers.filter(server => {
                return managerAssignedServers.includes(server.name);
            });

            const selectedInCreation = currentGroupCreation ? new Set(currentGroupCreation.selectedServers) : new Set();
            const assignedToUsers = managerServers.filter(server =>
                assignedServers.has(server.name) || selectedInCreation.has(server.name)
            );
            const availableForAssignment = managerServers.filter(server =>
                !assignedServers.has(server.name) && !selectedInCreation.has(server.name)
            );

            if (assignedToUsers.length > 0) {
                const assignedSection = document.createElement('div');
                assignedSection.style.marginBottom = '20px';
                assignedSection.style.padding = '15px';
                assignedSection.style.background = 'rgba(255, 193, 7, 0.1)';
                assignedSection.style.borderRadius = '12px';
                assignedSection.style.border = '2px solid rgba(255, 193, 7, 0.3)';

                const assignedTitle = document.createElement('div');
                assignedTitle.style.fontSize = '14px';
                assignedTitle.style.fontWeight = 'bold';
                assignedTitle.style.color = 'var(--text-dark)';
                assignedTitle.style.marginBottom = '10px';
                assignedTitle.textContent = `Â∑≤ÂàÜÈÖçÁªôÁî®Êà∑ (${assignedToUsers.length})`;
                assignedSection.appendChild(assignedTitle);

                const assignedGrid = document.createElement('div');
                assignedGrid.className = 'server-buttons-grid';
                assignedGrid.style.gap = '18px';

                assignedToUsers.forEach(server => {
                    const btn = document.createElement('button');
                    btn.className = 'server-button connected';
                    const serverName = server.name || server.server_name || server.server_id || String(server);

                    if (currentGroupCreation && currentGroupCreation.selectedServers.includes(serverName)) {
                        btn.classList.add('selected', 'active');
                        btn.onclick = () => {
                            btn.classList.toggle('active');
                            toggleServerForGroup(serverName);
                        };
                    } else {
                        btn.onclick = () => btn.classList.toggle('active');
                    }

                    const portMatch = (server.url || '').match(/:(\d+)/);
                    const port = portMatch ? portMatch[1] : (server.port || serverName.match(/\d+/)?.[0] || '?');
                    btn.innerHTML = `
                        <div class="server-button-name">${port}</div>
                        <div class="server-tooltip">
                            <div style="font-weight: bold; margin-bottom: 4px;">${serverName}</div>
                            <div style="font-size: 11px; opacity: 0.9;">${server.url || ''}</div>
                        </div>
                    `;
                    assignedGrid.appendChild(btn);
                });

                assignedSection.appendChild(assignedGrid);
                availableContainer.appendChild(assignedSection);
            }

            if (availableForAssignment.length > 0) {
                const availableSection = document.createElement('div');
                availableSection.style.marginBottom = '20px';
                availableSection.style.padding = '15px';
                availableSection.style.background = 'rgba(76, 175, 80, 0.1)';
                availableSection.style.borderRadius = '12px';
                availableSection.style.border = '2px solid rgba(76, 175, 80, 0.3)';

                const availableTitle = document.createElement('div');
                availableTitle.style.fontSize = '14px';
                availableTitle.style.fontWeight = 'bold';
                availableTitle.style.color = 'var(--text-dark)';
                availableTitle.style.marginBottom = '10px';
                availableTitle.textContent = `ÂèØÂàÜÈÖçÁªôÁî®Êà∑ (${availableForAssignment.length})`;
                availableSection.appendChild(availableTitle);

                const availableGrid = document.createElement('div');
                availableGrid.className = 'server-buttons-grid';
                availableGrid.style.gap = '18px';

                availableForAssignment.forEach(server => {
                    const btn = document.createElement('button');
                    btn.className = 'server-button';
                    const serverName = server.name || server.server_name || server.server_id || String(server);

                    if (currentGroupCreation) {
                        const isSelected = currentGroupCreation.selectedServers.includes(serverName);
                        if (isSelected) {
                            btn.classList.add('selected', 'active');
                        }
                        btn.onclick = () => {
                            btn.classList.toggle('active');
                            toggleServerForGroup(serverName);
                        };
                    } else {
                        btn.onclick = () => btn.classList.toggle('active');
                    }

                    const portMatch = (server.url || '').match(/:(\d+)/);
                    const port = portMatch ? portMatch[1] : (server.port || serverName.match(/\d+/)?.[0] || '?');
                    btn.innerHTML = `
                        <div class="server-button-name">${port}</div>
                        <div class="server-tooltip">
                            <div style="font-weight: bold; margin-bottom: 4px;">${serverName}</div>
                            <div style="font-size: 11px; opacity: 0.9;">${server.url || ''}</div>
                        </div>
                    `;
                    availableGrid.appendChild(btn);
                });

                availableSection.appendChild(availableGrid);
                availableContainer.appendChild(availableSection);
            } else if (managerAssignedServers.length === 0) {
                const noServerMsg = document.createElement('div');
                noServerMsg.style.padding = '15px';
                noServerMsg.style.textAlign = 'center';
                noServerMsg.style.color = '#666';
                noServerMsg.style.fontSize = '14px';
                noServerMsg.textContent = 'ÊöÇÊó†ÂàÜÈÖçÁªôÊÇ®ÁöÑÊúçÂä°Âô®ÔºåËØ∑ËÅîÁ≥ªÊúçÂä°Âô®ÁÆ°ÁêÜÂëòÂàÜÈÖç';
                availableContainer.appendChild(noServerMsg);
            }

            const groupsContainer = document.getElementById('userGroupsContainer');
            if (!groupsContainer) return;
            groupsContainer.innerHTML = '';

            if (currentGroupCreation) {
                const createArea = document.createElement('div');
                createArea.className = 'group-creation-area';

                const selectedServerNames = currentGroupCreation.selectedServers;
                const unselectedServers = allServers.filter(s =>
                    !selectedServerNames.includes(s.name) &&
                    (!assignedServers.has(s.name) || selectedServerNames.includes(s.name))
                );

                createArea.innerHTML = `
                    <div class="group-creation-row">
                        <button class="group-select-btn ${currentGroupCreation.userId ? 'selected' : ''}"
                                onclick="selectUserForGroup('${currentGroupCreation.userId || ''}')">
                            ${currentGroupCreation.userId || 'Please select user'}
                        </button>
                        ${!currentGroupCreation.userId ? managerUsers.map(userId => `
                            <button class="group-select-btn"
                                    onclick="selectUserForGroup('${userId}')">
                                ${userId}
                            </button>
                        `).join('') : ''}
                    </div>
                    <div class="group-creation-row">
                        <button class="group-select-btn ${currentGroupCreation.selectedServers.length > 0 ? 'selected' : ''}"
                                onclick="showServerSelection()">
                            ${currentGroupCreation.selectedServers.length > 0
                        ? currentGroupCreation.selectedServers[0]
                        : 'Please select backend server'}
                        </button>
                        ${currentGroupCreation.userId && currentGroupCreation.showingServers ? allServers.filter(s => !assignedServers.has(s.name) || selectedServerNames.includes(s.name)).map(server => {
                            const isSelected = selectedServerNames.includes(server.name);
                            return `<button class="group-select-btn ${isSelected ? 'selected' : ''}"
                                    onclick="toggleServerForGroup('${server.name}')">
                                    ${server.name}
                                </button>`;
                        }).join('') : ''}
                    </div>
                    ${currentGroupCreation.userId && selectedServerNames.length > 0 ? `
                    <div class="group-servers-display">
                        ${selectedServerNames.map(serverName => {
                            const server = allServers.find(s => s.name === serverName);
                            return server ? `
                                <div class="server-tag private">
                                    <div>${server.name}</div>
                                    <div class="server-tag-label">Áã¨‰∫´ÁßÅÊúâÊúçÂä°Âô®</div>
                                </div>
                            ` : '';
                        }).join('')}
                        ${unselectedServers.length > 0 ? '<div style="width: 100%; height: 10px;"></div>' : ''}
                        ${unselectedServers.map(server => `
                            <div class="server-tag public">
                                <div>${server.name}</div>
                                <div class="server-tag-label">ÂÖ¨ÂÖ±ÂÖ±‰∫´ÊúçÂä°Âô®</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="group-creation-row">
                        <button class="admin-manage-footer-btn reset" onclick="resetGroupCreation()">ÈáçÁΩÆ</button>
                        <button class="admin-manage-footer-btn manage" onclick="confirmGroupCreation()">ÁÆ°ÁêÜ</button>
                    </div>
                    ` : currentGroupCreation.userId && selectedServerNames.length === 0 ? `
                    <div class="group-creation-row">
                        <button class="admin-manage-footer-btn reset" onclick="resetGroupCreation()">ÈáçÁΩÆ</button>
                        <button class="admin-manage-footer-btn confirm" onclick="confirmGroupCreation()">Á°ÆÂÆö</button>
                    </div>
                    ` : ''}
                `;
                groupsContainer.appendChild(createArea);
            }

            managerUserGroups.forEach(group => {
                const section = document.createElement('div');
                section.className = 'user-group-section';

                const isEditing = currentGroupCreation && currentGroupCreation.userId === group.userId;

                const privateServers = group.servers;
                const publicServers = allServers.filter(s => !privateServers.includes(s.name) && !assignedServers.has(s.name));

                section.innerHTML = `
                    <div class="user-group-header">
                        <div class="user-group-name">Áî®Êà∑: ${group.userId}</div>
                        <div class="user-group-actions">
                            ${isEditing ? '' : `<button class="admin-account-action-btn manage" onclick="manageUserGroup('${group.userId}')">ÁÆ°ÁêÜ</button>`}
                            <button class="admin-account-action-btn delete" onclick="deleteUserGroup('${group.userId}')">ÈáçÁΩÆ</button>
                        </div>
                    </div>
                    <div class="user-group-servers">
                        ${privateServers.map(server => `
                            <div class="server-tag private">
                                <div>${server}</div>
                                <div class="server-tag-label">Áã¨‰∫´ÁßÅÊúâÊúçÂä°Âô®</div>
                            </div>
                        `).join('')}
                        ${publicServers.length > 0 ? '<div style="width: 100%; height: 10px;"></div>' : ''}
                        ${publicServers.map(server => `
                            <div class="server-tag public">
                                <div>${server.name}</div>
                                <div class="server-tag-label">ÂÖ¨ÂÖ±ÂÖ±‰∫´ÊúçÂä°Âô®</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                groupsContainer.appendChild(section);
            });
            }, 50);
        }

        const originalHandleAdminLogin = handleAdminLogin;
        handleAdminLogin = async function () {
            // Áªü‰∏ÄËµ∞‰∏äÈù¢‰øÆÂ§çÂêéÁöÑÂéüÂßãÂÆûÁé∞Ôºà‰ºöÊ≠£Á°ÆËØ∑Ê±Ç /admin/login ‰∏îÊèê‰∫§ admin_id Â≠óÊÆµÔºâ
            return await originalHandleAdminLogin();
            /*
            const username = document.getElementById('adminLoginUsername').value.trim();
            const password = document.getElementById('adminLoginPassword').value.trim();

            if (!username || !password) {
                showMessage('ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÁî®Êà∑ÂêçÂíåÂØÜÁ†Å', 'error');
                return;
            }

            const account = adminAccounts.find(a => a.id === username && a.password === password);
            if (account) {
                showMessage('ÁÆ°ÁêÜÂëòÁôªÂΩïÊàêÂäüÔºÅÊ≠£Âú®Ë∑≥ËΩ¨...', 'success');
                setTimeout(() => {
                    loginAsManager(username);
                }, 1000);
            } else {
                async function doAdminLogin() {
                    try {
                        if (typeof showMessage === 'function') {
                            showMessage('Ê≠£Âú®È™åËØÅÁÆ°ÁêÜÂëòË∫´‰ªΩ...', 'info');
                        }

                        const response = await fetch(`${API_BASE_URL}/admin/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                username: username,
                                password: password
                            })
                        });

                        const data = await response.json();

                        if (response.ok && data.success) {
                            localStorage.setItem('admin_id', data.admin_id || username);
                            localStorage.setItem('admin_token', data.token);
                            localStorage.setItem('admin_username', username);

                            showMessage('ÁÆ°ÁêÜÂëòÁôªÂΩïÊàêÂäüÔºÅÊ≠£Âú®Ë∑≥ËΩ¨...', 'success');
                            setTimeout(() => {
                                if (data.has_manager_access) {
                                    loginAsManager(username);
                                } else {
                                    if (typeof showMessage === 'function') {
                                        showMessage('ÊÇ®Ê≤°ÊúâÁÆ°ÁêÜÂëòÈù¢ÊùøËÆøÈóÆÊùÉÈôê', 'error');
                                    }
                                }
                            }, 1000);
                        } else {
                            const errorMsg = data.message || 'ÁÆ°ÁêÜÂëòÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å';
                            if (typeof showMessage === 'function') {
                                showMessage(errorMsg, 'error');
                            } else {
                                await customAlert(errorMsg);
                            }
                        }
                    } catch (error) {
                        console.error('ÁÆ°ÁêÜÂëòÁôªÂΩïÈîôËØØ:', error);
                        const errorMsg = 'ÁÆ°ÁêÜÂëòÁôªÂΩïÂ§±Ë¥•ÔºöÊó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñËÅîÁ≥ªÁÆ°ÁêÜÂëò';
                        if (typeof showMessage === 'function') {
                            showMessage(errorMsg, 'error');
                        } else {
                            await customAlert(errorMsg);
                        }
                        return;
                    }
                }

                await doAdminLogin();
            }
            */
        };

        window.handleAdminLogin = handleAdminLogin;

        let isSending = false;
        let currentChatId = null;
        let unreadChatIds = new Set();
        let newMessageNotification = null;
        let clearedChatIds = new Set();
        let globalStats = {
            taskCount: 0,
            totalSent: 0,
            totalSuccess: 0,
            totalFail: 0,
            totalTime: 0,
            totalPhoneCount: 0,
            inboxReceived: 0,
            inboxSent: 0,
            inboxTotal: 0
        };
        let sentPhoneNumbers = new Set();
        const MAX_LOG_ITEMS = 200;
        let logScrollPending = false;
        let conversationScrollPending = false;

        const _taskWsWaiters = new Map();

        function _ensureTaskWaiter(taskId, timeoutMs = 30 * 60 * 1000) {
            if (_taskWsWaiters.has(taskId)) return _taskWsWaiters.get(taskId);
            let resolveFn, rejectFn;
            const p = new Promise((resolve, reject) => {
                resolveFn = resolve;
                rejectFn = reject;
            });
            const timeoutId = setTimeout(() => {
                _taskWsWaiters.delete(taskId);
                try { rejectFn(new Error('Á≠âÂæÖ‰ªªÂä°Ë∂ÖÊó∂ÔºàWSÔºâ')); } catch { /* ignore */ }
            }, timeoutMs);
            const waiter = { promise: p, resolve: resolveFn, reject: rejectFn, timeoutId };
            _taskWsWaiters.set(taskId, waiter);
            return waiter;
        }

        function connectToBackendWS(_serverIgnored) {
            // Èõ∂ËΩÆËØ¢Êû∂ÊûÑÔºö‰ΩøÁî®ÂéüÁîüWebSocketÂÆûÊó∂Êé®ÈÄÅÔºåÊó†‰ªª‰ΩïHTTPËΩÆËØ¢
            if (activeWs && (activeWs.readyState === WebSocket.OPEN || activeWs.readyState === WebSocket.CONNECTING)) {
                console.log('[WebSocket] Â∑≤ËøûÊé•ÊàñÊ≠£Âú®ËøûÊé•ÔºåË∑≥ËøáÂàùÂßãÂåñ');
                return;
            }

            if (!authToken || !currentUserId) {
                console.warn('[WebSocket] Êú™ÁôªÂΩïÔºåÊó†Ê≥ïËøûÊé•');
                return;
            }

            // ÊûÑÂª∫WebSocket URLÔºà/ws/frontendÁ´ØÁÇπÔºâ
            const wsUrl = API_BASE_URL
                .replace('http://', 'ws://')
                .replace('https://', 'wss://')
                .replace('/api', '') + '/ws/frontend';

            try {
                // ‰ΩøÁî®ÂéüÁîüWebSocketÂÆ¢Êà∑Á´Ø
                activeWs = new WebSocket(wsUrl);
                
                // ÂøÉË∑≥ÂÆöÊó∂Âô®
                let heartbeatTimer = null;

                activeWs.onopen = () => {
                    console.log('‚úì WebSocketÂ∑≤ËøûÊé•');
                    
                    // ‰ΩøÁî® setTimeout Á°Æ‰øù WebSocket Áä∂ÊÄÅÂÆåÂÖ®ÂêåÊ≠•
                    setTimeout(() => {
                        // ËÆ¢ÈòÖÁî®Êà∑Êõ¥Êñ∞
                        sendWSCommand('subscribe_user', { user_id: currentUserId });
                        showMessage('Â∑≤ËøûÊé•Âà∞ÂÆûÊó∂Êé®ÈÄÅÊúçÂä°', 'success');
                    }, 100);
                    
                    // ÂêØÂä®ÂøÉË∑≥ - ÊØè30ÁßíÂèëÈÄÅ‰∏ÄÊ¨°ping
                    if (heartbeatTimer) {
                        clearInterval(heartbeatTimer);
                    }
                    heartbeatTimer = setInterval(() => {
                        if (activeWs && activeWs.readyState === WebSocket.OPEN) {
                            sendWSCommand('ping', {});
                        }
                    }, 30000); // 30ÁßíÂøÉË∑≥
                };

                activeWs.onmessage = (event) => {
                    try {
                        const msg = JSON.parse(event.data);
                        const msgType = msg.type;
                        
                        console.log('[WebSocket] Êî∂Âà∞Ê∂àÊÅØ:', msgType, msg);

                        // Â§ÑÁêÜ‰∏çÂêåÁ±ªÂûãÁöÑÊ∂àÊÅØ
                        if (msgType === 'task_update') {
                            handleServerMessage(msg, null);
                        } else if (msgType === 'balance_update') {
                            handleServerMessage(msg, null);
                        } else if (msgType === 'inbox_update') {
                            handleServerMessage(msg, null);
                        } else if (msgType === 'subscribed') {
                            console.log('‚úì ‰ªªÂä°ËÆ¢ÈòÖÊàêÂäü:', msg.data || msg);
                        } else if (msgType === 'user_subscribed') {
                            console.log('‚úì Áî®Êà∑ËÆ¢ÈòÖÊàêÂäü');
                        } else if (msgType === 'unsubscribed') {
                            // console.log('[WebSocket] ÂèñÊ∂àËÆ¢ÈòÖ:', msg);
                        } else if (msgType === 'pong') {
                            // ÂøÉË∑≥ÂìçÂ∫î - ‰øùÊåÅËøûÊé•Ê¥ªË∑É
                            console.log('‚úì ÂøÉË∑≥Ê≠£Â∏∏');
                        } else if (msgType === 'error') {
                            console.error('[WebSocket] ÈîôËØØ:', msg.message);
                        }
                    } catch (e) {
                        console.error('[WebSocket] Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', e);
                    }
                };

                activeWs.onerror = (error) => {
                    // console.error('[WebSocket] ËøûÊé•ÈîôËØØ:', error);
                    // showMessage('ËøûÊé•Â§±Ë¥•ÔºåÊ≠£Âú®ÈáçËØï...', 'warning');
                };

                activeWs.onclose = (event) => {
                    // console.log('[WebSocket] Êñ≠ÂºÄËøûÊé•:', event.code, event.reason);
                    
                    // Ê∏ÖÁêÜÂøÉË∑≥ÂÆöÊó∂Âô®
                    if (heartbeatTimer) {
                        clearInterval(heartbeatTimer);
                        heartbeatTimer = null;
                    }
                    
                    activeWs = null;
                    
                    // 5ÁßíÂêéËá™Âä®ÈáçËøû
                    setTimeout(() => {
                        if (!activeWs && authToken && currentUserId) {
                            // console.log('[WebSocket] Â∞ùËØïÈáçËøû...');
                            connectToBackendWS(_serverIgnored);
                        }
                    }, 5000);
                };

            } catch (e) {
                console.error('[WebSocket] ÂàùÂßãÂåñÂ§±Ë¥•:', e);
                activeWs = null;
                showMessage('WebSocket ÂàùÂßãÂåñÂ§±Ë¥•', 'error');
            }
        }

        function sendWSCommand(action, data = {}) {
            if (!activeWs || activeWs.readyState !== WebSocket.OPEN) {
                // console.warn('[WebSocket] Êú™ËøûÊé•ÔºåÊó†Ê≥ïÂèëÈÄÅÂëΩ‰ª§:', action);
                return false;
            }
            const payload = JSON.stringify({ action, data });
            console.log('[WebSocket] ÂèëÈÄÅÂëΩ‰ª§:', action, data);
            activeWs.send(payload);
            return true;
        }

        function updateUserInfoDisplay(credits) {
            const userInfoDisplay = document.getElementById('userInfoDisplay');
            const currentUsernameEl = document.getElementById('currentUsername');
            const currentCreditsEl = document.getElementById('currentCredits');

            if (userInfoDisplay && currentUsernameEl && currentCreditsEl) {
                const userInfo = JSON.parse(localStorage.getItem('user_info_' + currentUserId) || '{}');
                currentUsernameEl.textContent = userInfo.username || currentUserId;
                currentCreditsEl.textContent = credits !== undefined ? credits : '-';
                userInfoDisplay.style.display = 'inline-block';
            }
        }

        async function loadUserBackends() {
            if (!currentUserId || !authToken) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/user/${currentUserId}/backends`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const backends = data.backends || data.backend_servers || [];
                    localStorage.setItem('user_backends', JSON.stringify(backends));
                    return backends;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂêéÁ´ØÊúçÂä°Âô®ÂàóË°®Â§±Ë¥•:', error);
            }
            return [];
        }

        function checkAuth() {
            currentUserId = localStorage.getItem('user_id');
            authToken = localStorage.getItem('auth_token');
            if (!currentUserId || !authToken) {
                return false;
            }
            return true;
        }

        function getStringLength(str) {
            let length = 0;
            for (let i = 0; i < str.length; i++) {
                const charCode = str.charCodeAt(i);
                if (charCode >= 0x4E00 && charCode <= 0x9FFF) {
                    length += 2;
                } else {
                    length += 1;
                }
            }
            return length;
        }

        function updateCounts() {
            const numbersText = document.getElementById('numbersText').value;
            const numbers = numbersText.split(/[\n,]/).filter(n => n.trim()).length;
            const numbersCountEl = document.getElementById('numbersCount');

            if (numbers === 0) {
                numbersCountEl.textContent = `Âè∑Á†Å: ${numbers}`;
                numbersCountEl.classList.remove('has-numbers');
            } else {
                numbersCountEl.textContent = `Âè∑Á†Å: ${numbers}`;
                numbersCountEl.classList.add('has-numbers');
            }

            const messageText = document.getElementById('messageText').value;
            const charCount = getStringLength(messageText);
            const messageCountEl = document.getElementById('messageCount');

            if (charCount === 0) {
                messageCountEl.textContent = `Â≠óÊï∞: ${charCount}`;
                messageCountEl.classList.remove('has-content', 'over-limit');
            } else if (charCount <= 160) {
                messageCountEl.textContent = `Â≠óÊï∞: ${charCount}`;
                messageCountEl.classList.remove('over-limit');
                messageCountEl.classList.add('has-content');
            } else {
                const messageCount = Math.ceil(charCount / 160);
                messageCountEl.innerHTML = `Â≠óÊï∞: ${charCount}/160 <span class="message-count-badge">${messageCount}Êù°</span>`;
                messageCountEl.classList.remove('has-content');
                messageCountEl.classList.add('over-limit');
            }
        }

        function importNumbers() {
            document.getElementById('numbersFile').click();
        }

        function importMessage() {
            document.getElementById('messageFile').click();
        }

        function clearNumbers() {
            const btn = document.getElementById('clearNumbersBtn');
            document.getElementById('numbersText').value = '';
            updateCounts();
            if (btn) {
                btn.blur();
                btn.style.background = '';
                btn.style.borderColor = '';
                btn.style.transform = '';
                btn.style.boxShadow = '';
                setTimeout(() => {
                    btn.blur();
                    btn.style.background = '';
                    btn.style.borderColor = '';
                }, 100);
            }
        }

        function clearMessage() {
            const btn = document.getElementById('clearMessageBtn');
            document.getElementById('messageText').value = '';
            updateCounts();
            if (btn) {
                btn.blur();
                btn.style.background = '';
                btn.style.borderColor = '';
                btn.style.transform = '';
                btn.style.boxShadow = '';
                setTimeout(() => {
                    btn.blur();
                    btn.style.background = '';
                    btn.style.borderColor = '';
                }, 100);
            }
        }

        document.getElementById('numbersFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const content = e.target.result;
                    const numbers = content.split(/[\n,]/)
                        .map(n => n.trim())
                        .filter(n => n.length > 0);
                    document.getElementById('numbersText').value = numbers.join('\n');
                    updateCounts();
                };
                reader.readAsText(file);
            }
            this.value = '';
        });

        document.getElementById('messageFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('messageText').value = e.target.result;
                    updateCounts();
                };
                reader.readAsText(file);
            }
            this.value = '';
        });

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;

            if (connected) {
                statusEl.innerHTML = '<span style="color: white; font-weight: bold;">‚óè</span> Â∑≤ËøûÊé•';
                statusEl.className = 'connection-status status-connected';
            } else {
                statusEl.innerHTML = '<span style="color: white; font-weight: bold;">‚óè</span> Êú™ËøûÊé•';
                statusEl.className = 'connection-status status-disconnected';
            }
        }

        let isConnectingServers = false;
        let _noUsableServerWarned = false;
        async function connectToAvailableServers() {
            if (!checkAuth()) return;

            if (isConnectingServers) return;
            isConnectingServers = true;

            try {
                const hasConnectedServers = serverData.connected && serverData.connected.length > 0;

                if (!hasConnectedServers) {
                    if (!_serversLoadedOnce) return;
                    updateConnectionStatus(false);
                    if (!_noUsableServerWarned) {
                        _noUsableServerWarned = true;
                        console.warn('Ê≤°ÊúâÂèØÁî®ÁöÑÊúçÂä°Âô®');
                    }
                    return;
                }

                updateConnectionStatus(true);
                _noUsableServerWarned = false;
                console.log('ÂèØÁî®ÊúçÂä°Âô®Êï∞Èáè:', (serverData.connected?.length || 0));
            } finally {
                isConnectingServers = false;
            }
        }

        //#endregion
        //#region APIÊ∂àÊÅØÂ§ÑÁêÜÊ®°Âùó
        function handleServerMessage(data, serverId = null) {
            if (!data || typeof data !== 'object') return;

            if (data.type === 'auth' && data.ok) {
                try { sendWSCommand('subscribe_servers', {}); } catch { /* ignore */ }
                return;
            }

            if (data.type === 'balance_update') {
                const newBalance = data.balance !== undefined ? data.balance : data.credits;
                if (newBalance !== undefined) {
                    localStorage.setItem('user_balance', newBalance);
                    if (typeof updateUserInfoDisplay === 'function') {
                        updateUserInfoDisplay(newBalance);
                    }
                }
                return;
            }

            if (data.type === 'usage_update' || data.type === 'usage_records_update') {
                if (data.records || data.usage_records) {
                    localStorage.setItem('user_usage_records', JSON.stringify(data.records || data.usage_records));
                    if (typeof updateUsageRecordsDisplay === 'function') {
                        updateUsageRecordsDisplay(data.records || data.usage_records);
                    }
                }
                return;
            }

            if (data.type === 'access_update' || data.type === 'access_records_update') {
                if (data.records || data.access_records) {
                    localStorage.setItem('user_access_records', JSON.stringify(data.records || data.access_records));
                    if (typeof updateAccessRecordsDisplay === 'function') {
                        updateAccessRecordsDisplay(data.records || data.access_records);
                    }
                }
                return;
            }

            if (data.type === 'servers_event') {
                try { loadServersFromAPI(); } catch { /* ignore */ }
                try { loadExclusivePhoneNumbers(); } catch { /* ignore */ }
                return;
            }

            if (data.type === 'balance_update' && data.balance !== undefined) {
                localStorage.setItem('user_balance', data.balance);
                try { updateUserInfoDisplay(data.balance); } catch { /* ignore */ }
                return;
            }

            if (data.type === 'usage_update' && data.usage_records) {
                localStorage.setItem('user_usage_records', JSON.stringify(data.usage_records));
                return;
            }

            if (data.type === 'access_update' && data.access_records) {
                localStorage.setItem('user_access_records', JSON.stringify(data.access_records));
                return;
            }

            if (data.type === 'task_update' && data.data) {
                const payload = data.data;
                const taskId = payload.task_id || data.task_id;
                const sc = payload.shards || {};
                const rp = payload.result || {};

                if (payload.status === 'pending' || payload.status === 'running') {
                    addStatusMessage(`‰ªªÂä° ${taskId} ËøõË°å‰∏≠... shard ${sc.done || 0}/${sc.total || 0} ÊàêÂäü ${rp.success || 0} Â§±Ë¥• ${rp.fail || 0}`, 'info');
                }

                if (payload.status === 'done') {
                    addStatusMessage(`‰ªªÂä° ${taskId} ÂÆåÊàêÔºöÊàêÂäü ${rp.success || 0} Â§±Ë¥• ${rp.fail || 0} ÂèëÈÄÅ ${rp.sent || 0}`, 'success');
                    const total = Number(rp.sent || (Number(rp.success || 0) + Number(rp.fail || 0)));
                    updateGlobalStats(total, Number(rp.success || 0), Number(rp.fail || 0));

                    isSending = false;
                    updateButtonState();

                    // resolve waiter
                    if (taskId && _taskWsWaiters.has(taskId)) {
                        const w = _taskWsWaiters.get(taskId);
                        _taskWsWaiters.delete(taskId);
                        try { clearTimeout(w.timeoutId); } catch { /* ignore */ }
                        try { w.resolve(payload); } catch { /* ignore */ }
                    }
                }
                return;
            }

            if (data.type === 'status_update') {
                if (data.message === "TASK_COMPLETED") {
                    isSending = false;
                    updateButtonState();
                    return;
                }
                addStatusMessage(data.message, data.message_type || 'info');

                if (data.message && typeof data.message === 'string') {
                    const timeMatch = data.message.match(/ÂèëÈÄÅÂÆåÊàê\s+Áî®Êó∂:\s*(\d+)Áßí/i);
                    if (timeMatch) {
                        const timeUsed = parseInt(timeMatch[1]) || 0;
                        if (timeUsed > 0) {
                            globalStats.totalTime += timeUsed;
                            updateTimeDisplay();
                        }
                    }

                    const statsMatch = data.message.match(/Total:\s*(\d+)\s+numbers:\s*(\d+)\s+Success:\s*(\d+)\s+Failed:\s*(\d+)/i);
                    if (statsMatch) {
                        const totalMessages = parseInt(statsMatch[1]) || 0;
                        const phoneCount = parseInt(statsMatch[2]) || 0;
                        const success = parseInt(statsMatch[3]) || 0;
                        const fail = parseInt(statsMatch[4]) || 0;
                        const messageCount = phoneCount > 0 ? Math.floor(totalMessages / phoneCount) : 1;
                        const successMessages = success * messageCount;
                        const failMessages = fail * messageCount;
                        if (phoneCount > 0 || success > 0 || fail > 0) {
                            updateGlobalStats(totalMessages, successMessages, failMessages);
                        }
                    } else {
                        const successMatch = data.message.match(/Success[Ôºö:]\s*(\d+)/i);
                        const failMatch = data.message.match(/Failed[Ôºö:]\s*(\d+)/i);
                        const totalMatch = data.message.match(/Total[Ôºö:]\s*(\d+)/i);

                        if (successMatch || failMatch || totalMatch) {
                            const success = successMatch ? parseInt(successMatch[1]) : 0;
                            const fail = failMatch ? parseInt(failMatch[1]) : 0;
                            const total = totalMatch ? parseInt(totalMatch[1]) : (success + fail);
                            if (total > 0 || success > 0 || fail > 0) {
                                updateGlobalStats(total, success, fail);
                            }
                        }
                    }
                }
            } else if (data.type === 'connected') {
            } else if (data.type === 'initial_chats') {
                updateContactList(data.data);
            } else if (data.type === 'new_messages') {
                if (data.data.count > 0) {
                    showNotification(`Êî∂Âà∞ ${data.data.count} Êù°Êñ∞Ê∂àÊÅØÔºÅ`, 'info');
                }
                updateContactList(data.data.chat_list, data.data.updated_chats);
                if (data.data && data.data.updated_chats && data.data.updated_chats.length > 0) {
                    const updatedChatId = data.data.updated_chats[0];
                    const chat = data.data.chat_list.find(c => c.chat_id === updatedChatId);
                    if (chat && (!currentChatId || currentChatId !== updatedChatId) && data.data.count > 0) {
                        showNewMessageNotification(updatedChatId, chat.name, chat.last_message_preview);
                    }
                }
                if (currentChatId && data.data.updated_chats && data.data.updated_chats.includes(currentChatId)) {
                    const conversationDisplay = document.getElementById('conversationDisplay');
                    const tempMessage = conversationDisplay.querySelector('[data-temp-message="true"]');
                    if (!tempMessage) {
                        requestConversation(currentChatId);
                    }
                }
            } else if (data.type === 'conversation_data') {
                const conversationDisplay = document.getElementById('conversationDisplay');
                const tempMessage = conversationDisplay.querySelector('[data-temp-message="true"]');
                if (tempMessage && data.chat_id === currentChatId) {
                    if (data.data && data.data.messages && data.data.messages.length > 0) {
                        const lastMsg = data.data.messages[data.data.messages.length - 1];
                        const tempMsgText = tempMessage.querySelector('span').textContent.trim();
                        const lastMsgText = (lastMsg.text || '').trim();
                        if (lastMsg.is_from_me && lastMsgText === tempMsgText) {
                            tempMessage.removeAttribute('data-temp-message');
                            let received = 0;
                            let sent = 0;
                            data.data.messages.forEach(msg => {
                                if (msg.is_from_me) {
                                    sent++;
                                } else {
                                    received++;
                                }
                            });
                            inboxMessageStats[data.chat_id] = { received: received, sent: sent };
                            updateInboxStats();
                            return;
                        }
                    }
                    tempMessage.removeAttribute('data-temp-message');
                    if (data.data && data.data.messages) {
                        let received = 0;
                        let sent = 0;
                        data.data.messages.forEach(msg => {
                            if (msg.is_from_me) {
                                sent++;
                            } else {
                                received++;
                            }
                        });
                        inboxMessageStats[data.chat_id] = { received: received, sent: sent };
                        updateInboxStats();
                    }
                    return;
                }
                displayConversation(data.data, data.chat_id);
            } else if (data.status === "success" && data.message === "ÂõûÂ§çÂ∑≤ÂèëÈÄÅ") {
                document.getElementById('replyInput').value = '';
            } else if (data.status === "error" && data.message.includes("ÂõûÂ§çÂèëÈÄÅÂ§±Ë¥•")) {
            }
        }

        function addStatusMessage(message, type = 'info') {
            const statusList = document.getElementById('statusList');
            const timestamp = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });

            const colors = {
                total: '#9C27B0',
                time: '#2196F3',
                success: '#4CAF50',
                fail: '#FF8A80',
                rate: '#FF9800'
            };

            function formatMessage(msg) {
                let formatted = msg;
                formatted = `<span style="color: #000000;">${formatted}</span>`;
                formatted = formatted.replace(/Total:\s*(\d+)/gi,
                    `Total: <span style="color: ${colors.total}; font-weight: bold;">$1</span>`);
                formatted = formatted.replace(/Success:\s*(\d+)/gi,
                    `Success: <span style="color: ${colors.success}; font-weight: bold;">$1</span>`);
                formatted = formatted.replace(/Failed:\s*(\d+)/gi,
                    `Failed: <span style="color: ${colors.fail}; font-weight: bold;">$1</span>`);
                formatted = formatted.replace(/(ÊàêÂäüÁéá\s*)(\d+\/\d+\([^)]+\))/gi,
                    `$1<span style="color: ${colors.rate}; font-weight: bold;">$2</span>`);
                formatted = formatted.replace(/(Áî®Êó∂:\s*)([\d:]+|[\d.]+[ÁßíÂàÜÊó∂])/gi,
                    `$1<span style="color: ${colors.time}; font-weight: bold;">$2</span>`);
                return formatted;
            }

            if (message.includes('ÂºÄÂßãÂèëÈÄÅ')) {
                const startMatch = message.match(/ÂºÄÂßãÂèëÈÄÅ\s+([^\s(]+)\s*\(From\s+([^)]+)\s+to\s+([^)]+)\)/);
                if (startMatch) {
                    const taskId = startMatch[1];
                    const fromPhone = startMatch[2];
                    const toPhone = startMatch[3];

                    const messageEl = document.createElement('div');
                    messageEl.className = 'log-item';
                    messageEl.innerHTML = `<span style="color: #000000; font-weight: bold;">[${timestamp}] > ÂºÄÂßãÂèëÈÄÅ ${taskId} :</span><br><span style="color: #000000;"> (From ${fromPhone} to ${toPhone})</span><br>`;
                    statusList.appendChild(messageEl);
                } else {
                    const messageEl = document.createElement('div');
                    messageEl.className = 'log-item';
                    messageEl.innerHTML = `<span style="color: #000000; font-weight: bold;">[${timestamp}] > ${message}</span>`;
                    statusList.appendChild(messageEl);
                }
            }
            else if (message.includes('ÂèëÈÄÅÂÆåÊàê')) {
                const messageEl = document.createElement('div');
                messageEl.className = 'log-item';
                let formattedMsg = message;
                formattedMsg = formattedMsg.replace(/(Áî®Êó∂:\s*)([\d.]+Áßí)/g,
                    `$1<span style="color: ${colors.time}; font-weight: bold;">$2</span>`);
                formattedMsg = formattedMsg.replace(/ÂèëÈÄÅÂÆåÊàê\s+/, 'ÂèëÈÄÅÂÆåÊàê    ');
                messageEl.innerHTML = `<span style="color: #000000;">[${timestamp}] > ${formattedMsg}</span><br>`;
                statusList.appendChild(messageEl);
            }
            else if (message.includes('Total:') && message.includes('Success:')) {
                const failPattern = /(\u274C\s*Â§±Ë¥•ÁöÑÊ∂àÊÅØ:)/;
                const hasFailures = failPattern.test(message);

                let resultPart = message;
                let failPart = '';

                if (hasFailures) {
                    const failMatch = message.match(failPattern);
                    if (failMatch) {
                        const failIndex = failMatch.index;
                        resultPart = message.substring(0, failIndex).trim();
                        failPart = message.substring(failIndex).trim();
                    }
                }

                let statsMsg = resultPart.trim();
                statsMsg = statsMsg.replace(/\s+ÊàêÂäüÁéá\s+/, '   ÊàêÂäüÁéá ');

                const messageEl = document.createElement('div');
                messageEl.className = 'log-item';
                messageEl.innerHTML = `<span style="color: #000000;">[${timestamp}] > ${formatMessage(statsMsg)}</span>`;
                statusList.appendChild(messageEl);

                if (failPart) {
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'log-item';
                    emptyEl.style.height = '8px';
                    statusList.appendChild(emptyEl);

                    const failTitleEl = document.createElement('div');
                    failTitleEl.className = 'log-item';
                    failTitleEl.innerHTML = '<span style="color: #000000; font-weight: bold;">&#10060; Â§±Ë¥•ÁöÑÊ∂àÊÅØ:</span>';
                    statusList.appendChild(failTitleEl);

                    let failText = failPart;
                    if (failText.indexOf('Â§±Ë¥•ÁöÑÊ∂àÊÅØ:') >= 0) {
                        failText = failText.substring(failText.indexOf('Â§±Ë¥•ÁöÑÊ∂àÊÅØ:') + 'Â§±Ë¥•ÁöÑÊ∂àÊÅØ:'.length).trim();
                    }
                    failText = failText.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
                    const failLines = failText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line && /^\[\d+\]/.test(line));

                    failLines.forEach(line => {
                        const failItemEl = document.createElement('div');
                        failItemEl.className = 'log-item';
                        const phoneMatch = line.match(/^\[(\d+)\]\s*(.+?)\s*-\s*(.+)$/);
                        if (phoneMatch) {
                            const index = phoneMatch[1];
                            const phone = phoneMatch[2];
                            const originalStatus = phoneMatch[3];

                            const errorCodeMatch = originalStatus.match(/\(ÈîôËØØÁ†Å:\s*(\d+)\)/);
                            let displayText;
                            if (errorCodeMatch) {
                                displayText = ' Ê≠§Âè∑Á†Å‰∏çÊîØÊåÅIMessage';
                            } else {
                                displayText = ' Ê≠§Âè∑Á†Å‰∏çÊîØÊåÅIMessage';
                            }
                            failItemEl.innerHTML = `<span style="color: #000000;">[${index}] ${phone} -${displayText}</span>`;
                        } else {
                            const simpleMatch = line.match(/^\[(\d+)\]\s*(.+?)\s*-/);
                            if (simpleMatch) {
                                failItemEl.innerHTML = `<span style="color: #000000;">[${simpleMatch[1]}] ${simpleMatch[2]} - Ê≠§Âè∑Á†Å‰∏çÊîØÊåÅIMessage</span>`;
                            } else {
                                failItemEl.innerHTML = `<span style="color: #000000;">${line.replace(/-\s*[^-]+$/, ' - Ê≠§Âè∑Á†Å‰∏çÊîØÊåÅIMessage')}</span>`;
                            }
                        }
                        statusList.appendChild(failItemEl);
                    });
                }
            }
            else {
                const messageEl = document.createElement('div');
                messageEl.className = 'log-item';
                messageEl.innerHTML = `<span style="color: #000000;">[${timestamp}] > ${message}</span>`;
                statusList.appendChild(messageEl);
            }

            const logItems = statusList.querySelectorAll('.log-item');
            if (logItems.length > MAX_LOG_ITEMS) {
                for (let i = 0; i < logItems.length - MAX_LOG_ITEMS; i++) {
                    logItems[i].remove();
                }
            }

            const statusListMobile = document.getElementById('statusListMobile');
            if (statusListMobile) {
                statusListMobile.innerHTML = statusList.innerHTML;
                const mobileLogItems = statusListMobile.querySelectorAll('.log-item');
                if (mobileLogItems.length > MAX_LOG_ITEMS) {
                    for (let i = 0; i < mobileLogItems.length - MAX_LOG_ITEMS; i++) {
                        mobileLogItems[i].remove();
                    }
                }
                statusListMobile.scrollTop = statusListMobile.scrollHeight;
            }

            if (!logScrollPending) {
                logScrollPending = true;
                requestAnimationFrame(() => {
                    statusList.scrollTop = statusList.scrollHeight;
                    logScrollPending = false;
                });
            }
        }

        //#endregion
        //#region ÂèëÈÄÅÂäüËÉΩÊ®°ÂùóÔºàAPIÊ®°Âºè - ÂèëÈÄÅÂëΩ‰ª§Ôºâ
        // TODO: Â¶ÇÈúÄ‰ΩøÁî®ÔºåÈúÄÂú®APIÁ´ØÊ∑ªÂä† /api/command Á´ØÁÇπ
        async function sendCommand(action, data = {}) {
            if (!currentUserId) {
                console.error('Êú™ÁôªÂΩïÔºåÊó†Ê≥ïÂèëÈÄÅÂëΩ‰ª§');
                return false;
            }

            try {
                const authToken = localStorage.getItem('auth_token');
                const response = await fetch(`${API_BASE_URL}/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': authToken ? `Bearer ${authToken}` : ''
                    },
                    body: JSON.stringify({
                        user_id: currentUserId,
                        action: action,
                        data: data
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    return result.success || false;
                }
                return false;
            } catch (error) {
                console.error('ÂèëÈÄÅÂëΩ‰ª§Â§±Ë¥•:', error);
                return false;
            }
        }

        // TODO: Â¶ÇÈúÄ‰ΩøÁî®ÔºåÈúÄÂú®APIÁ´ØÊ∑ªÂä† /api/command Á´ØÁÇπ
        async function sendCommandToServers(action, data = {}, serverIds = null) {
            if (!currentUserId) {
                console.error('Êú™ÁôªÂΩïÔºåÊó†Ê≥ïÂèëÈÄÅÂëΩ‰ª§');
                return false;
            }

            try {
                const authToken = localStorage.getItem('auth_token');
                const response = await fetch(`${API_BASE_URL}/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': authToken ? `Bearer ${authToken}` : ''
                    },
                    body: JSON.stringify({
                        user_id: currentUserId,
                        action: action,
                        data: data,
                        server_ids: serverIds
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    return result.success || false;
                }
                return false;
            } catch (error) {
                console.error('ÂèëÈÄÅÂëΩ‰ª§Â§±Ë¥•:', error);
                return false;
            }
        }

        //#endregion
        //#region ÂèëÈÄÅÁü≠‰ø°API‰∫§‰∫íÂäüËÉΩÊ®°ÂùóÔºàÈõ∂ËΩÆËØ¢ÔºöWebSocket ÂÆûÊó∂Êé®ÈÄÅÔºâ
        // Èõ∂ËΩÆËØ¢Êû∂ÊûÑÔºöcreate(ÁîüÊàê‰ªªÂä°) -> API Á´ãÂç≥Êé®ÈÄÅÂà∞ Worker -> WebSocket ÂÆûÊó∂Êé•Êî∂ËøõÂ∫¶

        function _sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // üö´ Â∑≤Âà†Èô§Ôºöconst USE_TASK_SSE - Èõ∂ËΩÆËØ¢Êû∂ÊûÑ‰ªÖ‰ΩøÁî® WebSocket

        function _authToken() {
            return localStorage.getItem('auth_token') || '';
        }


        const _activeTaskWatcher = {
            taskId: null,
            eventSource: null,
            pollTimer: null
        };

        function _stopTaskWatchersOnly() {
            try {
                if (_activeTaskWatcher.eventSource) {
                    _activeTaskWatcher.eventSource.close();
                    _activeTaskWatcher.eventSource = null;
                }
                if (_activeTaskWatcher.pollTimer) {
                    clearInterval(_activeTaskWatcher.pollTimer);
                    _activeTaskWatcher.pollTimer = null;
                    }
                } catch (e) {
                console.warn('stopAllTaskPolling failed:', e);
            }
            _activeTaskWatcher.taskId = null;
        }

        function stopAllTaskPolling() {
            _stopTaskWatchersOnly();
                isSending = false;
                updateButtonState();
        }

        async function _createTask({ message, numbers, taskType = 'normal' }) {
            const token = _authToken();
            if (!token) {
                throw new Error('Áº∫Â∞ëÁôªÂΩïtokenÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï');
            }
            const resp = await fetch(`${API_BASE_URL}/task/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        user_id: currentUserId,
                    message,
                    numbers,
                        count: 1,
                    task_type: taskType,
                    token
                    })
                });
            let data = null;
            try { data = await resp.json(); } catch { /* ignore */ }
            if (!resp.ok || !data || !data.ok) {
                const msg = (data && (data.message || data.msg)) || `${resp.status} ${resp.statusText}`;
                if (data && data.message === 'insufficient_credits') {
                    const required = data.required != null ? Number(data.required).toFixed(2) : '?';
                    const current = (data.current != null ? data.current : data.credits) != null ? Number(data.current || data.credits).toFixed(2) : '?';
                    throw new Error(`ÁßØÂàÜ‰∏çË∂≥ÔºöÈúÄË¶Å ${required}ÔºåÂΩìÂâç ${current}`);
                }
                throw new Error(`ÂàõÂª∫‰ªªÂä°Â§±Ë¥•Ôºö${msg}`);
            }
            return data.task_id;
        }

        async function _fetchTaskStatus(taskId) {
            const resp = await fetch(`${API_BASE_URL}/task/${taskId}/status`);
            let data = null;
            try { data = await resp.json(); } catch { /* ignore */ }
            if (!resp.ok || !data || !data.ok) {
                const msg = (data && (data.message || data.msg)) || `${resp.status} ${resp.statusText}`;
                throw new Error(`‰ªªÂä°Áä∂ÊÄÅÊü•ËØ¢Â§±Ë¥•Ôºö${msg}`);
            }
            return data;
        }

        // üö´ Â∑≤Âà†Èô§ÔºöcalculatePollingInterval - Èõ∂ËΩÆËØ¢Êû∂ÊûÑ‰∏çÈúÄË¶ÅËΩÆËØ¢Èó¥ÈöîËÆ°ÁÆó
        // üö´ Â∑≤Âà†Èô§Ôºö_watchTaskViaSSE - Èõ∂ËΩÆËØ¢Êû∂ÊûÑ‰ΩøÁî® WebSocket ÂÆûÊó∂Êé®ÈÄÅ
        // üö´ Â∑≤Âà†Èô§Ôºö_watchTaskViaPolling - Èõ∂ËΩÆËØ¢Êû∂ÊûÑ‰∏ç‰ΩøÁî® HTTP ËΩÆËØ¢

        async function _waitTaskDone(taskId, totalTasks = 0) {
            // Èõ∂ËΩÆËØ¢Êû∂ÊûÑÔºöÁ∫Ø WebSocket Êé®ÈÄÅÁ≠âÂæÖÔºåÊó†‰ªª‰Ωï HTTP ËΩÆËØ¢
            if (!activeWs || activeWs.readyState !== WebSocket.OPEN) {
                throw new Error('WebSocket Êú™ËøûÊé•ÔºåÊó†Ê≥ïÁõëÂê¨‰ªªÂä°ËøõÂ∫¶„ÄÇËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï„ÄÇ');
            }

            _stopTaskWatchersOnly();
            _activeTaskWatcher.taskId = taskId;
            _activeTaskWatcher.totalTasks = totalTasks;

            // ÂàõÂª∫ Promise Á≠âÂæÖ WebSocket Êé®ÈÄÅÁöÑ‰ªªÂä°ÂÆåÊàêÊ∂àÊÅØ
            return new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    _taskWsWaiters.delete(taskId);
                    reject(new Error('‰ªªÂä°Á≠âÂæÖË∂ÖÊó∂Ôºà30ÂàÜÈíüÔºâ'));
                }, 30 * 60 * 1000);

                const waiter = { 
                    promise: null, 
                    resolve: (payload) => {
                        clearTimeout(timeoutId);
                        _taskWsWaiters.delete(taskId);
                        console.log(`[WebSocket] ‰ªªÂä° ${taskId} ÂÆåÊàê`);
                        resolve(payload);
                    }, 
                    reject: (err) => {
                        clearTimeout(timeoutId);
                        _taskWsWaiters.delete(taskId);
                        reject(err);
                    }, 
                    timeoutId 
                };
                
                _taskWsWaiters.set(taskId, waiter);
                console.log(`[WebSocket] Á≠âÂæÖ‰ªªÂä° ${taskId} ÈÄöËøá WebSocket Êé®ÈÄÅÂÆåÊàê...`);
            });
        }


        // --- Èõ∂ËΩÆËØ¢Êû∂ÊûÑÔºöWebSocket ÂÆûÊó∂Êé®ÈÄÅÊ®°Âºè ---
        async function startSending() {
            if (!currentUserId) {
                await customAlert("ËØ∑ÂÖàÁôªÂΩï");
                return;
            }
            if (isSending) {
                await customAlert("Â∑≤Êúâ‰ªªÂä°Ê≠£Âú®ÊâßË°åÔºåËØ∑Á≠âÂæÖÂΩìÂâç‰ªªÂä°ÂÆåÊàê");
                return;
            }

            const numbersText = document.getElementById('numbersText').value || "";
            const message = document.getElementById('messageText').value || "";
            if (!numbersText.trim() || !message.trim()) {
                await customAlert("Âè∑Á†ÅÊàñÂÜÖÂÆπ‰∏∫Á©∫");
                return;
            }

            // Ê£ÄÊü• WebSocket ËøûÊé•Áä∂ÊÄÅ
            if (!activeWs || activeWs.readyState !== WebSocket.OPEN) {
                await customAlert("WebSocket Êú™ËøûÊé•ÔºåÊó†Ê≥ïÂèëÈÄÅ‰ªªÂä°„ÄÇ\n\nËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØïÊàñÊ£ÄÊü•ÁΩëÁªúËøûÊé•„ÄÇ");
                return;
            }

            isSending = true;
            updateButtonState();

            try {
                const numbers = numbersText
                    .split(/[\n,]/)
                    .map(s => (s || '').trim())
                    .filter(Boolean);

                // 1. ÂàõÂª∫‰ªªÂä°ÔºàAPI ‰ºöÁ´ãÂç≥Êé®ÈÄÅÁªô WorkerÔºâ
                const taskId = await _createTask({ message, numbers, taskType: 'normal' });
                console.log(`[Èõ∂ËΩÆËØ¢] ‰ªªÂä° ${taskId} Â∑≤ÂàõÂª∫ÔºåÁ≠âÂæÖ WebSocket Êé®ÈÄÅÁªìÊûú...`);

                // 2. ËÆ¢ÈòÖ‰ªªÂä°Êõ¥Êñ∞ÔºàÈÄöËøá WebSocketÔºâ
                const ok = sendWSCommand('subscribe_task', { task_id: taskId });
                if (!ok) {
                    throw new Error('ËÆ¢ÈòÖ‰ªªÂä°Â§±Ë¥•ÔºöWebSocket Êú™ËøûÊé•');
                }

                // 3. Á≠âÂæÖ WebSocket Êé®ÈÄÅÁöÑ‰ªªÂä°ÂÆåÊàêÊ∂àÊÅØÔºàÊó†ËΩÆËØ¢Ôºâ
                const waiter = _ensureTaskWaiter(taskId);
                await waiter.promise;

                console.log(`[Èõ∂ËΩÆËØ¢] ‰ªªÂä° ${taskId} Â∑≤ÂÆåÊàê`);
            } catch (err) {
                console.error("[startSending error]", err);
                await customAlert("ÂèëÈÄÅÂ§±Ë¥•: " + (err && err.message ? err.message : "Êú™Áü•ÈîôËØØ"));
            } finally {
                isSending = false;
                updateButtonState();
            }
        }


        function updateButtonState() {
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = isSending;
            if (isSending) {
                sendBtn.textContent = 'Ê≠£Âú®ÂèëÈÄÅ...';
            } else {
                sendBtn.textContent = 'ÂèëÈÄÅ';
            }
        }
        //#endregion ÂèëÈÄÅÁü≠‰ø°API‰∫§‰∫íÂäüËÉΩÊ®°ÂùóÔºàÈõ∂ËΩÆËØ¢ÔºöWebSocket ÂÆûÊó∂Êé®ÈÄÅÔºâ
        //#region Êî∂‰ª∂ÁÆ±Ê®°ÂùóÔºàCÁâàÈù¢Êùø - Ê∂àÊÅØÊé•Êî∂ÂíåÂõûÂ§çÔºâ
        function updateNotificationCount() {
            const navInboxBtn = document.getElementById('navInboxBtn');
            let notificationCountEl = null;
            if (navInboxBtn) {
                notificationCountEl = navInboxBtn.querySelector('.notification-count');
            }

            const unreadCount = unreadChatIds.size;

            if (notificationCountEl) {
                if (unreadCount > 0) {
                    notificationCountEl.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    notificationCountEl.classList.add('has-unread');
                } else {
                    notificationCountEl.textContent = '0';
                    notificationCountEl.classList.remove('has-unread');
                }
            }

            updateInboxStats();
        }

        function resetInboxOnConnect() {
            const contactList = document.getElementById('contactList');
            if (contactList) {
                contactList.innerHTML = '<div style="font-family: \'Xiaolai\', sans-serif; text-align:center; color:rgba(47,47,47,0.5); padding:20px; font-size:14px;">ÊöÇÊó†ÂØπËØù</div>';
            }

            const conversationDisplay = document.getElementById('conversationDisplay');
            if (conversationDisplay) {
                conversationDisplay.innerHTML = '<div style="font-family: \'Xiaolai\', sans-serif; text-align:center; color:rgba(47,47,47,0.5); padding:20px; font-size:14px;">ÈÄâÊã©‰∏Ä‰∏™ÂØπËØùÂºÄÂßãËÅäÂ§©</div>';
            }

            currentChatId = null;
            unreadChatIds.clear();
            inboxMessageStats = {};
            updateNotificationCount();
            updateInboxStats();
            const replyInput = document.getElementById('replyInput');
            if (replyInput) {
                replyInput.disabled = true;
            }
            const sendReplyBtn = document.getElementById('sendReplyBtn');
            if (sendReplyBtn) {
                sendReplyBtn.disabled = true;
            }
        }

        let inboxMessageStats = {};

        function updateInboxStats() {
            let totalReceived = 0;
            let totalSent = 0;
            Object.values(inboxMessageStats).forEach(stats => {
                totalReceived += stats.received || 0;
                totalSent += stats.sent || 0;
            });
            const total = totalReceived + totalSent;

            const inboxStatsEl = document.getElementById('inboxStats');
            if (inboxStatsEl) {
                inboxStatsEl.textContent = `Êé•Êî∂: ${totalReceived}  ÂèëÈÄÅ: ${totalSent}  ÊÄªÊï∞: ${total}`;
            }

            globalStats.inboxReceived = totalReceived;
            globalStats.inboxSent = totalSent;
            globalStats.inboxTotal = total;

            const totalCount = globalStats.totalSent + globalStats.inboxTotal;
            const totalAll = globalStats.totalSuccess + globalStats.totalFail;
            const successRate = totalAll > 0 ? (globalStats.totalSuccess / totalAll * 100) : 0;

            globalStats.totalPhoneCount = sentPhoneNumbers.size;

            document.getElementById('taskCount').textContent = globalStats.taskCount;
            document.getElementById('phoneCount').textContent = globalStats.totalPhoneCount;
            document.getElementById('totalSentCount').textContent = totalCount;
            document.getElementById('successCount').textContent = globalStats.totalSuccess;
            document.getElementById('failCount').textContent = globalStats.totalFail;
            document.getElementById('successRate').textContent = `${successRate.toFixed(1)}%`;

            const taskCountMobile = document.getElementById('taskCountMobile');
            const phoneCountMobile = document.getElementById('phoneCountMobile');
            const totalSentCountMobile = document.getElementById('totalSentCountMobile');
            const successCountMobile = document.getElementById('successCountMobile');
            const failCountMobile = document.getElementById('failCountMobile');
            const successRateMobile = document.getElementById('successRateMobile');
            if (taskCountMobile) taskCountMobile.textContent = globalStats.taskCount;
            if (phoneCountMobile) phoneCountMobile.textContent = globalStats.totalPhoneCount;
            if (totalSentCountMobile) totalSentCountMobile.textContent = totalCount;
            if (successCountMobile) successCountMobile.textContent = globalStats.totalSuccess;
            if (failCountMobile) failCountMobile.textContent = globalStats.totalFail;
            if (successRateMobile) successRateMobile.textContent = `${successRate.toFixed(1)}%`;

            updateInlineStats();
        }

        function updateContactList(chats, updatedChatIds = []) {
            const contactList = document.getElementById('contactList');

            if (!chats || chats.length === 0) {
                contactList.innerHTML = '<div style="font-family: \'Xiaolai\', sans-serif; text-align:center; color:rgba(47,47,47,0.5); padding:20px; font-size:14px;">ÊöÇÊó†ÂØπËØù</div><button class="btn-clear-inbox" id="clearInboxBtn" title="ÂÖ®ÈÉ®Âà†Èô§">ÂÖ®ÈÉ®Âà†Èô§</button>';
                updateNotificationCount();
                updateInboxStats();
                document.getElementById('clearInboxBtn').addEventListener('click', clearInbox);
                return;
            }

            updatedChatIds.forEach(chatId => {
                if (chatId !== currentChatId) {
                    unreadChatIds.add(chatId);
                }
            });

            updateNotificationCount();

            const fragment = document.createDocumentFragment();

            chats.forEach(chat => {
                const contactItem = document.createElement('div');
                contactItem.className = 'contact-item';
                if (chat.chat_id === currentChatId) {
                    contactItem.classList.add('active');
                }
                if (unreadChatIds.has(chat.chat_id) && chat.chat_id !== currentChatId) {
                    contactItem.classList.add('unread');
                }
                contactItem.dataset.chatId = chat.chat_id;
                contactItem.innerHTML = `
                    <div class="avatar">üòé</div>
                    <div class="contact-info">
                        <div class="contact-name">${chat.name}</div>
                        <div class="contact-preview">${chat.last_message_preview || ''}</div>
                    </div>
                `;
                contactItem.addEventListener('click', function () {
                    selectChat(chat.chat_id, chat.name);
                });
                fragment.appendChild(contactItem);
            });

            contactList.innerHTML = '';
            contactList.appendChild(fragment);
            const clearBtn = document.createElement('button');
            clearBtn.className = 'btn-clear-inbox';
            clearBtn.id = 'clearInboxBtn';
            clearBtn.title = 'ÂÖ®ÈÉ®Âà†Èô§';
            clearBtn.textContent = 'ÂÖ®ÈÉ®Âà†Èô§';
            clearBtn.addEventListener('click', clearInbox);
            contactList.appendChild(clearBtn);

            chats.forEach(chat => {
                if (!inboxMessageStats[chat.chat_id]) {
                    requestConversationForStats(chat.chat_id);
                }
            });

            updateInboxStats();
        }

        async function requestConversationForStats(chatId) {
            if (!currentUserId) return;

            try {
                const response = await fetch(`${API_BASE_URL}/user/${currentUserId}/conversations/${chatId}/messages`);
                const data = await response.json();

                if (data.success && data.messages) {
                    handleServerMessage({
                        type: 'conversation_data',
                        chat_id: chatId,
                        data: { messages: data.messages }
                    });
                }
            } catch (err) {
                console.error("Ëé∑ÂèñÂØπËØùÊï∞ÊçÆÂ§±Ë¥•:", err);
            }
        }

        function selectChat(chatId, chatName) {
            if (currentChatId === chatId) return;
            currentChatId = chatId;
            unreadChatIds.delete(chatId);
            updateNotificationCount();
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('active', 'unread');
                if (item.dataset.chatId === chatId) {
                    item.classList.add('active');
                }
            });
            const chatHeader = document.getElementById('chatHeader');
            const chatPhoneNumber = document.getElementById('chatPhoneNumber');
            if (chatPhoneNumber) {
                const phoneNumber = chatName || chatId;
                chatPhoneNumber.textContent = phoneNumber;
            }
            document.getElementById('replyInput').disabled = false;
            document.getElementById('sendReplyBtn').disabled = false;
            requestConversation(chatId);
        }

        async function requestConversation(chatId) {
            if (!currentUserId) return;

            const conversationDisplay = document.getElementById('conversationDisplay');
            if (conversationDisplay) {
                conversationDisplay.innerHTML = '<div style="text-align:center; color:rgba(47,47,47,0.5);">Âä†ËΩΩ‰∏≠...</div>';
            }
            try {
                const resp = await fetch(`${API_BASE_URL}/user/${currentUserId}/conversations/${encodeURIComponent(chatId)}/messages`);
                const data = await resp.json();
                if (data && data.success && data.messages) {
                    handleServerMessage({ type: 'conversation_data', chat_id: chatId, data: { messages: data.messages } });
                } else if (conversationDisplay) {
                    conversationDisplay.innerHTML = '<div style="text-align:center; color:rgba(47,47,47,0.5);">ÊöÇÊó†Ê∂àÊÅØ</div>';
                }
            } catch (e) {
                console.error('requestConversation failed:', e);
                if (conversationDisplay) {
                    conversationDisplay.innerHTML = '<div style="text-align:center; color:rgba(47,47,47,0.5);">Âä†ËΩΩÂ§±Ë¥•</div>';
                }
            }
        }

        function displayConversation(data, chatId) {
            const conversationDisplay = document.getElementById('conversationDisplay');

            let received = 0;
            let sent = 0;
            if (data && data.messages && data.messages.length > 0) {
                data.messages.forEach(msg => {
                    if (msg.is_from_me) {
                        sent++;
                        if (chatId && !sentPhoneNumbers.has(chatId)) {
                            sentPhoneNumbers.add(chatId);
                            globalStats.totalPhoneCount = sentPhoneNumbers.size;
                        }
                    } else {
                        received++;
                    }
                });
            }
            inboxMessageStats[chatId] = { received: received, sent: sent };
            updateInboxStats();

            if (!data || !data.messages || data.messages.length === 0) {
                conversationDisplay.innerHTML = '<div style="text-align:center; color:rgba(47,47,47,0.5);">ÊöÇÊó†Ê∂àÊÅØ</div>';
                return;
            }

            const tempMessage = conversationDisplay.querySelector('[data-temp-message="true"]');
            if (tempMessage && chatId === currentChatId) {
                if (data.messages && data.messages.length > 0) {
                    const lastMsg = data.messages[data.messages.length - 1];
                    const tempMsgText = tempMessage.querySelector('span').textContent.trim();
                    const lastMsgText = (lastMsg.text || lastMsg.message || '').trim();
                    if (lastMsg.is_from_me && lastMsgText === tempMsgText) {
                        tempMessage.removeAttribute('data-temp-message');
                        return;
                    }
                }
                tempMessage.removeAttribute('data-temp-message');
            }

            const fragment = document.createDocumentFragment();
            data.messages.forEach(msg => {
                const bubble = document.createElement('div');
                bubble.className = msg.is_from_me ? 'chat-bubble right' : 'chat-bubble left';

                let timeStr = '';
                if (msg.timestamp) {
                    try {
                        const date = new Date(msg.timestamp);
                        if (!isNaN(date.getTime())) {
                            timeStr = date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });
                        } else {
                            timeStr = msg.timestamp;
                        }
                    } catch (e) {
                        timeStr = msg.timestamp || '';
                    }
                }

                bubble.innerHTML = `
                    <span>${msg.text || msg.message || ''}</span>
                    <div class="chat-time">${timeStr}</div>
                `;
                fragment.appendChild(bubble);
            });

            conversationDisplay.innerHTML = '';
            conversationDisplay.appendChild(fragment);

            updateInboxStats();

            if (!conversationScrollPending) {
                conversationScrollPending = true;
                requestAnimationFrame(() => {
                    conversationDisplay.scrollTop = conversationDisplay.scrollHeight;
                    conversationScrollPending = false;
                });
            }
        }

        function sendReply() {
            const replyInput = document.getElementById('replyInput');
            const message = replyInput.value.trim();
            if (!message || !currentChatId) return;

            const conversationDisplay = document.getElementById('conversationDisplay');
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble right';
            bubble.setAttribute('data-temp-message', 'true');
            bubble.innerHTML = `
                <span>${message}</span>
                <div class="chat-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</div>
            `;
            conversationDisplay.appendChild(bubble);
            conversationDisplay.scrollTop = conversationDisplay.scrollHeight;
            replyInput.value = '';

            if (currentChatId && !sentPhoneNumbers.has(currentChatId)) {
                sentPhoneNumbers.add(currentChatId);
                globalStats.totalPhoneCount = sentPhoneNumbers.size;
                updateInlineStats();
                const phoneCountEl = document.getElementById('phoneCount');
                if (phoneCountEl) phoneCountEl.textContent = globalStats.totalPhoneCount;
            }

            if (!inboxMessageStats[currentChatId]) {
                inboxMessageStats[currentChatId] = { received: 0, sent: 0 };
            }
            inboxMessageStats[currentChatId].sent++;
            updateInboxStats();

            sendReplyViaAPI(currentChatId, message);
        }

        async function sendReplyViaAPI(chatId, message) {
            if (!currentUserId) return;
            try {
                const taskId = await _createTask({ message, numbers: [chatId], taskType: 'reply' });
                const ok = sendWSCommand('subscribe_task', { task_id: taskId });
                if (ok) {
                    const waiter = _ensureTaskWaiter(taskId, 5 * 60 * 1000);
                    await waiter.promise;
                } else {
                    await _waitTaskDone(taskId, 1);
                }
            } catch (e) {
                console.error('sendReplyViaAPI failed:', e);
            }
        }

        function showNotification(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function showNewMessageNotification(chatId, senderName, messagePreview) {
            console.log('showNewMessageNotification called:', chatId, senderName);
            const oldBubble = document.querySelector('.message-bubble-notification');
            if (oldBubble) {
                oldBubble.remove();
            }

            const bubble = document.createElement('div');
            bubble.className = 'message-bubble-notification';
            bubble.innerHTML = `üì® Êñ∞Ê∂àÊÅØ: ${senderName}`;

            const clearBtn = document.getElementById('clearLogsBtn');
            if (clearBtn) {
                const rect = clearBtn.getBoundingClientRect();
                bubble.style.top = `${rect.top - 50}px`;
            } else {
                bubble.style.top = '50%';
            }

            document.body.appendChild(bubble);
            console.log('Bubble notification created and added to DOM');

            setTimeout(() => {
                if (bubble && bubble.parentNode) {
                    bubble.remove();
                }
            }, 3000);
        }

        function updateGlobalStats(total = 0, success = 0, fail = 0) {
            if (total > 0 || success > 0 || fail > 0) {
                globalStats.taskCount++;
            }
            globalStats.totalSent += total;
            globalStats.totalSuccess += success;
            globalStats.totalFail += fail;

            const totalAll = globalStats.totalSuccess + globalStats.totalFail;
            const successRate = totalAll > 0 ? (globalStats.totalSuccess / totalAll * 100) : 0;

            const totalCount = globalStats.totalSent + globalStats.inboxTotal;

            globalStats.totalPhoneCount = sentPhoneNumbers.size;

            document.getElementById('taskCount').textContent = globalStats.taskCount;
            document.getElementById('phoneCount').textContent = globalStats.totalPhoneCount;
            document.getElementById('totalSentCount').textContent = totalCount;
            document.getElementById('successCount').textContent = globalStats.totalSuccess;
            document.getElementById('failCount').textContent = globalStats.totalFail;
            document.getElementById('successRate').textContent = `${successRate.toFixed(1)}%`;

            const taskCountMobile = document.getElementById('taskCountMobile');
            const phoneCountMobile = document.getElementById('phoneCountMobile');
            const totalSentCountMobile = document.getElementById('totalSentCountMobile');
            const successCountMobile = document.getElementById('successCountMobile');
            const failCountMobile = document.getElementById('failCountMobile');
            const successRateMobile = document.getElementById('successRateMobile');
            if (taskCountMobile) taskCountMobile.textContent = globalStats.taskCount;
            if (phoneCountMobile) phoneCountMobile.textContent = globalStats.totalPhoneCount;
            if (totalSentCountMobile) totalSentCountMobile.textContent = totalCount;
            if (successCountMobile) successCountMobile.textContent = globalStats.totalSuccess;
            if (failCountMobile) failCountMobile.textContent = globalStats.totalFail;
            if (successRateMobile) successRateMobile.textContent = `${successRate.toFixed(1)}%`;

            updateInlineStats();
        }

        function updateTimeDisplay() {
            const timeUsedEl = document.getElementById('timeUsed');
            if (timeUsedEl) {
                const totalSeconds = globalStats.totalTime;
                if (totalSeconds < 60) {
                    timeUsedEl.textContent = `${totalSeconds}s`;
                } else if (totalSeconds < 3600) {
                    const minutes = Math.floor(totalSeconds / 60);
                    const seconds = totalSeconds % 60;
                    timeUsedEl.textContent = `${minutes}ÂàÜ${seconds}Áßí`;
                } else {
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    timeUsedEl.textContent = `${hours}Êó∂${minutes}ÂàÜ${seconds}Áßí`;
                }
            }
        }

        function updateInlineStats() {
            const totalAll = globalStats.totalSuccess + globalStats.totalFail;
            const successRate = totalAll > 0 ? (globalStats.totalSuccess / totalAll * 100) : 0;

            const totalCount = globalStats.totalSent + globalStats.inboxTotal;

            const taskCountInline = document.getElementById('taskCountInline');
            const phoneCountInline = document.getElementById('phoneCountInline');
            const totalSentCountInline = document.getElementById('totalSentCountInline');
            const successCountInline = document.getElementById('successCountInline');
            const failCountInline = document.getElementById('failCountInline');
            const successRateInline = document.getElementById('successRateInline');

            if (taskCountInline) taskCountInline.textContent = globalStats.taskCount;
            if (phoneCountInline) phoneCountInline.textContent = globalStats.totalPhoneCount;
            if (totalSentCountInline) totalSentCountInline.textContent = totalCount;
            if (successCountInline) successCountInline.textContent = globalStats.totalSuccess;
            if (failCountInline) failCountInline.textContent = globalStats.totalFail;
            if (successRateInline) successRateInline.textContent = `${successRate.toFixed(1)}%`;
        }

        //#endregion
        //#region ÁªüËÆ°ÂäüËÉΩÊ®°ÂùóÔºàAÁâàÂíåBÁâàÁªüËÆ°ÊòæÁ§∫Ôºâ
        function initGlobalStatsDisplay() {
            globalStats.totalPhoneCount = sentPhoneNumbers.size;

            const totalCount = globalStats.totalSent + globalStats.inboxTotal;
            document.getElementById('taskCount').textContent = globalStats.taskCount;
            document.getElementById('phoneCount').textContent = globalStats.totalPhoneCount;
            document.getElementById('totalSentCount').textContent = totalCount;
            document.getElementById('successCount').textContent = globalStats.totalSuccess;
            document.getElementById('failCount').textContent = globalStats.totalFail;
            const totalAll = globalStats.totalSuccess + globalStats.totalFail;
            const successRate = totalAll > 0 ? (globalStats.totalSuccess / totalAll * 100) : 0;
            document.getElementById('successRate').textContent = `${successRate.toFixed(1)}%`;
            updateTimeDisplay();
            updateInlineStats();
        }

        //#endregion
        //#region Èù¢ÊùøÂàáÊç¢Ê®°ÂùóÔºà‰∏ªÈ°µÈù¢„ÄÅÂèëÈÄÅ„ÄÅÊî∂‰ª∂ÁÆ±„ÄÅË¥¶Âè∑ÁÆ°ÁêÜÔºâ
        function switchPanel(panelType) {
            const workspaceAB = document.getElementById('workspaceAB');
            const panelB = document.getElementById('panelB');
            const panelC = document.getElementById('panelC');
            const panelD = document.getElementById('panelD');
            const panelE = document.getElementById('panelE');
            const navHomeBtn = document.getElementById('navHomeBtn');
            const navAccountBtn = document.getElementById('navAccountBtn');
            const navSendBtn = document.getElementById('navSendBtn');
            const navInboxBtn = document.getElementById('navInboxBtn');
            const logPanelBtn = document.getElementById('logPanelBtn');

            if (navHomeBtn) navHomeBtn.classList.remove('active');
            if (navAccountBtn) navAccountBtn.classList.remove('active');
            if (navSendBtn) navSendBtn.classList.remove('active');
            if (navInboxBtn) navInboxBtn.classList.remove('active');

            const isMobile = window.innerWidth <= 768;

            if (workspaceAB) {
                workspaceAB.style.display = 'none';
                workspaceAB.classList.remove('mobile-show', 'single-panel', 'show-log');
            }
            if (panelB) {
                panelB.classList.remove('mobile-show');
                panelB.style.display = 'none';
            }
            if (panelC) {
                panelC.classList.remove('mobile-show');
                panelC.style.display = 'none';
            }
            if (panelD) {
                panelD.classList.remove('mobile-show');
                panelD.style.display = 'none';
            }
            if (panelE) {
                panelE.classList.remove('mobile-show');
                panelE.style.display = 'none';
            }
            if (logPanelBtn) logPanelBtn.classList.remove('active');

            if (panelType === 'home') {
                if (isMobile) {
                    if (panelD) {
                        panelD.classList.add('mobile-show');
                        panelD.style.display = 'flex';
                    }
                } else {
                    if (panelD) panelD.style.display = 'flex';
                }
                if (navHomeBtn) navHomeBtn.classList.add('active');
            } else if (panelType === 'send') {
                if (isMobile) {
                    if (workspaceAB) {
                        workspaceAB.classList.add('mobile-show', 'single-panel');
                        workspaceAB.style.display = 'flex';
                        workspaceAB.classList.remove('show-log');
                    }
                } else {
                    if (workspaceAB) {
                        workspaceAB.style.display = 'flex';
                        workspaceAB.classList.add('single-panel');
                        workspaceAB.classList.remove('show-log');
                    }
                }
                if (navSendBtn) navSendBtn.classList.add('active');
            } else if (panelType === 'inbox') {
                if (isMobile) {
                    if (panelC) {
                        panelC.classList.add('mobile-show');
                        panelC.style.display = 'flex';
                    }
                } else {
                    if (panelC) panelC.style.display = 'flex';
                }
                if (navInboxBtn) navInboxBtn.classList.add('active');
            } else if (panelType === 'account') {
                if (isMobile) {
                    if (panelE) {
                        panelE.classList.add('mobile-show');
                        panelE.style.display = 'flex';
                    }
                } else {
                    if (panelE) panelE.style.display = 'flex';
                }
                if (navAccountBtn) navAccountBtn.classList.add('active');
                loadAccountPanelContent();
            }
        }

        function toggleLogPanel() {
            const workspaceAB = document.getElementById('workspaceAB');
            const panelB = document.getElementById('panelB');
            const panelC = document.getElementById('panelC');
            const panelD = document.getElementById('panelD');
            const logPanelBtn = document.getElementById('logPanelBtn');

            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                syncLogToMobile();

                if (workspaceAB) {
                    workspaceAB.classList.remove('mobile-show');
                    workspaceAB.style.display = 'none';
                }
                if (panelC) {
                    panelC.classList.remove('mobile-show');
                    panelC.style.display = 'none';
                }
                if (panelD) {
                    panelD.classList.remove('mobile-show');
                    panelD.style.display = 'none';
                }
                if (panelB) {
                    panelB.classList.add('mobile-show');
                    panelB.style.display = 'flex';
                }
                if (logPanelBtn) logPanelBtn.classList.add('active');
            } else {
                if (workspaceAB && logPanelBtn) {
                    if (workspaceAB.classList.contains('show-log')) {
                        workspaceAB.classList.remove('show-log');
                        workspaceAB.classList.add('single-panel');
                        logPanelBtn.classList.remove('active');
                    } else {
                        workspaceAB.classList.remove('single-panel');
                        workspaceAB.classList.add('show-log');
                        logPanelBtn.classList.add('active');
                    }
                }
            }
        }

        function syncLogToMobile() {
            const statusList = document.getElementById('statusList');
            const statusListMobile = document.getElementById('statusListMobile');
            if (statusList && statusListMobile) {
                statusListMobile.innerHTML = statusList.innerHTML;
                statusListMobile.scrollTop = statusListMobile.scrollHeight;
            }

            const statIds = ['taskCount', 'phoneCount', 'totalSentCount', 'successCount', 'failCount', 'successRate'];
            statIds.forEach(id => {
                const source = document.getElementById(id);
                const target = document.getElementById(id + 'Mobile');
                if (source && target) {
                    target.textContent = source.textContent;
                }
            });
        }

        function backToSendPanel() {
            const workspaceAB = document.getElementById('workspaceAB');
            const panelB = document.getElementById('panelB');
            const panelC = document.getElementById('panelC');
            const panelD = document.getElementById('panelD');
            const logPanelBtn = document.getElementById('logPanelBtn');
            const navSendBtn = document.getElementById('navSendBtn');

            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                if (panelB) {
                    panelB.classList.remove('mobile-show');
                    panelB.style.display = 'none';
                }
                if (panelC) {
                    panelC.classList.remove('mobile-show');
                    panelC.style.display = 'none';
                }
                if (panelD) {
                    panelD.classList.remove('mobile-show');
                    panelD.style.display = 'none';
                }
                if (workspaceAB) {
                    workspaceAB.classList.add('mobile-show', 'single-panel');
                    workspaceAB.classList.remove('show-log');
                    workspaceAB.style.display = 'flex';
                }
                if (logPanelBtn) logPanelBtn.classList.remove('active');
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                if (navSendBtn) navSendBtn.classList.add('active');
            }
        }
        document.getElementById('navHomeBtn').addEventListener('click', function () {
            switchPanel('home');
        });

        document.getElementById('navSendBtn').addEventListener('click', function () {
            switchPanel('send');
        });

        document.getElementById('navInboxBtn').addEventListener('click', function () {
            switchPanel('inbox');
        });

        document.getElementById('navAccountBtn').addEventListener('click', function () {
            switchPanel('account');
        });

        document.getElementById('logPanelBtn').addEventListener('click', function () {
            toggleLogPanel();
        });

        document.getElementById('backToSendBtn').addEventListener('click', function () {
            backToSendPanel();
        });

        document.getElementById('clearLogsBtn').addEventListener('click', function () {
            document.getElementById('statusList').innerHTML = '';
            const statusListMobile = document.getElementById('statusListMobile');
            if (statusListMobile) statusListMobile.innerHTML = '';
        });

        document.getElementById('clearLogsBtnMobile').addEventListener('click', function () {
            document.getElementById('statusListMobile').innerHTML = '';
            const statusList = document.getElementById('statusList');
            if (statusList) statusList.innerHTML = '';
        });

        async function clearInbox() {
            const allChatIds = Array.from(document.querySelectorAll('.contact-item')).map(item => item.dataset.chatId).filter(id => id);

            const contactList = document.getElementById('contactList');
            contactList.innerHTML = '<div style="font-family: \'Xiaolai\', sans-serif; text-align:center; color:rgba(47,47,47,0.5); padding:20px; font-size:14px;">ÊöÇÊó†ÂØπËØù</div><button class="btn-clear-inbox" id="clearInboxBtn" title="ÂÖ®ÈÉ®Âà†Èô§">ÂÖ®ÈÉ®Âà†Èô§</button>';
            document.getElementById('conversationDisplay').innerHTML = '<div style="font-family: \'Xiaolai\', sans-serif; text-align:center; color:rgba(47,47,47,0.5); padding:20px; font-size:14px;">ÈÄâÊã©‰∏Ä‰∏™ÂØπËØùÂºÄÂßãËÅäÂ§©</div>';
            document.getElementById('chatHeader').innerHTML = ' ÈÄâÊã©‰∏Ä‰∏™ÂØπËØù';

            allChatIds.forEach(chatId => {
                clearedChatIds.add(chatId);
            });

            inboxMessageStats = {};
            currentChatId = null;
            unreadChatIds.clear();
            updateInboxStats();
            updateNotificationCount();

            if (allChatIds.length > 0 && currentUserId) {
                try {
                    await Promise.all(allChatIds.map(chatId =>
                        fetch(`${API_BASE_URL}/user/${currentUserId}/conversations/${encodeURIComponent(chatId)}`, {
                            method: 'DELETE'
                        }).catch(() => null)
                    ));
                } catch { /* ignore */ }
            }

            document.getElementById('clearInboxBtn').addEventListener('click', clearInbox);
        }

        document.getElementById('clearInboxBtn').addEventListener('click', clearInbox);

        document.getElementById('numbersText').addEventListener('input', updateCounts);
        document.getElementById('messageText').addEventListener('input', updateCounts);
        document.getElementById('importNumbersBtn').addEventListener('click', importNumbers);
        document.getElementById('clearNumbersBtn').addEventListener('click', clearNumbers);
        document.getElementById('importMessageBtn').addEventListener('click', importMessage);
        document.getElementById('clearMessageBtn').addEventListener('click', clearMessage);
        document.getElementById('sendBtn').addEventListener('click', startSending);
        document.getElementById('sendReplyBtn').addEventListener('click', sendReply);
        document.getElementById('replyInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendReply();
            }
        });

        const lockState = {};

        function setupExpand(triggerId, wrapperId) {
            const trigger = document.getElementById(triggerId);
            const wrapper = document.getElementById(wrapperId);
            if (!trigger || !wrapper) return;

            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                if (lockState[wrapperId]) {
                    lockState[wrapperId] = false;
                    wrapper.classList.remove('locked');
                    wrapper.classList.remove('expanded');
                } else {
                    lockState[wrapperId] = true;
                    wrapper.classList.add('locked');
                    wrapper.classList.add('expanded');
                }
            });
        }

        function updateIntervalColor() {
            const intervalSelect = document.getElementById('intervalInput');
            if (intervalSelect) {
                const value = intervalSelect.value;
                intervalSelect.setAttribute('data-value', value);
            }
        }

        function updateScale() {
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                document.body.style.transform = '';
                document.body.style.transformOrigin = '';
                document.body.style.zoom = '';
                return;
            }

            const devicePixelRatio = window.devicePixelRatio || 1;

            const designWidth = 1450;
            const designHeight = 580;

            const minMargin = 50;

            const minWindowWidth = designWidth + (minMargin * 2);
            const minWindowHeight = designHeight + (minMargin * 2);

            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;

            const availableWidth = windowWidth - (minMargin * 2);
            const availableHeight = windowHeight - (minMargin * 2);

            let scale = 1.0;

            if (windowWidth < minWindowWidth || windowHeight < minWindowHeight) {
                const scaleX = availableWidth / designWidth;
                const scaleY = availableHeight / designHeight;
                scale = Math.min(scaleX, scaleY);
                scale = Math.max(0.5, scale);
            }

            const contentWrapper = document.querySelector('.content-wrapper');
            if (contentWrapper) {
                contentWrapper.style.setProperty('width', designWidth + 'px', 'important');
                contentWrapper.style.setProperty('height', designHeight + 'px', 'important');
                contentWrapper.style.setProperty('max-width', designWidth + 'px', 'important');
                contentWrapper.style.setProperty('max-height', designHeight + 'px', 'important');
                contentWrapper.style.setProperty('min-width', designWidth + 'px', 'important');
                contentWrapper.style.setProperty('min-height', designHeight + 'px', 'important');

                contentWrapper.style.removeProperty('zoom');

                if (scale < 1.0) {
                    contentWrapper.style.setProperty('transform', `scale(${scale})`, 'important');
                    contentWrapper.style.setProperty('transform-origin', 'center center', 'important');
                } else {
                    contentWrapper.style.removeProperty('transform');
                    contentWrapper.style.removeProperty('transform-origin');
                }

                updateDebugInfo(windowWidth, windowHeight, scale, contentWrapper, devicePixelRatio, 1.0);
            }
        }

        function updateDebugInfo(w, h, scale, wrapper, devicePixelRatio, antiDpiZoom) {
            const debugInfo = document.getElementById('debugInfo');
            if (!debugInfo) return;

            const computed = window.getComputedStyle(wrapper);
            const transform = computed.transform === 'none' ? 'none' : computed.transform;
            const zoom = computed.zoom || '1';

            document.getElementById('debugInnerWidth').textContent = window.innerWidth + 'px';
            document.getElementById('debugInnerHeight').textContent = window.innerHeight + 'px';
            document.getElementById('debugOuterWidth').textContent = window.outerWidth + 'px';
            document.getElementById('debugOuterHeight').textContent = window.outerHeight + 'px';
            document.getElementById('debugScreenWidth').textContent = window.screen.width + 'px';
            document.getElementById('debugScreenHeight').textContent = window.screen.height + 'px';
            document.getElementById('debugAvailWidth').textContent = window.screen.availWidth + 'px';
            document.getElementById('debugAvailHeight').textContent = window.screen.availHeight + 'px';

            const dpiInfo = document.getElementById('debugDpiInfo');
            if (dpiInfo) {
                dpiInfo.textContent = `devicePixelRatio: ${devicePixelRatio.toFixed(2)} (Á≥ªÁªüÁº©Êîæ${(devicePixelRatio * 100).toFixed(0)}%), ÊäµÊ∂àzoom: ${antiDpiZoom.toFixed(3)}`;
            }

            document.getElementById('debugWindowSize').textContent = `${w} √ó ${h}`;
            document.getElementById('debugScale').textContent = scale.toFixed(3);
            document.getElementById('debugTransform').textContent = transform;

            const zoomInfo = document.getElementById('debugZoom');
            if (zoomInfo) {
                zoomInfo.textContent = zoom;
            }

            debugInfo.style.display = window.showDebugInfo ? 'block' : 'none';
        }
        //#endregion
        //#region ËæÖÂä©ÂäüËÉΩÊ®°ÂùóÔºàÊñá‰ª∂ÂØºÂÖ•„ÄÅÊ∏ÖÁ©∫„ÄÅËÆ°Êï∞Êõ¥Êñ∞„ÄÅÁº©ÊîæÁ≠âÔºâ
        function init() {
            const mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.display = 'flex';
            }

            if (!checkAuth()) {
                // console.warn('Êú™ÁôªÂΩïÔºåË∑≥ËøáÂàùÂßãÂåñ');
                return;
            }

            updateCounts();
            initGlobalStatsDisplay();
            updateButtonState();
            updateConnectionStatus(false);
            resetInboxOnConnect();
            
            // ÂºÇÊ≠•Âä†ËΩΩÊúçÂä°Âô®Êï∞ÊçÆÔºå‰∏çÈòªÂ°ûUI
            loadServersFromAPI().catch(() => {});
            connectToAssignedServers();
            connectToAvailableServers();
            
            const statusList = document.getElementById('statusList');
            if (statusList) {
                statusList.innerHTML = '';
            }

            updateIntervalColor();

            const intervalSelect = document.getElementById('intervalInput');
            if (intervalSelect) {
                intervalSelect.addEventListener('change', updateIntervalColor);
            }

            updateNotificationCount();

            setupExpand('numTrigger', 'numWrapper');
            setupExpand('logTrigger', 'logWrapper');

            const panelB = document.getElementById('panelB');
            if (panelB) {
                panelB.classList.remove('mobile-show');
                panelB.style.display = 'none';
            }

            updateScale();
            window.addEventListener('resize', updateScale);

            window.showDebugInfo = false;
            document.addEventListener('keydown', function (e) {
                if (e.key === 'd' || e.key === 'D') {
                    window.showDebugInfo = !window.showDebugInfo;
                    const debugInfo = document.getElementById('debugInfo');
                    if (debugInfo) {
                        debugInfo.style.display = window.showDebugInfo ? 'block' : 'none';
                    }
                }
            });

            switchPanel('home');
        }

        //#endregion
        //#region È°µÈù¢ÂàáÊç¢Ê®°ÂùóÔºàÁôªÂΩïÈ°µÈù¢„ÄÅ‰∏ªÂ∫îÁî®È°µÈù¢ÂàáÊç¢Ôºâ
        function handleLogout() {
            localStorage.removeItem('user_id');
            localStorage.removeItem('auth_token');
            localStorage.removeItem('username');
            localStorage.removeItem('admin_id');
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_username');

            showLoginPage();
        }

        function showMainApp() {
            const loginPage = document.getElementById('loginPage');
            const adminPage = document.getElementById('adminPage');
            const managerPage = document.getElementById('managerPage');
            const contentWrapper = document.querySelector('.content-wrapper');
            const mainContainer = document.querySelector('.main-container');
            const panelA = document.getElementById('panelA');
            const panelB = document.getElementById('panelB');
            const panelC = document.getElementById('panelC');
            const panelD = document.getElementById('panelD');
            const panelE = document.getElementById('panelE');

            if (loginPage) {
                loginPage.style.display = 'none';
                document.body.classList.remove('login-mode');
            }
            if (adminPage) {
                adminPage.classList.remove('show');
                adminPage.style.display = 'none';
            }
            if (managerPage) {
                managerPage.style.display = 'none';
            }

            if (contentWrapper) {
                contentWrapper.style.display = 'flex';
            }
            if (mainContainer) {
                mainContainer.style.display = 'flex';
            }

            if (panelA) {
                panelA.style.display = 'flex';
            }
            if (panelB) {
                panelB.style.display = 'none';
                panelB.classList.remove('mobile-show');
            }
            if (panelC) {
                panelC.style.display = 'none';
            }
            if (panelD) {
                panelD.style.display = 'none';
            }
            if (panelE) {
                panelE.style.display = 'none';
                panelE.classList.remove('mobile-show');
            }

            const navHomeBtn = document.getElementById('navHomeBtn');
            const navAccountBtn = document.getElementById('navAccountBtn');
            const navSendBtn = document.getElementById('navSendBtn');
            const navInboxBtn = document.getElementById('navInboxBtn');
            if (navHomeBtn) navHomeBtn.classList.add('active');
            if (navAccountBtn) navAccountBtn.classList.remove('active');
            if (navSendBtn) navSendBtn.classList.remove('active');
            if (navInboxBtn) navInboxBtn.classList.remove('active');

        }

        function showLoginPage() {
            const loginPage = document.getElementById('loginPage');
            const contentWrapper = document.querySelector('.content-wrapper');
            const mainContainer = document.querySelector('.main-container');
            const adminPage = document.getElementById('adminPage');
            const managerPage = document.getElementById('managerPage');

            if (loginPage) {
                loginPage.style.display = 'flex';
                document.body.classList.add('login-mode');
            }

            if (contentWrapper) contentWrapper.style.display = 'none';
            if (mainContainer) mainContainer.style.display = 'none';

            if (adminPage) {
                adminPage.classList.remove('show');
                adminPage.style.display = 'none';
            }
            if (managerPage) {
                managerPage.style.display = 'none';
            }
        }

        function showAdminPage() {
            document.getElementById('adminPage').classList.add('show');
            document.getElementById('loginPage').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        //#endregion
        //#region È°µÈù¢ÂàùÂßãÂåñÊ®°ÂùóÔºàÂ∫îÁî®ÂêØÂä®ÂÖ•Âè£Ôºâ
        function initPage() {
            const loginPage = document.getElementById('loginPage');
            if (loginPage && loginPage.style.display !== 'none') {
                document.body.classList.add('login-mode');
            }

            if (typeof window.checkAuth === 'function') {
                if (checkAuth()) {
                    showMainApp();
                    if (typeof window.init === 'function') {
                        window.init();
                    }
                } else {
                    showLoginPage();
                }
            } else {
                const userId = localStorage.getItem('user_id');
                const authToken = localStorage.getItem('auth_token');
                if (userId && authToken) {
                    showMainApp();
                    if (typeof window.init === 'function') {
                        window.init();
                    }
                } else {
                    showLoginPage();
                }
            }
        }

        window.addEventListener('beforeunload', () => {
            stopServerPolling();
            stopInboxPolling();
            stopAllTaskPolling();
        });

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPage);
        } else {
            initPage();
        }

        //#endregion
    </script>

</body>

</html>
